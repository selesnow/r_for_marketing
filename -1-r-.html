<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Язык R в интернет маркетинге</title>
  <meta name="description" content="Методичесткое пособие к авторскому курсу Алексея Селезнёва “Язык R в интернет маркетинге.”">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Язык R в интернет маркетинге" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Методичесткое пособие к авторскому курсу Алексея Селезнёва “Язык R в интернет маркетинге.”" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Язык R в интернет маркетинге" />
  
  <meta name="twitter:description" content="Методичесткое пособие к авторскому курсу Алексея Селезнёва “Язык R в интернет маркетинге.”" />
  

<meta name="author" content="Алексей Селезнёв">


<meta name="date" content="2018-11-01">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="c-.html">
<link rel="next" href="-2-api-.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114798296-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-114798296-1');
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Язык R в Интернет Маркетинге</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Описание</a></li>
<li class="chapter" data-level="2" data-path="a-.html"><a href="a-.html"><i class="fa fa-check"></i><b>2</b> a - О курсе</a><ul>
<li class="chapter" data-level="2.1" data-path="a-.html"><a href="a-.html#---"><i class="fa fa-check"></i><b>2.1</b> Для кого этот курс</a></li>
<li class="chapter" data-level="2.2" data-path="a-.html"><a href="a-.html#-----"><i class="fa fa-check"></i><b>2.2</b> Какие знания требуются для прохождения курса</a></li>
<li class="chapter" data-level="2.3" data-path="a-.html"><a href="a-.html#-------"><i class="fa fa-check"></i><b>2.3</b> Какие темы не будут затронуты в ходе курса</a></li>
<li class="chapter" data-level="2.4" data-path="a-.html"><a href="a-.html#------"><i class="fa fa-check"></i><b>2.4</b> Что вы будете уметь поосле проождения курса</a></li>
<li class="chapter" data-level="2.5" data-path="a-.html"><a href="a-.html#-"><i class="fa fa-check"></i><b>2.5</b> Поддержка студентов</a></li>
<li class="chapter" data-level="2.6" data-path="a-.html"><a href="a-.html#-"><i class="fa fa-check"></i><b>2.6</b> Конспект курса</a></li>
<li class="chapter" data-level="2.7" data-path="a-.html"><a href="a-.html#-"><i class="fa fa-check"></i><b>2.7</b> Программа курса</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="b-.html"><a href="b-.html"><i class="fa fa-check"></i><b>3</b> b - Об авторе</a></li>
<li class="chapter" data-level="4" data-path="c-.html"><a href="c-.html"><i class="fa fa-check"></i><b>4</b> c - Благодарности</a></li>
<li class="chapter" data-level="5" data-path="-1-r-.html"><a href="-1-r-.html"><i class="fa fa-check"></i><b>5</b> Модуль 1: Введение в R.</a><ul>
<li class="chapter" data-level="5.1" data-path="-1-r-.html"><a href="-1-r-.html#---r"><i class="fa fa-check"></i><b>5.1</b> История создания языка R</a></li>
<li class="chapter" data-level="5.2" data-path="-1-r-.html"><a href="-1-r-.html#--r."><i class="fa fa-check"></i><b>5.2</b> Преимущества языка R.</a></li>
<li class="chapter" data-level="5.3" data-path="-1-r-.html"><a href="-1-r-.html#--r----rstudio"><i class="fa fa-check"></i><b>5.3</b> Установка языка R и среды разработки RStudio</a><ul>
<li class="chapter" data-level="5.3.1" data-path="-1-r-.html"><a href="-1-r-.html#---r--rstudio"><i class="fa fa-check"></i><b>5.3.1</b> Ссылки для загрузки R и RStudio</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="-1-r-.html"><a href="-1-r-.html#------power-bi---r-."><i class="fa fa-check"></i><b>5.4</b> Загрузка, преобразование и визуализация данных в Power BI с помощью R скриптов.</a><ul>
<li class="chapter" data-level="5.4.1" data-path="-1-r-.html"><a href="-1-r-.html#---power-bi."><i class="fa fa-check"></i><b>5.4.1</b> Загрузка данных в Power BI.</a></li>
<li class="chapter" data-level="5.4.2" data-path="-1-r-.html"><a href="-1-r-.html#---power-bi-power-query."><i class="fa fa-check"></i><b>5.4.2</b> Преобразование данных в Power BI (power query).</a></li>
<li class="chapter" data-level="5.4.3" data-path="-1-r-.html"><a href="-1-r-.html#---power-bi------r."><i class="fa fa-check"></i><b>5.4.3</b> Визуализация данных в Power BI с помощью визуального элемента скрипта R.</a></li>
<li class="chapter" data-level="5.4.4" data-path="-1-r-.html"><a href="-1-r-.html#---power-bi--r-."><i class="fa fa-check"></i><b>5.4.4</b> Использование пользовательских параметров Power BI в R скриптах.</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="-1-r-.html"><a href="-1-r-.html#--rstudio"><i class="fa fa-check"></i><b>5.5</b> Среда разработки RStudio</a></li>
<li class="chapter" data-level="5.6" data-path="-1-r-.html"><a href="-1-r-.html#----r"><i class="fa fa-check"></i><b>5.6</b> Классы объектов в языке R</a><ul>
<li class="chapter" data-level="5.6.1" data-path="-1-r-.html"><a href="-1-r-.html#section-5.6.1"><i class="fa fa-check"></i><b>5.6.1</b> Векторы</a></li>
<li class="chapter" data-level="5.6.2" data-path="-1-r-.html"><a href="-1-r-.html#-data.frame"><i class="fa fa-check"></i><b>5.6.2</b> Таблицы (data.frame)</a></li>
<li class="chapter" data-level="5.6.3" data-path="-1-r-.html"><a href="-1-r-.html#-list"><i class="fa fa-check"></i><b>5.6.3</b> Списки (list)</a></li>
<li class="chapter" data-level="5.6.4" data-path="-1-r-.html"><a href="-1-r-.html#--"><i class="fa fa-check"></i><b>5.6.4</b> Проверить класс объекта</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="-1-r-.html"><a href="-1-r-.html#-----r"><i class="fa fa-check"></i><b>5.7</b> Работа со строками на языке R</a><ul>
<li class="chapter" data-level="5.7.1" data-path="-1-r-.html"><a href="-1-r-.html#-------r"><i class="fa fa-check"></i><b>5.7.1</b> Базовые возможности для работы со строками в R</a></li>
<li class="chapter" data-level="5.7.2" data-path="-1-r-.html"><a href="-1-r-.html#------stringr"><i class="fa fa-check"></i><b>5.7.2</b> Работа со строками с помощью пакета stringr</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="-1-r-.html"><a href="-1-r-.html#---csv-excel--json---r"><i class="fa fa-check"></i><b>5.8</b> Загрузка данных из csv, excel и json файлов в R</a><ul>
<li class="chapter" data-level="5.8.1" data-path="-1-r-.html"><a href="-1-r-.html#---csv-"><i class="fa fa-check"></i><b>5.8.1</b> Загрузка данных из csv файлов</a></li>
<li class="chapter" data-level="5.8.2" data-path="-1-r-.html"><a href="-1-r-.html#---excel-"><i class="fa fa-check"></i><b>5.8.2</b> Загрузка данных из Excel файлов</a></li>
<li class="chapter" data-level="5.8.3" data-path="-1-r-.html"><a href="-1-r-.html#---json-"><i class="fa fa-check"></i><b>5.8.3</b> Загрузка данных из JSON файлов</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="-1-r-.html"><a href="-1-r-.html#------r"><i class="fa fa-check"></i><b>5.9</b> Агрегирующие функции и арифметические операции в R</a></li>
<li class="chapter" data-level="5.10" data-path="-1-r-.html"><a href="-1-r-.html#-----."><i class="fa fa-check"></i><b>5.10</b> Манипуляция с данными, (группировка и агреция).</a><ul>
<li class="chapter" data-level="5.10.1" data-path="-1-r-.html"><a href="-1-r-.html#-dplyr"><i class="fa fa-check"></i><b>5.10.1</b> Пакет dplyr</a></li>
<li class="chapter" data-level="5.10.2" data-path="-1-r-.html"><a href="-1-r-.html#-data.table"><i class="fa fa-check"></i><b>5.10.2</b> Пакет data.table</a></li>
<li class="chapter" data-level="5.10.3" data-path="-1-r-.html"><a href="-1-r-.html#-sqldf"><i class="fa fa-check"></i><b>5.10.3</b> Пакет sqldf</a></li>
<li class="chapter" data-level="5.10.4" data-path="-1-r-.html"><a href="-1-r-.html#-tidyr"><i class="fa fa-check"></i><b>5.10.4</b> Пакет tidyr</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="-1-r-.html"><a href="-1-r-.html#------r--lubridate."><i class="fa fa-check"></i><b>5.11</b> Работа с датами и временем в R, пакет lubridate.</a><ul>
<li class="chapter" data-level="5.11.1" data-path="-1-r-.html"><a href="-1-r-.html#---------r"><i class="fa fa-check"></i><b>5.11.1</b> Базовые возможности по работе с датой и временем в R</a></li>
<li class="chapter" data-level="5.11.2" data-path="-1-r-.html"><a href="-1-r-.html#-lubridate"><i class="fa fa-check"></i><b>5.11.2</b> Пакет lubridate</a></li>
</ul></li>
<li class="chapter" data-level="5.12" data-path="-1-r-.html"><a href="-1-r-.html#--if-ifelse-switch--r"><i class="fa fa-check"></i><b>5.12</b> Условные конструкции if, ifelse, switch в R</a></li>
<li class="chapter" data-level="5.13" data-path="-1-r-.html"><a href="-1-r-.html#-for--while"><i class="fa fa-check"></i><b>5.13</b> Циклы for и while</a><ul>
<li class="chapter" data-level="5.13.1" data-path="-1-r-.html"><a href="-1-r-.html#-for"><i class="fa fa-check"></i><b>5.13.1</b> Цикл for</a></li>
<li class="chapter" data-level="5.13.2" data-path="-1-r-.html"><a href="-1-r-.html#-while"><i class="fa fa-check"></i><b>5.13.2</b> Цикл while</a></li>
</ul></li>
<li class="chapter" data-level="5.14" data-path="-1-r-.html"><a href="-1-r-.html#-----r"><i class="fa fa-check"></i><b>5.14</b> Разработка собственных функций в языке R</a></li>
<li class="chapter" data-level="5.15" data-path="-1-r-.html"><a href="-1-r-.html#---r--try"><i class="fa fa-check"></i><b>5.15</b> Обработка ошибок в R, функция try</a></li>
<li class="chapter" data-level="5.16" data-path="a-.html"><a href="a-.html#-------"><i class="fa fa-check"></i><b>5.16</b> Рекомендации по оформлению кода для упрощения его читаемости</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="-2-api-.html"><a href="-2-api-.html"><i class="fa fa-check"></i><b>6</b> Модуль 2: Работа с API рекламных площадок.</a><ul>
<li class="chapter" data-level="6.1" data-path="-2-api-.html"><a href="-2-api-.html#--api"><i class="fa fa-check"></i><b>6.1</b> Что такое API</a><ul>
<li class="chapter" data-level="6.1.1" data-path="-2-api-.html"><a href="-2-api-.html#-http-"><i class="fa fa-check"></i><b>6.1.1</b> Типы HTTP запросов</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="-2-api-.html"><a href="-2-api-.html#--api-google-ads"><i class="fa fa-check"></i><b>6.2</b> Работа с API Google Ads</a><ul>
<li class="chapter" data-level="6.2.1" data-path="-2-api-.html"><a href="-2-api-.html#----api-google-ads"><i class="fa fa-check"></i><b>6.2.1</b> Как получить доступ к API Google Ads</a></li>
<li class="chapter" data-level="6.2.2" data-path="-2-api-.html"><a href="-2-api-.html#--api-google-ads"><i class="fa fa-check"></i><b>6.2.2</b> Как устроен API Google Ads</a></li>
<li class="chapter" data-level="6.2.3" data-path="-2-api-.html"><a href="-2-api-.html#-radwords"><i class="fa fa-check"></i><b>6.2.3</b> Пакет RAdwords</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="-2-api-.html"><a href="-2-api-.html#--api--"><i class="fa fa-check"></i><b>6.3</b> Работа с API Яндекс Директ</a><ul>
<li class="chapter" data-level="6.3.1" data-path="-2-api-.html"><a href="-2-api-.html#-ryandexdirect"><i class="fa fa-check"></i><b>6.3.1</b> Пакет ryandexdirect</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="-2-api-.html"><a href="-2-api-.html#--api-facebook"><i class="fa fa-check"></i><b>6.4</b> Работа с API Facebook</a><ul>
<li class="chapter" data-level="6.4.1" data-path="-2-api-.html"><a href="-2-api-.html#---facebook"><i class="fa fa-check"></i><b>6.4.1</b> Создание приложения в Facebook</a></li>
<li class="chapter" data-level="6.4.2" data-path="-2-api-.html"><a href="-2-api-.html#--api-facebook"><i class="fa fa-check"></i><b>6.4.2</b> Авторизация в API Facebook</a></li>
<li class="chapter" data-level="6.4.3" data-path="-2-api-.html"><a href="-2-api-.html#-----facebook"><i class="fa fa-check"></i><b>6.4.3</b> Загрузка объектов из рекламного кабинета Facebook</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="-2-api-.html"><a href="-2-api-.html#--api--vk.com"><i class="fa fa-check"></i><b>6.5</b> Работа с API Вконтакте (vk.com)</a><ul>
<li class="chapter" data-level="6.5.1" data-path="-2-api-.html"><a href="-2-api-.html#-----api-"><i class="fa fa-check"></i><b>6.5.1</b> Создание приложения для работы с API Вконтакте</a></li>
<li class="chapter" data-level="6.5.2" data-path="-2-api-.html"><a href="-2-api-.html#--api-"><i class="fa fa-check"></i><b>6.5.2</b> Авторизация в API Вконтакте</a></li>
<li class="chapter" data-level="6.5.3" data-path="-2-api-.html"><a href="-2-api-.html#--rvkstat"><i class="fa fa-check"></i><b>6.5.3</b> Функции пакета rvkstat</a></li>
<li class="chapter" data-level="6.5.4" data-path="a-.html"><a href="a-.html#-----"><i class="fa fa-check"></i><b>6.5.4</b> Загрузка объектов из рекламного кабинета Вконтакте</a></li>
<li class="chapter" data-level="6.5.5" data-path="a-.html"><a href="a-.html#-----"><i class="fa fa-check"></i><b>6.5.5</b> Загрузка статистики из рекламного кабинета Вконтакте</a></li>
<li class="chapter" data-level="6.5.6" data-path="a-.html"><a href="a-.html#------"><i class="fa fa-check"></i><b>6.5.6</b> Загрузка статистики по сообществам и группам Вконтакте</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="-2-api-.html"><a href="-2-api-.html#--api-mytarget"><i class="fa fa-check"></i><b>6.6</b> Работа с API MyTarget</a><ul>
<li class="chapter" data-level="6.6.1" data-path="-2-api-.html"><a href="-2-api-.html#--api-mytarget"><i class="fa fa-check"></i><b>6.6.1</b> Авторизация в API MyTarget</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="-2-api-.html"><a href="-2-api-.html#---google-analytics"><i class="fa fa-check"></i><b>6.7</b> Загрузка данных из Google Analytics</a><ul>
<li class="chapter" data-level="6.7.1" data-path="-2-api-.html"><a href="-2-api-.html#-api----google-analytics"><i class="fa fa-check"></i><b>6.7.1</b> Какие API интерфейсы доступны в Google Analytics</a></li>
<li class="chapter" data-level="6.7.2" data-path="-2-api-.html"><a href="-2-api-.html#--api-google-analytics"><i class="fa fa-check"></i><b>6.7.2</b> Авторизация в API Google Analytics</a></li>
<li class="chapter" data-level="6.7.3" data-path="-2-api-.html"><a href="-2-api-.html#--management-api"><i class="fa fa-check"></i><b>6.7.3</b> Работа с Management API</a></li>
<li class="chapter" data-level="6.7.4" data-path="-2-api-.html"><a href="-2-api-.html#--core-reporting-api"><i class="fa fa-check"></i><b>6.7.4</b> Работа с Core Reporting API</a></li>
<li class="chapter" data-level="6.7.5" data-path="-2-api-.html"><a href="-2-api-.html#--multi-channel-funnels-api"><i class="fa fa-check"></i><b>6.7.5</b> Работа с Multi-Channel Funnels API</a></li>
<li class="chapter" data-level="6.7.6" data-path="-2-api-.html"><a href="-2-api-.html#--real-time-reporting-api"><i class="fa fa-check"></i><b>6.7.6</b> Работа с Real time reporting API</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="-2-api-.html"><a href="-2-api-.html#---api---yandex-metrica"><i class="fa fa-check"></i><b>6.8</b> Загрузка данных из API Яндекс Метрики, Yandex Metrica</a><ul>
<li class="chapter" data-level="6.8.1" data-path="-2-api-.html"><a href="-2-api-.html#----api--"><i class="fa fa-check"></i><b>6.8.1</b> Авторизация для работы с API Яндекс Метрики</a></li>
<li class="chapter" data-level="6.8.2" data-path="-2-api-.html"><a href="-2-api-.html#----api---"><i class="fa fa-check"></i><b>6.8.2</b> Функции для работы с API управления Яндекс Метрики</a></li>
<li class="chapter" data-level="6.8.3" data-path="-2-api-.html"><a href="-2-api-.html#---api---"><i class="fa fa-check"></i><b>6.8.3</b> Загрузка данных из API отчётов Яндекс Метрики</a></li>
<li class="chapter" data-level="6.8.4" data-path="-2-api-.html"><a href="-2-api-.html#---logs-api--"><i class="fa fa-check"></i><b>6.8.4</b> Загрузка данных из Logs API Яндекс Метрики</a></li>
<li class="chapter" data-level="6.8.5" data-path="-2-api-.html"><a href="-2-api-.html#---api-----core-reporting-api-google-analytics"><i class="fa fa-check"></i><b>6.8.5</b> Загрузка данных из API Яндекс Метрики совместимого с Core Reporting API Google Analytics</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="-2-api-.html"><a href="-2-api-.html#--google-search-console"><i class="fa fa-check"></i><b>6.9</b> Работа с Google Search Console</a><ul>
<li class="chapter" data-level="6.9.1" data-path="-2-api-.html"><a href="-2-api-.html#----5000---1-"><i class="fa fa-check"></i><b>6.9.1</b> Как обойти ограничение в 5000 строк на 1 запрос</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="-2-api-.html"><a href="-2-api-.html#--google-trends"><i class="fa fa-check"></i><b>6.10</b> Работа с Google Trends</a><ul>
<li class="chapter" data-level="6.10.1" data-path="-2-api-.html"><a href="-2-api-.html#-----google-trends"><i class="fa fa-check"></i><b>6.10.1</b> Манипуляция с данными полученными из Google Trends</a></li>
</ul></li>
<li class="chapter" data-level="6.11" data-path="-2-api-.html"><a href="-2-api-.html#---web-scrapping"><i class="fa fa-check"></i><b>6.11</b> Парсинг веб сайтов, Web scrapping</a><ul>
<li class="chapter" data-level="6.11.1" data-path="-1-r-.html"><a href="-1-r-.html#----"><i class="fa fa-check"></i><b>6.11.1</b> Поиск элементов на веб странице</a></li>
<li class="chapter" data-level="6.11.2" data-path="-2-api-.html"><a href="-2-api-.html#-----html-"><i class="fa fa-check"></i><b>6.11.2</b> Извлечение значений из полученныз элементов HTML страницы</a></li>
<li class="chapter" data-level="6.11.3" data-path="a-.html"><a href="a-.html#---"><i class="fa fa-check"></i><b>6.11.3</b> Имитация пользовательской веб сессии</a></li>
</ul></li>
<li class="chapter" data-level="6.12" data-path="-2-api-.html"><a href="-2-api-.html#-http-"><i class="fa fa-check"></i><b>6.12</b> отправка HTTP запросов</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="-3-api-.html"><a href="-3-api-.html"><i class="fa fa-check"></i><b>7</b> Модуль 3: Работа с загруженными из API интерфейсов различных сервисов данными.</a><ul>
<li class="chapter" data-level="7.1" data-path="-3-api-.html"><a href="-3-api-.html#-----google---googlesheets"><i class="fa fa-check"></i><b>7.1</b> Отправка и чтение данных из Google Таблиц, пакет googlesheets</a></li>
<li class="chapter" data-level="7.2" data-path="-3-api-.html"><a href="-3-api-.html#-----ggplot2"><i class="fa fa-check"></i><b>7.2</b> Визуализация данных с помощью пакета ggplot2</a><ul>
<li class="chapter" data-level="7.2.1" data-path="-3-api-.html"><a href="-3-api-.html#---qplot"><i class="fa fa-check"></i><b>7.2.1</b> Быстрый график, функция <code>qplot</code></a></li>
<li class="chapter" data-level="7.2.2" data-path="a-.html"><a href="a-.html#---"><i class="fa fa-check"></i><b>7.2.2</b> Построение графиков наложением слоёв</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="-3-api-.html"><a href="-3-api-.html#----dbi-------"><i class="fa fa-check"></i><b>7.3</b> Работа с базами данных, DBI - Интерфейс взаимодействия с базами данных</a><ul>
<li class="chapter" data-level="7.3.1" data-path="-3-api-.html"><a href="-3-api-.html#---mysql"><i class="fa fa-check"></i><b>7.3.1</b> Работа с СУБД MySQL</a></li>
<li class="chapter" data-level="7.3.2" data-path="-3-api-.html"><a href="-3-api-.html#----postgresql"><i class="fa fa-check"></i><b>7.3.2</b> Работа с базой данных PostgreSQL</a></li>
<li class="chapter" data-level="7.3.3" data-path="-3-api-.html"><a href="-3-api-.html#----sqlite"><i class="fa fa-check"></i><b>7.3.3</b> Работа с базой данных SQLite</a></li>
<li class="chapter" data-level="7.3.4" data-path="-3-api-.html"><a href="-3-api-.html#-----google-bigquery"><i class="fa fa-check"></i><b>7.3.4</b> Работа с облачной базой данных Google BigQuery</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="-3-api-.html"><a href="-3-api-.html#----r--mailr"><i class="fa fa-check"></i><b>7.4</b> Отправка почты с помощью R, пакет mailR</a></li>
<li class="chapter" data-level="7.5" data-path="-3-api-.html"><a href="-3-api-.html#---r---"><i class="fa fa-check"></i><b>7.5</b> Как настроить запуск R скриптов по рассписанию</a><ul>
<li class="chapter" data-level="7.5.1" data-path="a-.html"><a href="a-.html#---"><i class="fa fa-check"></i><b>7.5.1</b> Настройка расписание через плагин</a></li>
<li class="chapter" data-level="7.5.2" data-path="-3-api-.html"><a href="-3-api-.html#------taskscheduler"><i class="fa fa-check"></i><b>7.5.2</b> Настройка расписание с помощью функций пакета taskscheduleR</a></li>
<li class="chapter" data-level="7.5.3" data-path="-3-api-.html"><a href="-3-api-.html#------windows"><i class="fa fa-check"></i><b>7.5.3</b> Ручная настройка рассписания через планировщик задач Windows</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="-r-r-sources.html"><a href="-r-r-sources.html"><i class="fa fa-check"></i><b>8</b> Полезные, русскоязычные ресурсы по языку R (r sources)</a><ul>
<li class="chapter" data-level="8.1" data-path="-r-r-sources.html"><a href="-r-r-sources.html#----groups"><i class="fa fa-check"></i><b>8.1</b> Группы в социальных сетях, groups</a></li>
<li class="chapter" data-level="8.2" data-path="-r-r-sources.html"><a href="-r-r-sources.html#telegram---"><i class="fa fa-check"></i><b>8.2</b> Telegram каналы и чаты</a></li>
<li class="chapter" data-level="8.3" data-path="-r-r-sources.html"><a href="-r-r-sources.html#-blogs"><i class="fa fa-check"></i><b>8.3</b> Блоги, blogs</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Язык R в интернет маркетинге</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="-1---r." class="section level1">
<h1><span class="header-section-number">5</span> Модуль 1: Введение в R.</h1>
<p>Первый модуль курса посвящён введению в язык R, в ходе модуля рассматривается следующие темы:</p>
<ul>
<li>История, возможности, преимущества и недостатки языка R.</li>
<li>Загрузка и установка языка R и среды разработки RStudio.</li>
<li>Области применения R скриптов в Power BI.</li>
<li>Знакомство со средой разработки RStudio.</li>
<li>Основные классы объектов в R
<ul>
<li>Векторы в R, что такое вектор, как обращаться к элементам вектора, основные типы данных в R.</li>
<li>Data frame, основной класс объектов в R, как выбирать столбцы, строки, проводить расчёты.</li>
<li>List - Списки.</li>
</ul></li>
<li>R пакеты.
<ul>
<li>Как упростить и ускорить работу с таблицами с помощью пакета data.table.</li>
<li>Манипуляция с данными с помощью пакета dplyr.</li>
<li>Преобразование данных с помощью пакета tidyr.</li>
</ul></li>
<li>Циклы в R (for и while), синтаксис, пример использования.</li>
</ul>
<div id="---r" class="section level2">
<h2><span class="header-section-number">5.1</span> История создания языка R</h2>
<p>Язык R был разработан в 1993 году сотрудниками статистического факультета Оклендского университета Россом Айхэкой (англ. Ross Ihaka) и Робертом Джентлменом (англ. Robert Gentleman) (первая буква их имён — R), для для статистической обработки данных и работы с графикой.</p>
<p>Долгие годы R использовался исключительно в исследовательских институтах для статического анализа данных, в бизнес и маркетинг этот язык просочился уже ближе к 2010 году.</p>
<p>Именно в 2010 году R вошёл в список победителей конкурса журнала Infoworld[en] в номинации на лучшее открытое программное обеспечение для разработки приложений.</p>
</div>
<div id="--r." class="section level2">
<h2><span class="header-section-number">5.2</span> Преимущества языка R.</h2>
<ul>
<li>R является Свободным программным обеспечением.</li>
<li>R — это очень общий пакет статистического анализа, включает длинный список функций и пакетов, написанных пользователями. Смотрите: CRAN Contributed packages(англ.).</li>
<li>R доступен для всех операционных систем, включая Linux, Mac OS, Windows.</li>
<li>R включает самые последние методики.</li>
<li>R — объектно ориентированный. Теоретически, всё что угодно может быть сохранено как объект R.</li>
<li>Для пользователей умеющих писать более не менее сложные формулы в Ecxel перейти в R будет первое время непривычно но не сложно.</li>
<li>Язык R предоставляет пользователю практически неограниченные возможности для визуализации данных.</li>
<li>Поскольку R является любимым языком профессиональных статистиков, все последние достижения статистической науки очень быстро становятся доступными для пользователей R во всем мире в виде дополнительных библиотек. Ни одна коммерческая система статистического анализа так быстро сегодня не развивается.</li>
</ul>
</div>
<div id="--r----rstudio" class="section level2">
<h2><span class="header-section-number">5.3</span> Установка языка R и среды разработки RStudio</h2>
<p>Процесс установки языка R и RStudio достаточно прост и не требует никаких дополнительных манипуляций, нет никакой необходимости менять какие либо настройки в мастере установки.</p>
<div id="---r--rstudio" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Ссылки для загрузки R и RStudio</h3>
<ul>
<li>R для Windows - <a href="https://cran.r-project.org/bin/windows/base/" class="uri">https://cran.r-project.org/bin/windows/base/</a></li>
<li>RStudio - <a href="https://www.rstudio.com/products/rstudio/download/" class="uri">https://www.rstudio.com/products/rstudio/download/</a></li>
</ul>
</div>
</div>
<div id="------power-bi---r-." class="section level2">
<h2><span class="header-section-number">5.4</span> Загрузка, преобразование и визуализация данных в Power BI с помощью R скриптов.</h2>
<div id="---power-bi." class="section level3">
<h3><span class="header-section-number">5.4.1</span> Загрузка данных в Power BI.</h3>
<p>Для загрузки данных с применением R скриптов перейдите в Power BI в диалоговое окно “Получить данные”, перейдите в группу “Другое”, выберите из доступных коннекторов “R-скрипт” и нажмите кнопку “Подключится”.</p>
<div class="figure">
<img src="http://img.netpeak.ua/alsey/153243942061_kiss_23kb.png" alt="Окно Получить данные в Power BI" />
<p class="caption">Окно “Получить данные” в Power BI</p>
</div>
<p>После чего попав в диалоговое окно “R-скрипт” введите следующий код для загрузки данных из csv файла, при использовании приведённого ниже кода необходимо прописать путь к файлу name_values.csv, там куда вы распаковали материали курса:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Загрузка таблицы данных</span>
my_data &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file =</span> <span class="st">&quot;C:/r_for_marketing_course/Материалы курса/Модуль 1/Урок 3/name_values.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="figure">
<img src="http://img.netpeak.ua/alsey/153243989514_kiss_10kb.png" alt="Загрузка данных в Power BI" />
<p class="caption">Загрузка данных в Power BI</p>
</div>
<p><strong>Помните что обратный слеш (\) в R используется для экранирования символов, поэтому при прописывании пути к файлу необходимо использовать либо прямой слэш (/), либо двойной обратный слэш (\\)</strong>.</p>
</div>
<div id="---power-bi-power-query." class="section level3">
<h3><span class="header-section-number">5.4.2</span> Преобразование данных в Power BI (power query).</h3>
<p><strong>Задача:</strong> Необходимо обезличить данные, загруженные на прошлом шаге, в загруженной таблице есть 3 поля: ID, Name, Value, задача заключается в том, что бы заменить все имена на user_номер пользователя. <img src="http://img.netpeak.ua/alsey/153252345198_kiss_70kb.png" alt="задача по обезличиванию данных в таблице" /></p>
<p>Для решения задачи нам необходимо перейти в редактор запросов, далее перейти на вкладку “Преобразование”, и ажать кнопку “Запустить сценарий R”: <img src="http://img.netpeak.ua/alsey/153244043864_kiss_37kb.png" alt="Редактор запросов" /></p>
<p>Далее в окне “Запустить сценарий R” воспроизвести следующий код:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># &#39;dataset&#39; содержит входные данные для этого сценария</span>
<span class="co"># Копируем входящие данные в дата фрейм my_data</span>
my_data &lt;-<span class="st"> </span>dataset

<span class="co"># Создаём таблицу Id пользователей</span>
user_id &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Name =</span> <span class="kw">unique</span>(my_data<span class="op">$</span>Name), <span class="dt">user_id =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(my_data<span class="op">$</span>Name)))

<span class="co"># Соединяем таблицу данных с таблицей Id пользователей</span>
my_data &lt;-<span class="st"> </span><span class="kw">merge</span>(<span class="dt">x =</span> my_data, <span class="dt">y =</span> user_id, <span class="dt">by =</span> <span class="st">&quot;Name&quot;</span>, <span class="dt">all.x =</span> <span class="ot">TRUE</span>)

<span class="co"># Удаляем столбец с именами </span>
my_data<span class="op">$</span>Name &lt;-<span class="st"> </span><span class="ot">NULL</span>

<span class="co"># Добавляем к id пользователя суфикс</span>
my_data<span class="op">$</span>user_id &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;user_&quot;</span>, my_data<span class="op">$</span>user_id)

<span class="co"># Удаляем таблицу id пользователей</span>
<span class="kw">rm</span>(user_id)</code></pre></div>
</div>
<div id="---power-bi------r." class="section level3">
<h3><span class="header-section-number">5.4.3</span> Визуализация данных в Power BI с помощью визуального элемента скрипта R.</h3>
<p>Среди доступных визуальных элементов в Power BI есть элемент который называется “Визуальный элемент скрипта R”. <img src="http://img.netpeak.ua/alsey/153244591189_kiss_9kb.png" alt="Визуальный элемент скрипта R" /></p>
<p>Выбирите данный визуальный элемент и перенестине в область значений все поля из загруженной на прошлом шаге таблице, т.е. поля Id, user_id и Value. <img src="http://img.netpeak.ua/alsey/153244607988_kiss_14kb.png" alt="Визуальный элемент скрипта R" /></p>
<p><strong>Необходимо помнить</strong> о том, что дубли строк обрабатываемой данным визуальным элементом таблицы будут удалены, избежать этого можно с помощью индексированного столбца, в нашем случае таким столбцом является поле Id, для того, что бы не удалять из таблицы нужные нам строки необходимо убрать агрегацию по столбцу Id. <img src="bookdown-demo_files\figure-html\remove_agg.gif" alt="Удаление агрегация по индексированному столбцу" /></p>
<p>Код для построения график ящик с усами:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(<span class="dt">data =</span> dataset, Value <span class="op">~</span><span class="st"> </span>user_id)</code></pre></div>
<p>Запись <code>Value ~ user_id</code> является формулой, с левой стороны от тильды записывается количественная переменная (Value), с правой стороны качественная переменная (user_id), если вы сделали всё верно на трёх предыдущих шагах, загрузили, преобразовали и визуализировали данные из файла <em>name_values.csv</em> в Power BI вы должны получить получить следующий результат, в случае если у вас что либо не получилось можно посмотреть готовый результат в файле <em>m1_l3 - demo name_values</em>.</p>
<div class="figure">
<img src="http://img.netpeak.ua/alsey/153244695329_kiss_17kb.png" alt="Результат который вы должны получить в ходе выполнения 3го урока" />
<p class="caption">Результат который вы должны получить в ходе выполнения 3го урока</p>
</div>
</div>
<div id="---power-bi--r-." class="section level3">
<h3><span class="header-section-number">5.4.4</span> Использование пользовательских параметров Power BI в R скриптах.</h3>
<p>В Power BI при загрузки и преобразования данных с помщью R скриптов есть возможность передавать значение созданных вами параметров, для этого сначала необходимо создать параметры, значения которых вы в дальнейшем будете использовать в R скриптах.</p>
<p><strong>Задача:</strong> Создать два параметра, с помощью первого параметра мы будем менять файл из которого загружаем данные, с помощью второго можно будет менять используемый ранее префикс “user_” на любой другой.</p>
<p>Создать параметры можно перейдя в редактор запросов.</p>
<div class="figure">
<img src="http://img.netpeak.ua/alsey/153252130407_kiss_20kb.png" alt="Создание параметров в Power BI" />
<p class="caption">Создание параметров в Power BI</p>
</div>
<p>Создав два параметра <em>file_name</em> и <em>prefix_name</em>, Выбираем запрос <em>my_data</em>, внутри которого будем использовать созданные параметры и переходим в расширенный редактор запросов.</p>
<div class="figure">
<img src="http://img.netpeak.ua/alsey/153252160734_kiss_50kb.png" alt="Переход в расширенный редактор запросов" />
<p class="caption">Переход в расширенный редактор запросов</p>
</div>
<p>В запросе <em>my_data</em> мы дважды используем сценарий R, первый раз для загрузки данных, второй раз для их преобразования, соответвенно первый созданный параметр <em>file_name</em> мы будем использовать в части скрипта которая отвечает за загрузку данных, а параметр <em>prefix_name</em> в части скрипта преобразующего данные.</p>
<div class="figure">
<img src="http://img.netpeak.ua/alsey/153252213459_kiss_24kb.png" alt="Поиск необходимой части скрипта загрузки и преобразования данных" />
<p class="caption">Поиск необходимой части скрипта загрузки и преобразования данных</p>
</div>
<p>Для использования значений параметров внутри R скриптов достаточно с помощью функции <code>Text.From</code> языка M получить текстовое значение параметра и конкатенировать его в текст запроса с помощью символа <em>&amp;</em>.</p>
<div class="figure">
<img src="http://img.netpeak.ua/alsey/153252245442_kiss_12kb.png" alt="Пример конкатенации значения параметра в R скрипт" />
<p class="caption">Пример конкатенации значения параметра в R скрипт</p>
</div>
</div>
</div>
<div id="--rstudio" class="section level2">
<h2><span class="header-section-number">5.5</span> Среда разработки RStudio</h2>
<p>Среда разработки RStudio состоит из 4ёх диалоговы окон. <img src="http://img.netpeak.ua/alsey/153252387343_kiss_68kb.png" alt="Интерфейс RStudio" /></p>
<ul>
<li><strong>Редактор скриптов</strong>, предназначени для разработки и отладки кода, работая в этом окне удобно запускать отдельные части кода, искать нужные части кода, в этом окне удобно работает дополнение кода.</li>
<li><strong>Консоль</strong>, в консоли выводятся все запускаемые вами команды и результат их выполнения включая сообщения об ошибках при их возникновении.</li>
<li><strong>Рабочее окружение</strong>, в данном диалоговом окне вы можете найти все объекты оторые были созданны вами в ходе R сессии, в зависимости от класса объекта вы так же можнтн либо перейти к его детальному просмотру, либо получить какую либо дополнительную информацию по любому из объектов.</li>
<li><strong>Справка и визуализация</strong>, в данном окне выводится вся запрашиваемая вами справочничная информаци, а так же визуализация данных внутри R.</li>
</ul>
<p><strong>Важно:</strong> Вы можете в любой момент получить справку по любой функции языка R с помощью команды <code>?имя_функции</code>.</p>
</div>
<div id="----r" class="section level2">
<h2><span class="header-section-number">5.6</span> Классы объектов в языке R</h2>
<p>В языке R существует достаточно много классов объектов, но как правило используется 3: Вектор, Дата фрейм и Список.</p>
<div id="section-5.6.1" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Векторы</h3>
<p>Вектор это объект содержащий набор элементов одного типа, вы не можете хранить в одном векторе элементы имеющие разный тип данных, например число и текст.</p>
<div id="-" class="section level4">
<h4><span class="header-section-number">5.6.1.1</span> Создание вектора</h4>
<p>В R есть довольно много способов создания векторов, но наиболее простым и используемым является использование функции <code>c</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># создание тектового вектора</span>
names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Алексей&quot;</span>, <span class="st">&quot;Денис&quot;</span>, <span class="st">&quot;Николай&quot;</span>, <span class="st">&quot;Виктор&quot;</span>, <span class="st">&quot;Денис&quot;</span>) 
country &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;RU&quot;</span>, <span class="st">&quot;UA&quot;</span>, <span class="st">&quot;KZ&quot;</span>, <span class="st">&quot;BY&quot;</span>, <span class="st">&quot;BG&quot;</span>, <span class="st">&quot;BR&quot;</span>, <span class="st">&quot;TR&quot;</span>, <span class="st">&quot;US&quot;</span>, <span class="st">&quot;CA&quot;</span>)

age &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">34</span>, <span class="dv">25</span>, <span class="dv">39</span>, <span class="dv">30</span>, <span class="dv">28</span>)                        <span class="co"># создание числового вектора</span>
nums &lt;-<span class="st"> </span><span class="dv">5</span><span class="op">:</span><span class="dv">20</span>                                        <span class="co"># создание вектора из простой последовательсти чисел</span>
nums &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">5</span>, <span class="dt">to =</span> <span class="dv">20</span>)                      
nums_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">5</span>, <span class="dt">to =</span> <span class="dv">20</span>, <span class="dt">by =</span> <span class="dv">2</span>)            <span class="co"># создание вектора из последовательности чисел с определённым шагом</span>
nums_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">5</span>, <span class="dt">to =</span> <span class="dv">20</span>, <span class="dt">length.out =</span> <span class="dv">9</span>)    <span class="co"># создание последновательсти чисел определённой длинны</span>

<span class="co"># создание вектора с именоваными элементами</span>
name_vector &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">name =</span> <span class="st">&quot;Алексей&quot;</span>, <span class="dt">age =</span> <span class="dv">34</span>, <span class="dt">company =</span> <span class="st">&quot;Netpeak&quot;</span>)</code></pre></div>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">5.6.1.2</span> Обращение к элементам вектора</h4>
<p>ПОлучить один или несколько конкретных элементов вектора можно несколькими способами, по индексу, явно указав какие элементы вам нужны с помозью TRUE / FALSE, задав логическое выражение для фильтрации элементов вектора либо по именам в случае если вектор имеет иненованые элементы.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">names[<span class="dv">2</span>]                           <span class="co"># значение по его индексу</span>
names[<span class="op">-</span><span class="dv">4</span>]                          <span class="co"># исключить значения по индексу</span>
names[<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)]                      <span class="co"># нескоько значений по индексам</span>
names[<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>)]  <span class="co"># с помощью логического TRUE / FALSE</span>
name_vector[<span class="st">&quot;company&quot;</span>]             <span class="co"># зачение по его имени</span>
age[ age <span class="op">&gt;</span><span class="st"> </span><span class="dv">31</span> ]                    <span class="co"># через логическое выражение</span>
<span class="kw">which</span>(age <span class="op">&gt;</span><span class="st"> </span><span class="dv">31</span>)                    <span class="co"># получить индексы элементов по логическому выражению</span></code></pre></div>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">5.6.1.3</span> Свойства вектора</h4>
<p>С помощью ряда функций вы можете получить свойства вектора, например такие как длинна, тип данных или имена элементов.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(nums_<span class="dv">3</span>)       <span class="co"># получить тип данных</span>
<span class="kw">class</span>(age)

<span class="kw">length</span>(names)       <span class="co"># получить количество элементов</span>
<span class="kw">names</span>(name_vector)  <span class="co"># получить имена элементов</span></code></pre></div>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">5.6.1.4</span> Манипуляция с элементами вектора</h4>
<p>С элементами вектора можно проводить люые манипуляции, сортировать, делать случайные выборки элементов и объенять несколько векторов в один.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sort</span>(country)                      <span class="co"># сортировка элементов вектора по возрастанию</span>
<span class="kw">sort</span>(country, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)   <span class="co"># сортировка элементов вектора по убыванию</span>
<span class="kw">unique</span>(names)                      <span class="co"># получить список уникальных элементов вектора</span>

<span class="kw">sample</span>(<span class="dt">x       =</span> country,          <span class="co"># выборка случайных элементов из вектора</span>
       <span class="dt">size    =</span> <span class="dv">8</span>, 
       <span class="dt">replace =</span> F)                <span class="co"># replace управляет возможность повтора элементов</span>

<span class="kw">c</span>(age, nums)                       <span class="co"># объеденение двух векторов </span></code></pre></div>
<p>Функция <em>sample</em> позволяет получить набор случайных элементов из вектора, аргумент <em>size</em> отвечает за количество элементов которые вернёт функция, аргумент <em>replace</em> позволяет запретить отбирать один и тот же элемент вектора несколько раз.</p>
</div>
<div id="----" class="section level4">
<h4><span class="header-section-number">5.6.1.5</span> Логические операция с элементами векторов</h4>
<p>Все операции сравнения над векторами зациклены, т.е. даже если вы будете сравнивать между собой элементы двух векторов разной длинны то в ходе сравнения элементов более длинного вектора начнут сравниваться с начальными элементами короткого вектора.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vec1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">9</span>)
vec2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">10</span>)

vec1 <span class="op">&gt;</span><span class="st"> </span>vec2

vec1 <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;</span><span class="st"> </span>vec1 <span class="op">&lt;</span><span class="st"> </span><span class="dv">9</span> <span class="co"># пример логического и</span>
vec1 <span class="op">&lt;</span><span class="st"> </span><span class="dv">8</span> <span class="op">|</span><span class="st"> </span>vec1 <span class="op">&gt;</span><span class="st"> </span><span class="dv">8</span> <span class="co"># пример логического или</span></code></pre></div>
<p>Для более сложных операций сравнения в которы необходимо использовать логические операторы <em>И</em> и <em>ИЛИ</em> следует использовать одиночные знаки. <strong>&amp;</strong> - И <strong>|</strong> - ИЛИ</p>
</div>
</div>
<div id="-data.frame" class="section level3">
<h3><span class="header-section-number">5.6.2</span> Таблицы (data.frame)</h3>
<p>Объекты касса data.frame являются привычными для вас двухмерными таблицами, по сути таблица это набор векторов одинаковой длинны, каждое поле таблицы может содержать данные только одного типа, так же как и вектора.</p>
<div id="-" class="section level4">
<h4><span class="header-section-number">5.6.2.1</span> Создание таблицы</h4>
<p>Создавать таблицы можно с помощью функции data.frame, каждое поле таблицы является вектором и может содержать данные одного типа, все векторы из которых состоят поля таблицы должны быть одинаковой длинны.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Пример создание таблицы пользователей</span>
users &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Names      =</span> names,
                    <span class="dt">Age        =</span> age,
                    <span class="dt">Country_id =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(country),
                                        <span class="dt">size =</span> <span class="kw">length</span>(names), 
                                        <span class="dt">replace =</span> T),
                    <span class="dt">Id         =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(names))

<span class="co"># Создаём таблицу - справочник стран</span>
country_dicy &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id           =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(country),
                           <span class="dt">country_name =</span> <span class="kw">sort</span>(country))</code></pre></div>
<p>В приведённом примере мы создали две таблицы:</p>
<ul>
<li>users - таблица состоит из 4 полей (Names, Age, Country_id, Id).</li>
<li>country_dicy - таблица состоит из двух полей (id, country_name).</li>
</ul>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">5.6.2.2</span> Обращение к элементам таблицы</h4>
<p>Образаться к любым элементам таблицы, строкам или столбцам, можно либо по индексу либо по имени, для получения какого либо элемента необходимо написать название таблицы, открыть квадратные скобки и указать сначала строки и после запятой столбцы которые вам необходимо получить.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">users[<span class="dv">3</span>, ]                    <span class="co"># получить 3 строку</span>
users[<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>, ]                  <span class="co"># получить 2-4 строку по номеру</span>
users[, <span class="dv">2</span>]                    <span class="co"># получить 2 столбец</span>
users[[<span class="st">&quot;Age&quot;</span>]]                <span class="co"># получить столбец по имени</span>
users<span class="op">$</span>Age                     <span class="co"># получить столбец по имени</span>
users[, <span class="kw">c</span>(<span class="st">&quot;Names&quot;</span>, <span class="st">&quot;Id&quot;</span>)]     <span class="co"># получить несколько столбцов по имени</span>
users[, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)]              <span class="co"># получить несколько столбцов по номерам</span>

users[ users<span class="op">$</span>Age <span class="op">&gt;</span><span class="st"> </span><span class="dv">30</span>, ]      <span class="co"># получить строки по логическому выражению</span>
users<span class="op">$</span>Names[ users<span class="op">$</span>Age <span class="op">&gt;</span><span class="st"> </span><span class="dv">30</span> ] <span class="co"># получить значения одного поля, по лог выражению другого поля</span>

<span class="kw">head</span>(users, <span class="dt">n =</span> <span class="dv">3</span>)            <span class="co"># получить верхние 3 строки таблицы</span>
<span class="kw">tail</span>(users, <span class="dt">n =</span> <span class="dv">3</span>)            <span class="co"># получить нижние три строки таблицы</span></code></pre></div>
</div>
<div id="-----" class="section level4">
<h4><span class="header-section-number">5.6.2.3</span> Просмотрт структуры и описательных статистик таблиц</h4>
<p>Просмотр структуры таблицы, т.е. информации о том какие поля есть в таблице, и данные какого типа в каком поле храняться можно с помощью функции str.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(users) <span class="co"># структура таблицы</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    5 obs. of  4 variables:
##  $ Names     : Factor w/ 4 levels &quot;Алексей&quot;,&quot;Виктор&quot;,..: 1 3 4 2 3
##  $ Age       : num  34 25 39 30 28
##  $ Country_id: int  9 4 2 6 7
##  $ Id        : int  1 2 3 4 5</code></pre>
<p>Получить описательные стаистики количественнх переменных и информацию о качественных переменных можно с помощью команды summary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(users)    <span class="co"># описательные таблицы</span></code></pre></div>
<pre><code>##      Names        Age         Country_id        Id   
##  Алексей:1   Min.   :25.0   Min.   :2.0   Min.   :1  
##  Виктор :1   1st Qu.:28.0   1st Qu.:4.0   1st Qu.:2  
##  Денис  :2   Median :30.0   Median :6.0   Median :3  
##  Николай:1   Mean   :31.2   Mean   :5.6   Mean   :3  
##              3rd Qu.:34.0   3rd Qu.:7.0   3rd Qu.:4  
##              Max.   :39.0   Max.   :9.0   Max.   :5</code></pre>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">5.6.2.4</span> Сортировка таблц</h4>
<p>Сортировка таблиц осуществляется с помощью функции order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Сортировка таблиц</span>
users[ <span class="kw">order</span>( users<span class="op">$</span>Age, <span class="dt">decreasing =</span> T), ]</code></pre></div>
</div>
<div id="--" class="section level4">
<h4><span class="header-section-number">5.6.2.5</span> Создание поднаборов таблиц</h4>
<p>Для создания поднабора данных в R существует функция subset, в которой вы может задать условия фильтрации по различным полям таблицы объединив несклько условий логическими <em>И</em> или <em>ИЛИ</em>, при этом <strong>следует использовать одиночные логические операторы (&amp;, |)</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Выбираем поднабор состоящий из пользователей от 30 лет и старше</span>
users_after_<span class="dv">30</span> &lt;-<span class="st"> </span><span class="kw">subset</span>(<span class="dt">x =</span> users, Age <span class="op">&gt;</span><span class="st"> </span><span class="dv">30</span>, <span class="dt">select =</span> <span class="kw">c</span>(Id, Names))
<span class="co"># Выбираем пользователейв имени которых присутвует буква &quot;к&quot; и количество букв в имени более 5</span>
users_i        &lt;-<span class="st"> </span><span class="kw">subset</span>(<span class="dt">x =</span> users, 
                         <span class="kw">grepl</span>(<span class="dt">x =</span> users<span class="op">$</span>Names, <span class="dt">pattern =</span> <span class="st">&quot;к&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="kw">nchar</span>(<span class="kw">as.character</span>(users<span class="op">$</span>Names)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>, 
                         <span class="dt">select =</span> <span class="kw">c</span>(Id, Names))</code></pre></div>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">5.6.2.6</span> Объединение таблиц</h4>
<p>Для объединения таблиц служат следующие 3 функции: + <strong>rbind</strong> - Соединение таблиц по строкам + <strong>cbind</strong> - Соединение таблиц по столцам + <strong>merge</strong> - Соединение таблиц по ключу</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">users_two      &lt;-<span class="st"> </span><span class="kw">rbind</span>(users_after_<span class="dv">30</span>, users_i) <span class="co"># объединения таблиц по строкам</span>
users_three    &lt;-<span class="st"> </span><span class="kw">cbind</span>(users_after_<span class="dv">30</span> ,users_i) <span class="co"># объединение таблиц по столбцам</span>

<span class="co"># Объединение таблиц по ключу</span>
<span class="co"># Соединяем таблицу пользователей со справочником по id страны</span>
user_resul &lt;-<span class="st"> </span><span class="kw">merge</span>(<span class="dt">x =</span> users,           <span class="co"># левая таблица </span>
                    <span class="dt">y =</span> country_dicy,    <span class="co"># правая таблица</span>
                    <span class="dt">by.x =</span> <span class="st">&quot;Country_id&quot;</span>, <span class="co"># имя поля ключа в левой таблице</span>
                    <span class="dt">by.y =</span> <span class="st">&quot;id&quot;</span>,         <span class="co"># имя поля ключа в правой таблице</span>
                    <span class="dt">all.x =</span> <span class="ot">TRUE</span>)        <span class="co"># тип соединения, в данном случае левое соединение   </span></code></pre></div>
<p>Функция merge предназначена для соединения таблиц по ключам и принимает следующие аргументы: + <strong>x</strong> - левая таблица + <strong>y</strong> - правая таблица + <strong>by.x</strong> - ключи, название ключевых полей в левой таблице, если ключевых полей несколько их необзодимо передать в виде тектового вектора объединив их названия с помощью функции <code>c</code>. + <strong>by.y</strong> - ключи, название ключевых полей в правой таблице, если ключевых полей несколько их необзодимо передать в виде тектового вектора объединив их названия с помощью функции <code>c</code>. + <strong>all.x</strong> или <strong>all.y</strong> - аргументы которые управляют направлением соединения, allx = TRUE означает оставить все строки левой таблицы, т.е. левое соединение.</p>
</div>
</div>
<div id="-list" class="section level3">
<h3><span class="header-section-number">5.6.3</span> Списки (list)</h3>
<p>Объекты класса list могут являтся контейнерами для храннения других объектов, в том числе и других списков, как правило объекты класса list испоьзуются для хранения данныхимеющих сложную вложенную структуру, к примеру в виде списков удобно хранить данные прочитанные из JSON формата.</p>
<div id="-" class="section level4">
<h4><span class="header-section-number">5.6.3.1</span> Создание списков</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">user =</span> <span class="kw">list</span>(<span class="dt">id =</span> <span class="dv">1</span>,
                            <span class="dt">name =</span> <span class="st">&quot;Alex&quot;</span>,
                            <span class="dt">data =</span> users[ users<span class="op">$</span>Id <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, ] ))

my_list_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">list</span>(users, age, names, name_vector)</code></pre></div>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">5.6.3.2</span> Обращение к элементам списка</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_list<span class="op">$</span>user<span class="op">$</span>data<span class="op">$</span>Names

my_list_<span class="dv">2</span>[[<span class="dv">4</span>]]
my_list_<span class="dv">2</span>[[<span class="dv">4</span>]][[<span class="dv">2</span>]]
my_list_<span class="dv">2</span>[[<span class="dv">4</span>]][[<span class="st">&quot;company&quot;</span>]]</code></pre></div>
</div>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">5.6.4</span> Проверить класс объекта</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(users)
<span class="kw">class</span>(age)
<span class="kw">class</span>(my_list)</code></pre></div>
</div>
</div>
<div id="-----r" class="section level2">
<h2><span class="header-section-number">5.7</span> Работа со строками на языке R</h2>
<div id="-------r" class="section level3">
<h3><span class="header-section-number">5.7.1</span> Базовые возможности для работы со строками в R</h3>
<p>В базовом R существует достаточно большой набор функций для работы со строками, ниже приведён пример манипуляции с текстовыми данными.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Конкатенация</span>
<span class="kw">paste</span>(<span class="st">&quot;Объелинить&quot;</span>, <span class="st">&quot;несколько&quot;</span>, <span class="st">&quot;строк&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;Объелинить несколько строк&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste0</span>(<span class="st">&quot;Объелинить&quot;</span>, <span class="st">&quot;несколько&quot;</span>, <span class="st">&quot;строк&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;Объелинитьнесколькострок&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste</span>(<span class="kw">c</span>(<span class="st">&quot;первый&quot;</span>, <span class="st">&quot;текстовый&quot;</span>, <span class="st">&quot;вектор&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;второй&quot;</span>, <span class="st">&quot;вектор&quot;</span>), <span class="dt">collapse =</span> <span class="st">&quot;-&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;+&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;первый+второй-текстовый+вектор-вектор+второй&quot;</code></pre>
<p>С помощью функций <code>paste</code> и <code>paste0</code> можно объединять строкии склеивать текстовые векторы в кдиную строку, аргумент <em>sep</em> задаёт разделитель который будет добавлен между склеиваемыми частями, а аргумент <em>collapse</em> задаёт разделитель через который будут объедены результаты склеивания разных частей.</p>
<p>Для извлечения части строки в R используется функция <code>substr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Склеить&quot;</span>, <span class="st">&quot;несколько&quot;</span>, <span class="st">&quot;строк&quot;</span>, <span class="st">&quot;в&quot;</span>, <span class="st">&quot;одну&quot;</span>)
<span class="kw">substr</span>(text, <span class="dt">start =</span>  <span class="dv">3</span>, <span class="dt">stop =</span> <span class="dv">5</span>)</code></pre></div>
<pre><code>## [1] &quot;леи&quot; &quot;ско&quot; &quot;рок&quot; &quot;&quot;    &quot;ну&quot;</code></pre>
<p>Разбить строку через разделитель можно с помощью функции <code>strsplit</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_string &lt;-<span class="st"> &quot;Первая часть, вторая часть, третья часть&quot;</span>
<span class="kw">strsplit</span>(my_string, <span class="st">&quot;, &quot;</span>)</code></pre></div>
<pre><code>## [[1]]
## [1] &quot;Первая часть&quot; &quot;вторая часть&quot; &quot;третья часть&quot;</code></pre>
<p>Примеры преобразования регистра строки.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_string &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Разные РЕГИСТРЫ&quot;</span>, <span class="st">&quot;ПрИМеР РеГисТРА&quot;</span>)
<span class="kw">tolower</span>(my_string) <span class="co"># перевод в верхний регистр</span>
<span class="kw">toupper</span>(my_string) <span class="co"># перевод в нижний регистр</span>
<span class="kw">casefold</span>(my_string, <span class="dt">upper =</span> <span class="ot">TRUE</span>)  <span class="co"># перевод в верхний регистр</span>
<span class="kw">casefold</span>(my_string, <span class="dt">upper =</span> <span class="ot">FALSE</span>) <span class="co"># перевод в нижний регистр</span></code></pre></div>
<p>Работа с регулярными выражениями в R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># работа с регулярными выражениями</span>
<span class="kw">grepl</span>(<span class="dt">x =</span> text_with_spaces, <span class="dt">pattern =</span> <span class="st">&quot;^ &quot;</span>, <span class="dt">ignore.case =</span> T)           <span class="co"># проверить соответвует ли срока регулярному выражению</span>
<span class="kw">gsub</span>(<span class="dt">pattern =</span> <span class="st">&quot;^ | {2, }| $&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="dt">x =</span> text_with_spaces) <span class="co"># замена части строки по регулярному выражению</span>

<span class="co"># получить подстроку соответвующую регулярному выражению</span>
m &lt;-<span class="st"> </span><span class="kw">regexpr</span>(<span class="st">&quot;(.*о.*)&quot;</span>, text)
<span class="kw">regmatches</span>(<span class="dt">x =</span> text,<span class="dt">m =</span>  m)</code></pre></div>
</div>
<div id="------stringr" class="section level3">
<h3><span class="header-section-number">5.7.2</span> Работа со строками с помощью пакета stringr</h3>
<p>Базовые функции для работы со строками в R начительно различаются в стиле наименования как самих функций так и их аргументов, в связи с чеь замечательный пакет <code>sringr</code>, названия всех функций пакета начинаются с префикса <em>str_</em>, аргументы всех функций схожы.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># преобразование строки</span>
<span class="kw">str_c</span>(text, <span class="kw">c</span>(<span class="st">&quot;раз&quot;</span>, <span class="st">&quot;два&quot;</span>, <span class="st">&quot;три&quot;</span>), <span class="dt">collapse =</span> <span class="st">&quot;-&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;+&quot;</span>) <span class="co"># конкатенация строк</span>
<span class="kw">str_replace_all</span>(<span class="dt">string =</span> <span class="st">&quot;УбИрём одно слово&quot;</span>, <span class="dt">pattern =</span>  <span class="st">&quot;УбИрём&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;Уберём&quot;</span>) <span class="co"># замена части строки</span>
<span class="kw">str_to_lower</span>(<span class="st">&quot;Перевод В Нижний Регистр&quot;</span>) <span class="co"># перевод в нижний регистр</span>
<span class="kw">str_to_upper</span>(<span class="st">&quot;перевод в верхний регистр&quot;</span>) <span class="co"># перевод в верхний регистр</span>
<span class="kw">str_to_title</span>(<span class="st">&quot;заглавная первая буква&quot;</span>) <span class="co"># перевод в регистр заголовков</span>
<span class="kw">str_remove_all</span>(<span class="st">&quot;Уберём все пробелы&quot;</span>, <span class="st">&quot; &quot;</span>) <span class="co"># удаление символов из строки</span>
<span class="kw">str_squish</span>(<span class="st">&quot;  Уберём    лишние  пробелы   &quot;</span>) <span class="co"># Удаление лишних пробелов</span>
<span class="kw">str_split</span>(<span class="st">&quot;Разобъём - строку - по - разделителю&quot;</span>, <span class="st">&quot; - &quot;</span>) <span class="co"># разбивка строки по разделителю</span>
<span class="kw">str_pad</span>(<span class="st">&quot;дополняем строку&quot;</span>,<span class="dt">side =</span> <span class="st">&quot;both&quot;</span>, <span class="dt">width =</span> <span class="dv">50</span>, <span class="dt">pad =</span> <span class="st">&quot;$&quot;</span>) <span class="co"># дополнение строки опредённым символов до нужного размера</span>

<span class="co"># извлечение части строки</span>
<span class="kw">str_extract</span>(<span class="dt">pattern =</span> <span class="st">&quot;(.*о.*)&quot;</span>, <span class="dt">string =</span> text) <span class="co"># извлечение части строки по паттерну</span>
<span class="kw">str_sub</span>(<span class="st">&quot;Часть строки&quot;</span>, <span class="dt">start =</span> <span class="dv">3</span>, <span class="dt">end =</span> <span class="dv">7</span>) <span class="co"># извлечние части строки по номеру символа</span>
<span class="kw">word</span>(<span class="st">&quot;Извлекаем слова по их номерам из предложения&quot;</span>, <span class="dv">4</span>, <span class="dt">end =</span> <span class="dv">7</span>) <span class="co"># извлечение слова из предложения</span>
<span class="kw">word</span>(<span class="st">&quot;Извлекаем_слова_по_их_номерам_из_предложения&quot;</span>, <span class="dv">4</span>, <span class="dt">end =</span> <span class="dv">7</span>, <span class="st">&quot;_&quot;</span>) <span class="co"># извлечение слова из предложения разделённого _</span>

<span class="co"># подсчёт символов</span>
<span class="kw">str_length</span>(<span class="st">&quot;Какая то большая строка&quot;</span>) <span class="co"># посчитать количество символов</span>
<span class="kw">str_count</span>(<span class="dt">string =</span> <span class="st">&quot;посчитаем сколько раз встречается буква о&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;о&quot;</span>) <span class="co"># считает количество входежний символа в строку</span>

<span class="co"># проверка строки</span>
<span class="kw">str_detect</span>(<span class="dt">string =</span> <span class="st">&quot; пробел&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^ &quot;</span>) <span class="co"># проверяет соответсвие строки регулярному выражению</span></code></pre></div>
<p>Так же пакет <code>stringr</code> дополнительно даёт возможность использовать объекты рабочего окружения и результаты работы функций в строках, т.е. конкатенировать созанные вами переменные или результат выполнения какой либо функции в строку, для этого в пакете есть две функции: <code>str_glue</code> и <code>str_interp</code>.</p>
<p><code>str_glue</code> - даёт возможность интерполировать внутрь строки значения из созданных в рабочем окружении объектов, имена объектов помещаются при этом в фигурные скобки.</p>
<p><code>str_interp</code> - используется для встраивания внутрь строки выражения, которое возвращается в результате рабоы каких либо функций языка R, для встраивания результата необходимо поставить знак долара и далее фигурных скобках написать выражение, результат которого вы хотите конкатенировать в строку.</p>
<p>Примеры использования приведённых выше функций:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># создаём переменные которые будем использовать в строках</span>
name &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Alexey&quot;</span>, <span class="st">&quot;Sergey&quot;</span>)
surname &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Seleznev&quot;</span>, <span class="st">&quot;Petrov&quot;</span>)
age &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">34</span>, <span class="dv">38</span>)
city &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Odessa&quot;</span>, <span class="st">&quot;Moscow&quot;</span>)

<span class="co"># подстановка значений в строку из переменных</span>
stringr<span class="op">::</span><span class="kw">str_glue</span>(<span class="st">&quot;Hi, my name is {name} {surname}. I am {age} years old and i live in {city}.&quot;</span>)</code></pre></div>
<pre><code>## Hi, my name is Alexey Seleznev. I am 34 years old and i live in Odessa.
## Hi, my name is Sergey Petrov. I am 38 years old and i live in Moscow.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># подстановка результатов работы функций paste и mean в строку</span>
stringr<span class="op">::</span><span class="kw">str_interp</span>(<span class="st">&quot;Average age by ${paste(name, collapse = &#39; and &#39;)} is a ${mean(age)}&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;Average age by Alexey and Sergey is a 36&quot;</code></pre>
</div>
</div>
<div id="---csv-excel--json---r" class="section level2">
<h2><span class="header-section-number">5.8</span> Загрузка данных из csv, excel и json файлов в R</h2>
<div id="---csv-" class="section level3">
<h3><span class="header-section-number">5.8.1</span> Загрузка данных из csv файлов</h3>
<p>Наиболее удобным и гибким способом загрузки данных в R из csv файлов является функция <code>read.table</code>, первый аргументом которой является путь к файлу, аргумент <em>sep</em> отвечает за то, какие разделители полей используются в csv файле, и аргумент header принимает логическое значение <em>TRUE</em> или <em>FALSE</em>, и с его помощью вы можете указать что первая строка в вашем csv файле содержит заголовки полей.</p>
<p>Пример кода для загрузки данных из csv файла, все файлы находятся в папаке матриалы курса - модуль 1 - урок 7.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Переходим в работую директорию</span>
<span class="kw">setwd</span>(<span class="st">&quot;C:/r_for_marketing_course/Материалы курса/Модуль 1/Урок 7/&quot;</span>)
sales   &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;sales.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">header =</span> T)
country &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;country.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">header =</span> T)
clients &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;clients.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">header =</span> T)
product &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;product.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">header =</span> T)</code></pre></div>
</div>
<div id="---excel-" class="section level3">
<h3><span class="header-section-number">5.8.2</span> Загрузка данных из Excel файлов</h3>
<p>Для работы с Excel файлами необходимо установить и подключить пакет <em>readxl</em>, для этого необходимо выполнить функции <code>install.packages</code> и <code>library</code>, далее с помощью функции <code>read_excel</code> можно прочитать данные из любого листа Excel книги.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## загрузка данных из Excel файлов
<span class="kw">install.packages</span>(<span class="st">&quot;readxl&quot;</span>)
<span class="kw">library</span>(readxl)
bad_format_data &lt;-<span class="st"> </span><span class="kw">read_excel</span>( <span class="st">&quot;tidyr_example.xlsx&quot;</span> , <span class="dt">sheet =</span> <span class="st">&quot;tidyr_example&quot;</span>, <span class="dt">col_names =</span> T)</code></pre></div>
</div>
<div id="---json-" class="section level3">
<h3><span class="header-section-number">5.8.3</span> Загрузка данных из JSON файлов</h3>
<p>Для работы с JSON форматом необходимо загрузить и подключить пакет <em>jsonlite</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;jsonlite&quot;</span>)
<span class="kw">library</span>(jsonlite)
data_from_json &lt;-<span class="st"> </span><span class="kw">read_json</span>(<span class="st">&quot;dictionary.json&quot;</span>)</code></pre></div>
</div>
</div>
<div id="------r" class="section level2">
<h2><span class="header-section-number">5.9</span> Агрегирующие функции и арифметические операции в R</h2>
<p>Пример работы с наиболее часто используемыми агрегирующими функциями.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Агрегирующие функции</span>
<span class="kw">sum</span>(sales<span class="op">$</span>quantity)                    <span class="co"># суммирование</span>
<span class="kw">mean</span>(sales<span class="op">$</span>quantity)                   <span class="co"># среднее арифметическое</span>
<span class="kw">median</span>(sales<span class="op">$</span>quantity)                 <span class="co"># медиана</span>
<span class="kw">quantile</span>(sales<span class="op">$</span>quantity, <span class="dt">probs =</span> <span class="fl">0.25</span>) <span class="co"># квантиль</span>
<span class="kw">length</span>(sales<span class="op">$</span>quantity)                 <span class="co"># количество</span>
<span class="kw">length</span>(<span class="kw">unique</span>(sales<span class="op">$</span>manager))          <span class="co"># количество уникальных</span></code></pre></div>
<p>Арифметические операции:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Арифметические операции</span>
<span class="dv">5</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span>   <span class="co"># сложение</span>
<span class="dv">5</span> <span class="op">-</span><span class="st"> </span><span class="dv">2</span>   <span class="co"># вычитание</span>
<span class="dv">5</span> <span class="op">*</span><span class="st"> </span><span class="dv">2</span>   <span class="co"># умножение</span>
<span class="dv">5</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>   <span class="co"># деление</span>
<span class="dv">5</span> <span class="op">**</span><span class="st"> </span><span class="dv">2</span>  <span class="co"># степень</span>
<span class="dv">5</span> <span class="op">%/%</span><span class="st"> </span><span class="dv">2</span> <span class="co"># целочисленное деление</span>
<span class="dv">5</span> <span class="op">%%</span><span class="st"> </span><span class="dv">2</span>  <span class="co"># остаток от целочисленного деления</span></code></pre></div>
</div>
<div id="-----." class="section level2">
<h2><span class="header-section-number">5.10</span> Манипуляция с данными, (группировка и агреция).</h2>
<div id="-dplyr" class="section level3">
<h3><span class="header-section-number">5.10.1</span> Пакет dplyr</h3>
<p>Пакет dplyr является наиболее популярным пакетом для работы с данными в R, все функции пакета представляют из себя глаголы, синтаксис пакета очень напонимает синтаксис SQL запросов.</p>
<p><strong>Основные команды</strong> для работы с данными в пакете dplyr</p>
<ul>
<li><code>select</code> - выбор полей из data.frame</li>
<li><code>filter</code> - фильтрация данных</li>
<li><code>arrange</code> - сортировка данных</li>
<li><code>group_by</code> - группировка данных</li>
<li><code>summarise</code> - агрегация данных</li>
</ul>
<p><strong>Соединение таблиц</strong> осуществляется с помощью функций семейства join:</p>
<ul>
<li><code>inner_join</code> - возвращает строки общие для обеих таблиц соединения</li>
<li><code>left_join</code> - левое соединение, возвращает все строки из левой таблицы, и соответвующие по ключи строки из правой таблицы</li>
<li><code>right_join</code> - правое соединение, возвращает все строки из правой таблицы, и соответвующие по ключи строки из левой таблицы</li>
<li><code>full_join</code>- декартово произведение, возвращает все вараинты соединения каждой строки из левой таблицы с каждой сторокой из право таблицы</li>
</ul>
<div class="figure">
<img src="r_for_marketing_2018_files\figure-html\join.png" alt="Операция JOIN" />
<p class="caption">Операция JOIN</p>
</div>
<p><strong>Фильтрующие соединения:</strong></p>
<ul>
<li><code>semi_join</code> - возвращает все строки из левой таблицы, для которых по ключу найдены соответвия в правой таблице</li>
<li><code>anti_join</code> - возвращает все строки из левой таблицы, для которых по ключу небыли найдены соответвия в правой таблице</li>
</ul>
<p><strong>Конвеерный синтаксис</strong> В пакет <em>dplyr</em> из пакета <em>magrittr</em> был взаимствован конвеерный оператор <code>%&gt;%</code>, с помощью него можно избегать создание промежуточных объектов, данный оператор передаёт в качестве первого аргумента функции результат выпонения функции на прошлом шаге, если вам необходимо передать результат выполнения прошлого шага не в первый, а какой либо другой аргумент функции на следующем шаге то вы можете воспользоваться точкой, которая и будет хранить результат выполнения прошлого шага.</p>
<p>Пример конвеерной записи преобразования данных</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">setwd</span>(<span class="st">&quot;C:/r_for_marketing_course/Материалы курса/Модуль 1/Урок 7/&quot;</span>)
sales   &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;sales.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">header =</span> T)
<span class="co"># конверный стиль записи</span>
sales <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(manager) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># группируем таблицу по полю manager</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count            =</span> <span class="kw">n</span>(),                            <span class="co"># считаем количество строк по каждому менеджеру</span>
            <span class="dt">total_quantity   =</span> <span class="kw">sum</span>(quantity),                  <span class="co"># считаем количество проданных едениц товара</span>
            <span class="dt">average_quantity =</span> <span class="kw">mean</span>(quantity),                 <span class="co"># считаем среднее количество едениц товара в транзации</span>
            <span class="dt">products         =</span> <span class="kw">length</span>(<span class="kw">unique</span>(product_id))) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># считаем какое к-во наименований товара продал менеджер</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>total_quantity) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># сортирум таблицу по полю total_quantity по убыванию</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">3</span>) <span class="co"># оставляем 3 верхние строки</span></code></pre></div>
<p>Приведённый выше код делает следующе, передаёт в первый аргумент функции <code>group_by</code>, с помощью конвеерного оператора <code>%&gt;%</code> объкт <em>sales</em> и тем самым группирует дата фрейс sales по полю <em>manager</em>. Результат группировки, опять же с помощью конвеерного оператора <code>%&gt;%</code> передаётся в качестве первого аргумента функции <code>summarise</code>, далее к сгруппированным данным применяется ряд агрегаций, функции <code>n()</code> считает количество строк попавших в каждую группу, функция <code>sum</code> суммирует данные в каждой группе по полю <em>quantity</em>, функция <code>mean</code> считает среднее значение по полю <em>quantity</em>, а конструкция <code>length(unique(product_id))</code> считает количество уникальных <em>product_id</em> в каждой группе. После агрегации мы через конвеерный оператор <code>%&gt;%</code> передаём полученный на прошлом шаге результат в качестве первого аргумента функции <code>arrange</code>, и производим сортиртировку по убыванию поля <em>total_quantity</em>, передаём отсортированный результат далее в функцию <code>head</code> через <code>%&gt;%</code> и оставляем первые три строки.</p>
<p>В итоге мы получим следующий результат:</p>
<table>
<thead>
<tr class="header">
<th align="left">manager</th>
<th align="right">count</th>
<th align="right">total_quantity</th>
<th align="right">average_quantity</th>
<th align="right">products</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Olga</td>
<td align="right">25</td>
<td align="right">124</td>
<td align="right">4.960000</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">Andrey</td>
<td align="right">31</td>
<td align="right">114</td>
<td align="right">3.677419</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Alexey</td>
<td align="right">31</td>
<td align="right">111</td>
<td align="right">3.580645</td>
<td align="right">12</td>
</tr>
</tbody>
</table>
<p>Пример работы с фильрующими соединениями</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># фильтрующие соединения</span>
<span class="kw">anti_join</span>(product, sales, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;id&quot;</span> =<span class="st"> &quot;product_id&quot;</span>)) <span class="co"># товары по которым не было транзакций</span>
<span class="kw">semi_join</span>(product, sales, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;id&quot;</span> =<span class="st"> &quot;product_id&quot;</span>)) <span class="co"># товары по которым были транзакции</span></code></pre></div>
</div>
<div id="-data.table" class="section level3">
<h3><span class="header-section-number">5.10.2</span> Пакет data.table</h3>
<p>Пакет <strong>data.table</strong> предназначен для работы с большими массивами данных, по своему синтаксису он похож на работу с обычными data.frame, но в квадратных скобках мы указываем не только строки и столбцы которые необходимо выбрать, но и можем задавать группировку и агрегацию данных.</p>
<p><strong>Загрузка данных с помощью data.table</strong> Для загрузки данных из csv файлов в <strong>data.table</strong> есть функция <code>fread</code>, она принимает теже аргументы, что и стандартная функция <code>read.table</code> но работает в разы быстрее, и создаёт объекты класса <em>data.table</em>.</p>
<p><strong>Синтаксис пакета data.table</strong></p>
<div class="figure">
<img src="r_for_marketing_2018_files\figure-html\data.table.png" alt="Синтаксис data.table" />
<p class="caption">Синтаксис data.table</p>
</div>
<p>Обращение к полям таблиц, агрегация и группировка данных в <em>data.table</em> осуществляется внутри квадратных скобок, сначала мы указываем какие строки хотим выбрать, потом указываем агрегирующие операции и поля которые хотим в результате получить, и в третем блоке с помощью аргумента <code>by</code> или <code>bykey</code> мы указываем поля по которым хотим сгруппировать результат.</p>
<p>Вместо конвеерных операций расмотренных в пакете <strong>dplyr</strong>, в <strong>data.table</strong> существуют цепочки, записываются они следующим образом: <code>data_table_name[1ое звено][2ое звено][3ее звено][4ое звено][...]</code></p>
<p>Таким образом каждое следующее звено работает с результатом полученным из прошлого звена.</p>
<p><strong>Пример работы с пакетом data.table</strong></p>
<p>С помощью синтаксиса <strong>data.table</strong> мы можем получить тот же резуьтат, что и при работе с <strong>dplyr</strong>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;data.table&quot;</span>)
<span class="kw">setwd</span>(<span class="st">&quot;C:/r_for_marketing_course/Материалы курса/Модуль 1/Урок 7/&quot;</span>)
<span class="co"># загрузка данных</span>
sales_dt &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;sales.csv&quot;</span>)
sales_dt[,
         .(<span class="dt">count            =</span> .N,                             <span class="co"># считаем количество строк по каждому менеджеру</span>
           <span class="dt">total_quantity   =</span> <span class="kw">sum</span>(quantity),                  <span class="co"># считаем количество проданных едениц товара</span>
           <span class="dt">average_quantity =</span> <span class="kw">mean</span>(quantity),                 <span class="co"># считаем среднее количество едениц товара в транзации</span>
           <span class="dt">products         =</span> <span class="kw">length</span>(<span class="kw">unique</span>(product_id))),    <span class="co"># считаем какое к-во наименований товара продал менеджер</span>
         by =<span class="st"> </span>manager][<span class="kw">order</span>(total_quantity, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)][<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]</code></pre></div>
<p>Приведённый выше код вернёт результат аналогичный тому, который был получен ранее при работе с пакетом dplyr.</p>
<table>
<thead>
<tr class="header">
<th align="left">manager</th>
<th align="right">count</th>
<th align="right">total_quantity</th>
<th align="right">average_quantity</th>
<th align="right">products</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Olga</td>
<td align="right">25</td>
<td align="right">124</td>
<td align="right">4.960000</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">Andrey</td>
<td align="right">31</td>
<td align="right">114</td>
<td align="right">3.677419</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Alexey</td>
<td align="right">31</td>
<td align="right">111</td>
<td align="right">3.580645</td>
<td align="right">12</td>
</tr>
</tbody>
</table>
</div>
<div id="-sqldf" class="section level3">
<h3><span class="header-section-number">5.10.3</span> Пакет sqldf</h3>
<p><strong>sqldf</strong> является менее популярным пакетом по сравнению с <strong>dplyr</strong> и <strong>data.table</strong>, основным его назначением является возможность манипулировать с данными с помощью SQL синтаксиса.</p>
<p>Пакет поддерживает 4 SQL диалекта: SQLite (по умолчанию), MySQL, PostgreSQL, H2.</p>
<p>Для того, что бы установить нужный диалект необходимо поменять опцию <em>sqldf.driver</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="dt">sqldf.driver =</span> <span class="st">&quot;SQLite&quot;</span>)</code></pre></div>
<p>Для того, что бы получить с помощью пакета <strong>sqldf</strong> результат аналогичный тому, что мы ранее получили с помощью пакетов <strong>dplyr</strong> и <strong>data.table</strong> необходимо выполнить следующий код.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sqldf)
<span class="co"># повторяем агрегацию применяемую в примере с dplyr и data.table</span>
sqldf_exampl &lt;-<span class="st"> </span><span class="kw">sqldf</span>(<span class="st">&quot;SELECT</span>
<span class="st">                         manager,</span>
<span class="st">                         COUNT(*) as count,</span>
<span class="st">                         SUM(quantity) as total_quantity,</span>
<span class="st">                         AVG(quantity) as average_quantity,</span>
<span class="st">                         COUNT(DISTINCT product_id) as products</span>
<span class="st">                       FROM sales</span>
<span class="st">                       GROUP by manager</span>
<span class="st">                       ORDER BY total_quantity DESC</span>
<span class="st">                       LIMIT 3&quot;</span>)</code></pre></div>
<p>В результате его выполнения, мы получим уже знакомый результат агрегации данных.</p>
<table>
<thead>
<tr class="header">
<th align="left">manager</th>
<th align="right">count</th>
<th align="right">total_quantity</th>
<th align="right">average_quantity</th>
<th align="right">products</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Olga</td>
<td align="right">25</td>
<td align="right">124</td>
<td align="right">4.960000</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">Andrey</td>
<td align="right">31</td>
<td align="right">114</td>
<td align="right">3.677419</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Alexey</td>
<td align="right">31</td>
<td align="right">111</td>
<td align="right">3.580645</td>
<td align="right">12</td>
</tr>
</tbody>
</table>
</div>
<div id="-tidyr" class="section level3">
<h3><span class="header-section-number">5.10.4</span> Пакет tidyr</h3>
<p>Данный пакет предназначен для придания данным так называемого аккуратного вида, так такую концепцию данных называют <em>Tidy data</em>, заключается она в том, что наиболее удобно работать с данными приведёнными к такому виду, когда каждая строка таблицы соответствует одному наблюдения, а каждый столбец хранит информацию об одном свойстве наблдений.</p>
<p><strong>Задача: </strong> в материалах курса есть файл <em>tidyr_example.xlsx</em>, найти его можно в папке материале курса / модуль 1 / урок 7. Сам файл представляет из себя таблицу следующего вида:</p>
<div class="figure">
<img src="http://img.netpeak.ua/alsey/153304211756_kiss_10kb.png" alt="файл tidyr_example.xlsx" />
<p class="caption">файл tidyr_example.xlsx</p>
</div>
<p>Довольно часто коллеги предоставляют вам данные именно в таком виде,но работать с такими данными неудобно, т.к. существуют следующие ошибки.</p>
<ol style="list-style-type: decimal">
<li>Поле <em>country</em> было сгруппировано в Excel, и при загрузке данных в R большая часть ячеек в этом поле не будут заполнены.</li>
<li>Поле <em>client_code</em> содержит код клиента, который в свою очередь хранит информацию сразу о трёх его свойствах, о сегмента клиента, его номер, и класс клиента, в данном случае все три свойства хранятся в одном поле, что не соответвует концепции Tidy data.</li>
<li>4 столбца хранят информацию о количестве продаж в кокретном месяце, но месяц является отдельным свойством наблюдения, и название месяцаа должно храниться в отдельном столбце, и количество продаж в конкретном месяце так же необходимо хранить как отдельное свойство продажи.</li>
</ol>
<p>Пакет <strong>tidyr</strong> предоставляет набор функций с помощью которых можно исправить все перечисленные выше проблемы и привести данные к аккуратному виду.</p>
<p><strong>Функции в tidyr</strong></p>
<ul>
<li><code>fill</code> - заполнение пропущенных значений в поле, в нашем случае заполнение поля <em>country</em></li>
<li><code>separate</code> - разделяет одно поле на несколько, в нашей задаче нам необходимо разбить поле <em>client_code</em> на 3 поля <em>client_segment</em>, <em>client_id</em> и <em>client_class.</em></li>
<li><code>unite</code> - совершает операцию объеденения нескольких полей в одно, дейтсвие обратное функции <code>separate</code>.</li>
<li><code>gather</code> - функция преобразующая данные из широкого формата в длинный,в нашем случае мы будем с помощью неё преобразовывать поля <em>June</em>, <em>July</em>, <em>Aug</em>, <em>Sept</em> в два поля <em>month</em>, в котром будет хранится название месяца и <em>sales_count</em>, в котором будет хранится информация о количестве продаж.</li>
<li><code>spread</code> - функция преобразующая данные из длинного формата в широкий, операция обратнаяя той, которую осуществляет функция <code>gather</code>.</li>
</ul>
<p>Для решения приведённой задачи с помощью конвеерного стиля необходимо выполнить следующий код:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyr)
<span class="kw">library</span>(readxl)

<span class="kw">setwd</span>(<span class="st">&quot;C:/r_for_marketing_course/Материалы курса/Модуль 1/Урок 7/&quot;</span>)

bad_format_data &lt;-<span class="st"> </span><span class="kw">read_excel</span>( <span class="st">&quot;tidyr_example.xlsx&quot;</span> , <span class="dt">sheet =</span> <span class="st">&quot;tidyr_example&quot;</span>, <span class="dt">col_names =</span> T)

good_data &lt;-<span class="st"> </span>bad_format_data <span class="op">%&gt;%</span>
<span class="st">                  </span><span class="kw">fill</span>(country) <span class="op">%&gt;%</span>
<span class="st">                  </span><span class="kw">separate</span>(<span class="dt">col  =</span> client_code,
                           <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;client_segment&quot;</span>, <span class="st">&quot;client_id&quot;</span>, <span class="st">&quot;client_class&quot;</span>),
                           <span class="dt">sep  =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">                  </span><span class="kw">gather</span>(<span class="dt">key =</span> <span class="st">&quot;month&quot;</span>,
                         <span class="dt">value =</span> <span class="st">&quot;sales_count&quot;</span>,
                         June<span class="op">:</span>Sept)</code></pre></div>
<p>В рузультате чего мы приведём наши данные к аккуратному виду, (верхние 20 строк результирующей табицы):</p>
<table>
<thead>
<tr class="header">
<th align="left">country</th>
<th align="left">client_segment</th>
<th align="left">client_id</th>
<th align="left">client_class</th>
<th align="left">month</th>
<th align="right">sales_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">UA</td>
<td align="left">c2с</td>
<td align="left">1</td>
<td align="left">a</td>
<td align="left">June</td>
<td align="right">74</td>
</tr>
<tr class="even">
<td align="left">UA</td>
<td align="left">b2b</td>
<td align="left">2</td>
<td align="left">a</td>
<td align="left">June</td>
<td align="right">45</td>
</tr>
<tr class="odd">
<td align="left">UA</td>
<td align="left">c2с</td>
<td align="left">3</td>
<td align="left">c</td>
<td align="left">June</td>
<td align="right">37</td>
</tr>
<tr class="even">
<td align="left">UA</td>
<td align="left">c2с</td>
<td align="left">4</td>
<td align="left">b</td>
<td align="left">June</td>
<td align="right">87</td>
</tr>
<tr class="odd">
<td align="left">UA</td>
<td align="left">c2с</td>
<td align="left">5</td>
<td align="left">a</td>
<td align="left">June</td>
<td align="right">55</td>
</tr>
<tr class="even">
<td align="left">RU</td>
<td align="left">b2b</td>
<td align="left">2</td>
<td align="left">b</td>
<td align="left">June</td>
<td align="right">66</td>
</tr>
<tr class="odd">
<td align="left">RU</td>
<td align="left">c2с</td>
<td align="left">4</td>
<td align="left">a</td>
<td align="left">June</td>
<td align="right">70</td>
</tr>
<tr class="even">
<td align="left">RU</td>
<td align="left">b2b</td>
<td align="left">5</td>
<td align="left">a</td>
<td align="left">June</td>
<td align="right">62</td>
</tr>
<tr class="odd">
<td align="left">KZ</td>
<td align="left">b2b</td>
<td align="left">8</td>
<td align="left">c</td>
<td align="left">June</td>
<td align="right">57</td>
</tr>
<tr class="even">
<td align="left">KZ</td>
<td align="left">c2с</td>
<td align="left">6</td>
<td align="left">b</td>
<td align="left">June</td>
<td align="right">51</td>
</tr>
<tr class="odd">
<td align="left">KZ</td>
<td align="left">c2с</td>
<td align="left">9</td>
<td align="left">a</td>
<td align="left">June</td>
<td align="right">43</td>
</tr>
<tr class="even">
<td align="left">KZ</td>
<td align="left">b2b</td>
<td align="left">10</td>
<td align="left">b</td>
<td align="left">June</td>
<td align="right">62</td>
</tr>
<tr class="odd">
<td align="left">KZ</td>
<td align="left">b2b</td>
<td align="left">2</td>
<td align="left">b</td>
<td align="left">June</td>
<td align="right">44</td>
</tr>
<tr class="even">
<td align="left">KZ</td>
<td align="left">c2с</td>
<td align="left">3</td>
<td align="left">c</td>
<td align="left">June</td>
<td align="right">60</td>
</tr>
<tr class="odd">
<td align="left">KZ</td>
<td align="left">c2с</td>
<td align="left">11</td>
<td align="left">b</td>
<td align="left">June</td>
<td align="right">48</td>
</tr>
<tr class="even">
<td align="left">KZ</td>
<td align="left">b2b</td>
<td align="left">12</td>
<td align="left">c</td>
<td align="left">June</td>
<td align="right">62</td>
</tr>
<tr class="odd">
<td align="left">UA</td>
<td align="left">c2с</td>
<td align="left">1</td>
<td align="left">a</td>
<td align="left">July</td>
<td align="right">87</td>
</tr>
<tr class="even">
<td align="left">UA</td>
<td align="left">b2b</td>
<td align="left">2</td>
<td align="left">a</td>
<td align="left">July</td>
<td align="right">58</td>
</tr>
<tr class="odd">
<td align="left">UA</td>
<td align="left">c2с</td>
<td align="left">3</td>
<td align="left">c</td>
<td align="left">July</td>
<td align="right">31</td>
</tr>
<tr class="even">
<td align="left">UA</td>
<td align="left">c2с</td>
<td align="left">4</td>
<td align="left">b</td>
<td align="left">July</td>
<td align="right">65</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="------r--lubridate." class="section level2">
<h2><span class="header-section-number">5.11</span> Работа с датами и временем в R, пакет lubridate.</h2>
<div id="---------r" class="section level3">
<h3><span class="header-section-number">5.11.1</span> Базовые возможности по работе с датой и временем в R</h3>
<p>В R дата и время являются отдельным типом данных, базовые функции для работы с датами предоставляют следующие возможности.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Sys.Date</span>()     <span class="co"># текущая дата</span>
<span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span><span class="dv">7</span> <span class="co"># дата которая была 7 дней назад</span>
<span class="kw">Sys.time</span>()     <span class="co"># текущая дата и время</span>
<span class="kw">Sys.timezone</span>() <span class="co"># часовой пояс</span>


first_day_in_<span class="dv">2018</span> &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2018-01-01&quot;</span>) <span class="co"># преобразование текста в дату</span>
<span class="kw">class</span>(first_day_in_<span class="dv">2018</span>) <span class="co"># проверка того, является ли переменная датой</span>

<span class="co"># последовательность дат</span>
date_vector &lt;-<span class="st"> </span><span class="kw">seq.Date</span>(<span class="dt">from =</span> first_day_in_<span class="dv">2018</span>, <span class="dt">to =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2018-06-01&quot;</span>), <span class="dt">by =</span> <span class="st">&quot;month&quot;</span>)
<span class="kw">seq.Date</span>(<span class="dt">from =</span> first_day_in_<span class="dv">2018</span>, <span class="dt">to =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2018-06-01&quot;</span>), <span class="dt">by =</span> <span class="st">&quot;week&quot;</span>)
<span class="kw">seq.Date</span>(<span class="dt">from =</span> first_day_in_<span class="dv">2018</span>, <span class="dt">to =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2018-06-01&quot;</span>), <span class="dt">length.out =</span> <span class="dv">10</span>)</code></pre></div>
</div>
<div id="-lubridate" class="section level3">
<h3><span class="header-section-number">5.11.2</span> Пакет lubridate</h3>
<p>Довольно общирные возможности по работе с датой и временем предоставляет пакет пакет <strong>lubridate</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lubridate)
<span class="kw">today</span>() <span class="co"># текущая дата</span>
<span class="kw">date</span>()  <span class="co"># текущая да</span>
<span class="kw">now</span>()   <span class="co"># текущая дата и время</span>
start_time &lt;-<span class="st"> </span><span class="kw">now</span>()</code></pre></div>
<div id="-------lubridate" class="section level4">
<h4><span class="header-section-number">5.11.2.1</span> Преобразование строки в дату с помощью функций lubridate</h4>
<p>Для преобразования строки в дату в <strong>lubridate</strong> существует набор функций, все эти функции состоят из первых букв состовляющих даты, y - год, m - месяц и d - день.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># преобразовать строку в дату</span>
<span class="kw">ymd</span>(<span class="st">&quot;20180715&quot;</span>)    <span class="co"># преобразум стоку формата ГГГГММДД в дату</span>
<span class="kw">ymd</span>(<span class="st">&quot;2018-07-15&quot;</span>)  <span class="co"># преобразум стоку формата ГГГГ-ММ-ДД в дату</span>
<span class="kw">mdy</span>(<span class="st">&quot;07152018&quot;</span>)    <span class="co"># преобразум стоку формата ММДДГГГГ в дату</span>
<span class="kw">dmy</span>(<span class="st">&quot;15.07.2018&quot;</span>)  <span class="co"># преобразум стоку формата ДД.ММ.ГГГГ в дату</span>
<span class="kw">ymd_hms</span>(<span class="st">&quot;2018-07-15 12:30:00 Europe/Helsinki&quot;</span>) <span class="co"># преобразуем строку ГГГГ-ММ-ДД ЧЧ:ММ:СС в дату и время</span></code></pre></div>
</div>
<div id="-----lubridate." class="section level4">
<h4><span class="header-section-number">5.11.2.2</span> Работа с часовыми поясами в lubridate.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># часовые пояса</span>
my_time &lt;-<span class="st"> </span><span class="kw">now</span>()
<span class="kw">OlsonNames</span>(<span class="dt">tzdir =</span> <span class="ot">NULL</span>) <span class="co"># список всех часовых поясов</span>
<span class="kw">with_tz</span>(my_time, <span class="dt">tzone =</span> <span class="st">&quot;UTC&quot;</span>)     <span class="co"># преоразуем в временную метку в часовой пояс UTC</span>
<span class="kw">with_tz</span>(my_time, <span class="st">&quot;America/Chicago&quot;</span>) <span class="co"># преоразуем в временную метку в часовой пояс America/Chicago</span></code></pre></div>
</div>
<div id="--------lubridate" class="section level4">
<h4><span class="header-section-number">5.11.2.3</span> Извлечение отдельных компонентов даты с помощью функций пакета lubridate</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># получить день, месяц и год из даты</span>
today_date &lt;-<span class="st"> </span><span class="kw">today</span>()
<span class="kw">day</span>(today_date)     <span class="co"># получить день из даты</span>
<span class="kw">month</span>(today_date)   <span class="co"># получить месяц из даты</span>
<span class="kw">year</span>(today_date)    <span class="co"># получить месяц из даты</span>
<span class="kw">quarter</span>(today_date) <span class="co"># получить номер квартала из даты</span>
<span class="kw">qday</span>(today_date)    <span class="co"># получить номер дня в квартале</span>
<span class="kw">yday</span>(today_date)    <span class="co"># получить номер дня в году</span>

<span class="co"># получить днь недели</span>
<span class="kw">wday</span>(today_date,
     <span class="dt">label =</span> <span class="ot">TRUE</span>,
     <span class="dt">abbr =</span> <span class="ot">TRUE</span>,
     <span class="dt">week_start =</span> <span class="dv">1</span>)</code></pre></div>
</div>
<div id="---------lubridate" class="section level4">
<h4><span class="header-section-number">5.11.2.4</span> Округление, и прочие арифметические операции с датами с помощью lubridate</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># округление дат</span>
<span class="kw">round_date</span>(today_date, <span class="dt">unit =</span> <span class="st">&quot;month&quot;</span>)   <span class="co"># округлить до ближайшего месяца</span>
<span class="kw">round_date</span>(today_date, <span class="dt">unit =</span> <span class="st">&quot;quarter&quot;</span>) <span class="co"># округлить до ближайшего квартала</span>
<span class="kw">floor_date</span>(today_date, <span class="dt">unit =</span> <span class="st">&quot;month&quot;</span>)   <span class="co"># округлить вниз до ближайшего месяца</span>
<span class="kw">ceiling_date</span>(today_date, <span class="dt">unit =</span> <span class="st">&quot;month&quot;</span>) <span class="co"># округлить вверх до ближайшего месяца</span>
<span class="kw">ceiling_date</span>(today_date, <span class="dt">unit =</span> <span class="st">&quot;quarter&quot;</span>)

<span class="co"># арифметичские операции с датами</span>
<span class="kw">today</span>() <span class="op">-</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">6</span>) <span class="co"># 6 месяцев назад от текущей даты</span>

<span class="co"># получить первый и последний прошлого квартала</span>
<span class="kw">today</span>() <span class="op">-</span><span class="st"> </span><span class="kw">qday</span>(<span class="kw">today</span>()) <span class="co"># получаем конец прошлого квартала</span>
<span class="kw">floor_date</span>(<span class="kw">today</span>() <span class="op">-</span><span class="st"> </span><span class="kw">qday</span>(<span class="kw">today</span>()), <span class="dt">unit =</span> <span class="st">&quot;quarter&quot;</span>)  <span class="co"># получаем начало прошлого квартала</span>

<span class="co"># получить первый и последний прошлого месяца</span>
<span class="kw">floor_date</span>(<span class="kw">today</span>() <span class="op">-</span><span class="st"> </span><span class="kw">day</span>(<span class="kw">today</span>()), <span class="dt">unit =</span> <span class="st">&quot;month&quot;</span>)
<span class="kw">today</span>() <span class="op">-</span><span class="st"> </span><span class="kw">day</span>(<span class="kw">today</span>())</code></pre></div>
</div>
<div id="------lubridate" class="section level4">
<h4><span class="header-section-number">5.11.2.5</span> Операции над данными со временм в lubridate</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Работа со временем в R</span>
<span class="co"># вычисление длительности</span>
end_time &lt;-<span class="st"> </span><span class="kw">now</span>()
<span class="kw">difftime</span>(end_time, start_time, <span class="dt">units =</span> <span class="st">&quot;secs&quot;</span>) <span class="co"># в секундах</span>
<span class="kw">difftime</span>(end_time, start_time, <span class="dt">units =</span> <span class="st">&quot;mins&quot;</span>) <span class="co"># в минутах</span>


end_time <span class="op">+</span><span class="st"> </span><span class="kw">hours</span>(<span class="dv">30</span>)   <span class="co"># прибавить 3 часа</span>
end_time <span class="op">+</span><span class="st"> </span><span class="kw">minutes</span>(<span class="dv">15</span>) <span class="co"># прибавить 15 минут</span>
<span class="kw">hour</span>(end_time)         <span class="co"># получить часы из времени</span>
<span class="kw">minute</span>(end_time)       <span class="co"># получить минуты из времени</span>
<span class="kw">second</span>(end_time)       <span class="co"># получить секунды из времени</span></code></pre></div>
</div>
</div>
</div>
<div id="--if-ifelse-switch--r" class="section level2">
<h2><span class="header-section-number">5.12</span> Условные конструкции if, ifelse, switch в R</h2>
<p>Для работы с уловными конструкциями в R существует оператор <code>if</code>, функция <code>ifelse</code> и функция <code>switch</code>.</p>
<p>Наиболее простой способ использования условий в R предоставляет функция <code>ifelse</code>, по синтаксису она идентична функции <code>ЕСЛИ</code> в Excel.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vec_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dt">n =</span> <span class="dv">30</span>, <span class="dt">min =</span> <span class="dv">5</span>, <span class="dt">max =</span> <span class="dv">50</span>)

<span class="co"># векторизированный оператор ifelse</span>
<span class="kw">ifelse</span>(vec_<span class="dv">1</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">25</span>, <span class="st">&quot;Больше 25&quot;</span>, <span class="st">&quot;Меньша 25&quot;</span>)</code></pre></div>
<p>В случае если вам необходимо проверить более чем одно условие необхимо использовать конструкцию <code>if</code> - <code>else</code>.</p>
<div class="figure">
<img src="r_for_marketing_2018_files\figure-html\if.png" alt="Синтаксис оператора if" />
<p class="caption">Синтаксис оператора if</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">10</span>

<span class="co"># условная конструкция if</span>
<span class="cf">if</span> (x <span class="op">&lt;</span><span class="st"> </span><span class="dv">25</span>) {
  <span class="kw">print</span>(<span class="st">&quot;x меньше 25&quot;</span>)
} <span class="cf">else</span> <span class="cf">if</span> (x <span class="op">&lt;=</span><span class="st"> </span><span class="dv">40</span>) {
  <span class="kw">print</span>(<span class="st">&quot;x больше 25 но меньше 40&quot;</span>)
} <span class="cf">else</span> {
  <span class="kw">print</span>(<span class="st">&quot;x больше 40&quot;</span>)
}</code></pre></div>
<p>Таким образом можно добавлять люое количество условий с помощью оператров <code>else if</code>, далее добавляется обычный оператор <code>else</code></p>
<p>Функция <code>switch</code> напоминает привычный для SQL оператор <code>CASE</code>, она принимает все варианты возможных взодящих параметров, и для кадого входящего параметра определяет значение которое необходимо вернуть.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">employ_name &lt;-<span class="st"> &quot;Alexey&quot;</span>

<span class="co"># переключатель, аналог case</span>
<span class="cf">switch</span> (employ_name,
         <span class="dt">Alexey  =</span> <span class="dv">3</span>,
         <span class="dt">Sergey  =</span> <span class="fl">1.5</span>,
         <span class="dt">Denis   =</span> <span class="dv">2</span>,
         <span class="dt">Nikolay =</span> <span class="dv">4</span>,
         <span class="dv">0</span>)</code></pre></div>
</div>
<div id="-for--while" class="section level2">
<h2><span class="header-section-number">5.13</span> Циклы for и while</h2>
<div id="-for" class="section level3">
<h3><span class="header-section-number">5.13.1</span> Цикл for</h3>
<p>Цикл <code>for</code> представляет из классический цикл со счётчиком. <img src="r_for_marketing_2018_files\figure-html\for.png" alt="Синтаксис оператора if" /></p>
<p>Простейший пример пример цикла for:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Цикл for</span>
employ_name &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Alexey&quot;</span>, <span class="st">&quot;Sergey&quot;</span>, <span class="st">&quot;Nikolay&quot;</span>)

<span class="cf">for</span> (name <span class="cf">in</span> employ_name) {
  <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Hello&quot;</span>, name))
}

<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(employ_name)) {
  <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Hello&quot;</span>, employ_name[i]))
}</code></pre></div>
<p>В данном случае цикл будет состоять из трёх итераций, на каждой итерации в переменную-счётчик <em>name</em> будет подставлен один элемент вектора <em>employ_name</em>.</p>
<p><strong>Задача:</strong> В материалах курса, в папке модуль 1 - урок 9, есть 7 csv файлов одинаковой структуры, довольно часто встречается задача когда необходимо объеденить данные из файлов одинаковой структуры в один. Нам необходимо реализовать процесс склейки файлов в одну таблицу в R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># загрузка данных из множества файлов одинаковой структуры</span>
<span class="kw">setwd</span>( <span class="st">&quot;C:/r_for_marketing_course/Материалы курса/Модуль 1/Урок 9&quot;</span>) <span class="co"># переходим в рабочую директорию</span>

<span class="kw">library</span>(dplyr)  <span class="co"># подключаем пакет dplyr</span>
files &lt;-<span class="st"> </span><span class="kw">dir</span>()  <span class="co"># получаем список файлов из рабочей директории</span>
load_files &lt;-<span class="st"> </span>files[ <span class="kw">grepl</span>(<span class="st">&quot;^data_from&quot;</span>, files) ] <span class="co"># оставляем список файлов который начинается на load_data</span>

load_data &lt;-<span class="st"> </span><span class="kw">list</span>() <span class="co"># создаём объек класса list в который будет загружать файлы</span>

<span class="cf">for</span> (f <span class="cf">in</span> load_files) {
  load_data &lt;-<span class="st"> </span><span class="kw">c</span>(load_data,
                 <span class="co"># по очереди загружаем каждый файл и присоединяем к объекту load_data</span>
                 <span class="kw">list</span>(<span class="kw">read.table</span>(f, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">header =</span> T)))
}

data &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(load_data) <span class="co"># преобразуем загруженные файлы в data.frame</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>C помощью команы <code>setwd</code> мы делаем нужную папку нашим рабочим каталогом.</li>
<li>Далее функция <code>dir</code> возвращает вектор, состоящий из имён всех файлов которые находятс яв рабочем каталоге.</li>
<li>Т.к. помимо нужных нам файлов в каталоге присутвуют и другие, то с помощью <code>grepl</code> и регулярного выражения <em>^data_from</em> мы оставляет только те файлы, имена которых начинаются на data_from, и созраняем их в вектор <em>load_files</em>.</li>
<li>Создаём пустой список <em>load_data</em>, в который по очереди будем добавлять загруженные данные.</li>
<li>С помощью цикла <code>for</code> мы перебираем по очереди все имена файлов из вектора <em>load_files</em>, и подставляем их в функцию <code>read.table</code>, в данном случае переменной-счётчиком у нас является объект <em>f</em>, заданный в круглых скобках после объявления цикла <code>for</code>.</li>
<li>После загрузки всех файлов мы объединяем их в одну таблицу с помощью функции <code>bind_rows</code> из пакета <em>dplyr</em>.</li>
</ol>
</div>
<div id="-while" class="section level3">
<h3><span class="header-section-number">5.13.2</span> Цикл while</h3>
<p>Цикл <code>while</code> используется в том случае если до запуска цикла мы не знаем точное количество итераций, он будет выполняться до тех пор пока будет возвращать истину заданное после его объявление логическое выражение.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Цикл whie</span>
x &lt;-<span class="st"> </span><span class="dv">0</span>

<span class="cf">while</span> ( x <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span> ) {
  <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;x равен&quot;</span>, x))
  x &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
}</code></pre></div>
<p>В данном пример цикл будет выполняться до тех пор пока переменная <em>x</em> будет меньше 7, при этом на кажой итерации цикла мы увеличиваем значение переменной <em>x</em> на единицу с помощью конструкции <code>x &lt;- x + 1</code>.</p>
<p>Ещё рлин пример работы с циклом <code>while</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">input &lt;-<span class="st"> &quot;&quot;</span>
<span class="cf">while</span> (input <span class="op">!=</span><span class="st"> &quot;stop&quot;</span>) {
  input &lt;-<span class="st"> </span><span class="kw">readline</span>(<span class="st">&quot;Введите текст: &quot;</span>)
  <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;Ваш текст: &quot;</span>, input))
}</code></pre></div>
<p>Этот цикл проси ввести значение с клавиатуры с помощью функции <code>readline</code>, и итерации будут продолжаться до тех пор, пока вы не введёте слово <em>stop</em>.</p>
<p>Возможно вы захоьите добавить дополнительную проверку, и выйти из цикла <code>while</code> даже если основное условие по прежнему возвращает истину, допустим вы хотите ограничить количество итераций, для этого в R существует оператор <code>break</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">input &lt;-<span class="st"> &quot;&quot;</span>
n &lt;-<span class="st"> </span><span class="dv">0</span>

<span class="cf">while</span> (input <span class="op">!=</span><span class="st"> &quot;stop&quot;</span>) {
  input &lt;-<span class="st"> </span><span class="kw">readline</span>(<span class="st">&quot;Введите текст: &quot;</span>)
  <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;Ваш текст: &quot;</span>, input))
  n &lt;-<span class="st"> </span>n <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
    <span class="cf">if</span> (n <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>) {
      <span class="kw">print</span>(<span class="st">&quot;Вы вводили текст более трёх раз, цикл окончен&quot;</span>)
      <span class="cf">break</span>
    }
}</code></pre></div>
<p>Так же и как в прошлом примере R будет просить ввести текст, цикл будет итерироваться до тез пор пока вы не введёте слово stop, но мы парралельно ввеи счётчик <em>n</em>, который увеличиваем на 1 с каждой новой итерацией <code>n &lt;- n + 1</code>, далее в теле цикла с помощью условной конструкции <code>if</code> проверяется условие <code>n &gt; 3</code>, если <em>n</em> более трёх мы выводим сообщение <em>Вы вводили текст более трёх раз, цикл окончен</em>, и выходим из цикла с помощью оператора <code>break</code>.</p>
</div>
</div>
<div id="-----r" class="section level2">
<h2><span class="header-section-number">5.14</span> Разработка собственных функций в языке R</h2>
<p>Создание собственных функций осузествляется с помощью оператора <code>function</code>. <img src="r_for_marketing_2018_files\figure-html\function.png" alt="Синтаксис оператора if" /></p>
<p>Функция, так же как и всё, что мы создаём в рабочем окружении, является объектом, поэтому создаётся функция так же, мы указываем имя фунции и пишем знак присвоения <code>&lt;-</code>. Далее пишем оператор <code>function</code>, в скобкаъ перечисляем все аргументы, осткрываем фигурную скобку после чего пишем тело функции, результат выполнения функции мы возвращаем передав его внутри тела функции в <code>return</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># простая функция</span>
my_fun_sum &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, z) {
  result &lt;-<span class="st"> </span>(x <span class="op">+</span><span class="st"> </span>y) <span class="op">*</span><span class="st"> </span>z
  <span class="kw">return</span>(result)
}

<span class="kw">my_fun_sum</span>(<span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">2</span>)

<span class="co"># функция с переключателем</span>
agr &lt;-<span class="st"> </span><span class="cf">function</span> (x, type) {
        <span class="cf">switch</span>(type,
               <span class="dt">mean      =</span> <span class="kw">mean</span>(x),
               <span class="dt">median    =</span> <span class="kw">median</span>(x),
               <span class="dt">sum       =</span> <span class="kw">sum</span>(x),
               <span class="dt">quantiles =</span> <span class="kw">quantile</span>(x, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>)))
}

<span class="kw">agr</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">17</span>, <span class="dv">32</span>, <span class="dv">15</span>), <span class="dt">type =</span> <span class="st">&quot;mean&quot;</span>)
<span class="kw">agr</span>(<span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">17</span>, <span class="dv">32</span>, <span class="dv">15</span>), <span class="dt">type =</span> <span class="st">&quot;quantiles&quot;</span>)


<span class="co"># функция для загрузки файлов</span>
file_loader &lt;-<span class="st"> </span><span class="cf">function</span>(prefix, ...) {
    <span class="co"># получаем список файлов из рабочей директории</span>
    files &lt;-<span class="st"> </span><span class="kw">dir</span>()

    <span class="co"># оставляем список файлов который начинается на load_data</span>
    load_files &lt;-<span class="st"> </span>files[ <span class="kw">grepl</span>(prefix, files) ]

    <span class="co"># создаём объек класса list в который будет загружать файлы</span>
    load_data &lt;-<span class="st"> </span><span class="kw">list</span>()

    <span class="co"># циклом обрабатываем каждый файл</span>
    <span class="cf">for</span> (f <span class="cf">in</span> load_files) {
      load_data &lt;-<span class="st"> </span><span class="kw">c</span>(load_data,
                     <span class="co"># по очереди загружаем каждый файл и присоединяем к объекту load_data</span>
                     <span class="kw">list</span>(<span class="kw">read.table</span>(f, ...)))
    }

    data &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(load_data) <span class="co"># преобразуем загруженные файлы в data.frame</span>

    <span class="co"># возвращаем полученный результат</span>
    <span class="kw">return</span>(data)
}


my_files &lt;-<span class="st"> </span><span class="kw">file_loader</span>(<span class="dt">prefix =</span> <span class="st">&quot;^data_from&quot;</span>,
                        <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>,
                        <span class="dt">header =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>В примере выше показаны варианты разработки как самой элементарной пользовательской функции которая просто производит арифметические операции над треммя введёными аргументами, так и более сложная которая выполняет все действия для загрузки и объединения данных из множества csv файлов, которые мы рассматривали ранее изучая цикл <code>for</code>.</p>
</div>
<div id="---r--try" class="section level2">
<h2><span class="header-section-number">5.15</span> Обработка ошибок в R, функция try</h2>
<p>Достаточной важной частью разработки какого либо скрипта является обработка ошибок, давайте рассмотрим пример с ошибкой. возникающей в работе цикла.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test_error_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">5</span>, <span class="dv">12</span>, <span class="dv">8</span>, <span class="st">&quot;u&quot;</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">9</span>)

<span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(test_error_list)) {
  <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;i is &quot;</span>, test_error_list[[i]]))
  <span class="kw">print</span>(test_error_list[[i]] <span class="op">*</span><span class="st"> </span><span class="dv">12</span>)
}</code></pre></div>
<pre><code>## [1] &quot;i is 5&quot;
## [1] 60
## [1] &quot;i is 12&quot;
## [1] 144
## [1] &quot;i is 8&quot;
## [1] 96
## [1] &quot;i is u&quot;</code></pre>
<pre><code>## Error in test_error_list[[i]] * 12: нечисловой аргумент для бинарного оператора</code></pre>
<p>Цикл, по очереди должен умножить каждой элемент списка <code>test_error_list</code> на 12, в начале тела цикла с помощью команды <code>print</code> мы выводим сообщение о том, какое значение имеет текущий, обратаваесый элемент.</p>
<p>Цикл успешно умножил на 12 первые три элемента списка <code>test_error_list</code>, но 4ый элемент является текстовым, а R не умеет производить арифметические операции над текстом, возвращает ошибку, и цикл аварийно прекращает работу до того как он обработал все аргументы.</p>
<p>Но мы с помощью функции <code>try</code> можем предусмотреть вариант возникновения ошибки при умножении следующим образом.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test_error_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">5</span>, <span class="dv">12</span>, <span class="dv">8</span>, <span class="st">&quot;u&quot;</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">9</span>)
<span class="co"># обработка ошибок</span>
<span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(test_error_list)) {

  <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;i is &quot;</span>, test_error_list[[i]]))
  check_result &lt;-<span class="st"> </span><span class="kw">try</span> (test_error_list[[i]] <span class="op">*</span><span class="st"> </span><span class="dv">12</span>, <span class="dt">silent =</span> <span class="ot">TRUE</span>)

  <span class="cf">if</span> (<span class="kw">class</span>(check_result) <span class="op">==</span><span class="st"> &quot;try-error&quot;</span>) {
    <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;error: &quot;</span>, <span class="kw">as.character</span>(<span class="kw">attr</span>(check_result, <span class="st">&quot;condition&quot;</span>))))
    <span class="cf">next</span>
  } <span class="cf">else</span> {
    <span class="kw">print</span>(check_result)
  }
}</code></pre></div>
<pre><code>## [1] &quot;i is 5&quot;
## [1] 60
## [1] &quot;i is 12&quot;
## [1] 144
## [1] &quot;i is 8&quot;
## [1] 96
## [1] &quot;i is u&quot;
## [1] &quot;error:  Error in test_error_list[[i]] * 12: нечисловой аргумент для бинарного оператора\n&quot;
## [1] &quot;i is 3&quot;
## [1] 36
## [1] &quot;i is 7&quot;
## [1] 84
## [1] &quot;i is 9&quot;
## [1] 108</code></pre>
<p>В скрипте выше, мы завернули вычисление <code>test_error_list[[i]] * 12</code> в функцию <code>try</code>, которая не смотря на то, что в ходе цикла возникла ошибка продолжает его работу, но объект который она вернёт будет иметь класс <em>try-error</em>, для проверки корретно ли отработало вычисление мы добавили условную конструкцию <code>if (class(check_result) == &quot;try-error&quot;)</code>, и в случае если умножение вернуло ошибку мы выводим сообщение, и переходим на следующую итерацию цикла с помощью команды <code>next</code>.</p>
</div>
<div id="-------" class="section level2">
<h2><span class="header-section-number">5.16</span> Рекомендации по оформлению кода для упрощения его читаемости</h2>
<ol style="list-style-type: decimal">
<li>Названия всех объектов должны быть понятными и осмысленными.</li>
<li>Необходимо придерживаться единого стиля в именовании функций и их аргументов: snake_case, lowerCamelCase, UpperCamelCase, period.separated.</li>
<li>Используйте в качестве знака присвоения <code>-&gt;</code> а не знак равенства, который в R принято использовать только в качестве знака присвоения для аргумнтов функций.</li>
<li>Пробелы ставяться до и после математических символов, операторов присвоения в том числе операторов присвоения аргументов, логических операторов. Пробелы ставяться после запятых и управляющих конструкций <code>if</code>, <code>for</code>, <code>while</code>.</li>
<li>Если функция имее большое количество аргументов для улучшение читаемости кода переносите каждый агрумент на новую строку, так же улучшит восприятие кода выравнив по строкам знаки присвоения значений аргументам добавив между именем аргумента и знаком <code>=</code> дополнительные пробелы, такой же приём можно использовать если в начале скрипта вы объявляете большое количество переменных.</li>
<li>Во всех своих скриптах лучше придерживаться единой структуры кода, например я использую такой подход: 6.1. Подключение библиотек <code>library</code> 6.2. Переход в рабочую директорию <code>setwd</code> 6.3. Описание всех пользовательских функций используеых в скрипте <code>function</code> 6.4. Подключение к базам данных <code>dbConnect</code> 6.5. Аутентификация в API 6.6. Основная часть кода 6.7. Закрываем соедения с базами данных <code>dbDisconnect</code>.</li>
<li>Если в одном скрипте используюстся функции из множества различных пакетов явно указывайте к какому паету принадлежик каждая функция <code>package_name::function_name()</code>.</li>
<li>Комментируйте код, это улучшить навигцию по коду при работе в RStudio, и значительно упростить понимание кода в последствии.</li>
<li>R не требует обязательного указания имён аргументов функций, но я рекомендую всегда явно описывать их имена если вы используете в функции более одно, явного и обязательного аргумента.</li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="c-.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="-2-api-.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/04-module_1.Rmd",
"text": "Edit"
},
"download": ["r_for_marketing.pdf", "r_for_marketing.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
