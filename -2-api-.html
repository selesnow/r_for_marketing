<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Язык R в интернет маркетинге</title>
  <meta name="description" content="Методичесткое пособие к авторскому курсу Алексея Селезнёва “Язык R в интернет маркетинге.”">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Язык R в интернет маркетинге" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Методичесткое пособие к авторскому курсу Алексея Селезнёва “Язык R в интернет маркетинге.”" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Язык R в интернет маркетинге" />
  
  <meta name="twitter:description" content="Методичесткое пособие к авторскому курсу Алексея Селезнёва “Язык R в интернет маркетинге.”" />
  

<meta name="author" content="Алексей Селезнёв">


<meta name="date" content="2018-10-02">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="-1-r-.html">
<link rel="next" href="-3-api-.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114798296-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-114798296-1');
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Язык R в Интернет Маркетинге</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Описание</a></li>
<li class="chapter" data-level="2" data-path="a-.html"><a href="a-.html"><i class="fa fa-check"></i><b>2</b> a - О курсе</a><ul>
<li class="chapter" data-level="2.1" data-path="a-.html"><a href="a-.html#---"><i class="fa fa-check"></i><b>2.1</b> Для кого этот курс</a></li>
<li class="chapter" data-level="2.2" data-path="a-.html"><a href="a-.html#-----"><i class="fa fa-check"></i><b>2.2</b> Какие знания требуются для прохождения курса</a></li>
<li class="chapter" data-level="2.3" data-path="a-.html"><a href="a-.html#-------"><i class="fa fa-check"></i><b>2.3</b> Какие темы не будут затронуты в ходе курса</a></li>
<li class="chapter" data-level="2.4" data-path="a-.html"><a href="a-.html#------"><i class="fa fa-check"></i><b>2.4</b> Что вы будете уметь поосле проождения курса</a></li>
<li class="chapter" data-level="2.5" data-path="a-.html"><a href="a-.html#-"><i class="fa fa-check"></i><b>2.5</b> Поддержка студентов</a></li>
<li class="chapter" data-level="2.6" data-path="a-.html"><a href="a-.html#-"><i class="fa fa-check"></i><b>2.6</b> Конспект курса</a></li>
<li class="chapter" data-level="2.7" data-path="a-.html"><a href="a-.html#-"><i class="fa fa-check"></i><b>2.7</b> Программа курса</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="b-.html"><a href="b-.html"><i class="fa fa-check"></i><b>3</b> b - Об авторе</a></li>
<li class="chapter" data-level="4" data-path="c-.html"><a href="c-.html"><i class="fa fa-check"></i><b>4</b> c - Благодарности</a></li>
<li class="chapter" data-level="5" data-path="-1-r-.html"><a href="-1-r-.html"><i class="fa fa-check"></i><b>5</b> Модуль 1: Введение в R.</a><ul>
<li class="chapter" data-level="5.1" data-path="-1-r-.html"><a href="-1-r-.html#---r"><i class="fa fa-check"></i><b>5.1</b> История создания языка R</a></li>
<li class="chapter" data-level="5.2" data-path="-1-r-.html"><a href="-1-r-.html#--r."><i class="fa fa-check"></i><b>5.2</b> Преимущества языка R.</a></li>
<li class="chapter" data-level="5.3" data-path="-1-r-.html"><a href="-1-r-.html#--r----rstudio"><i class="fa fa-check"></i><b>5.3</b> Установка языка R и среды разработки RStudio</a><ul>
<li class="chapter" data-level="5.3.1" data-path="-1-r-.html"><a href="-1-r-.html#---r--rstudio"><i class="fa fa-check"></i><b>5.3.1</b> Ссылки для загрузки R и RStudio</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="-1-r-.html"><a href="-1-r-.html#------power-bi---r-."><i class="fa fa-check"></i><b>5.4</b> Загрузка, преобразование и визуализация данных в Power BI с помощью R скриптов.</a><ul>
<li class="chapter" data-level="5.4.1" data-path="-1-r-.html"><a href="-1-r-.html#---power-bi."><i class="fa fa-check"></i><b>5.4.1</b> Загрузка данных в Power BI.</a></li>
<li class="chapter" data-level="5.4.2" data-path="-1-r-.html"><a href="-1-r-.html#---power-bi-power-query."><i class="fa fa-check"></i><b>5.4.2</b> Преобразование данных в Power BI (power query).</a></li>
<li class="chapter" data-level="5.4.3" data-path="-1-r-.html"><a href="-1-r-.html#---power-bi------r."><i class="fa fa-check"></i><b>5.4.3</b> Визуализация данных в Power BI с помощью визуального элемента скрипта R.</a></li>
<li class="chapter" data-level="5.4.4" data-path="-1-r-.html"><a href="-1-r-.html#---power-bi--r-."><i class="fa fa-check"></i><b>5.4.4</b> Использование пользовательских параметров Power BI в R скриптах.</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="-1-r-.html"><a href="-1-r-.html#--rstudio"><i class="fa fa-check"></i><b>5.5</b> Среда разработки RStudio</a></li>
<li class="chapter" data-level="5.6" data-path="-1-r-.html"><a href="-1-r-.html#----r"><i class="fa fa-check"></i><b>5.6</b> Классы объектов в языке R</a><ul>
<li class="chapter" data-level="5.6.1" data-path="-1-r-.html"><a href="-1-r-.html#section-5.6.1"><i class="fa fa-check"></i><b>5.6.1</b> Векторы</a></li>
<li class="chapter" data-level="5.6.2" data-path="-1-r-.html"><a href="-1-r-.html#-data.frame"><i class="fa fa-check"></i><b>5.6.2</b> Таблицы (data.frame)</a></li>
<li class="chapter" data-level="5.6.3" data-path="-1-r-.html"><a href="-1-r-.html#-list"><i class="fa fa-check"></i><b>5.6.3</b> Списки (list)</a></li>
<li class="chapter" data-level="5.6.4" data-path="-1-r-.html"><a href="-1-r-.html#--"><i class="fa fa-check"></i><b>5.6.4</b> Проверить класс объекта</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="-1-r-.html"><a href="-1-r-.html#-----r"><i class="fa fa-check"></i><b>5.7</b> Работа со строками на языке R</a><ul>
<li class="chapter" data-level="5.7.1" data-path="-1-r-.html"><a href="-1-r-.html#-------r"><i class="fa fa-check"></i><b>5.7.1</b> Базовые возможности для работы со строками в R</a></li>
<li class="chapter" data-level="5.7.2" data-path="-1-r-.html"><a href="-1-r-.html#------stringr"><i class="fa fa-check"></i><b>5.7.2</b> Работа со строками с помощью пакета stringr</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="-1-r-.html"><a href="-1-r-.html#---csv-excel--json---r"><i class="fa fa-check"></i><b>5.8</b> Загрузка данных из csv, excel и json файлов в R</a><ul>
<li class="chapter" data-level="5.8.1" data-path="-1-r-.html"><a href="-1-r-.html#---csv-"><i class="fa fa-check"></i><b>5.8.1</b> Загрузка данных из csv файлов</a></li>
<li class="chapter" data-level="5.8.2" data-path="-1-r-.html"><a href="-1-r-.html#---excel-"><i class="fa fa-check"></i><b>5.8.2</b> Загрузка данных из Excel файлов</a></li>
<li class="chapter" data-level="5.8.3" data-path="-1-r-.html"><a href="-1-r-.html#---json-"><i class="fa fa-check"></i><b>5.8.3</b> Загрузка данных из JSON файлов</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="-1-r-.html"><a href="-1-r-.html#------r"><i class="fa fa-check"></i><b>5.9</b> Агрегирующие функции и арифметические операции в R</a></li>
<li class="chapter" data-level="5.10" data-path="-1-r-.html"><a href="-1-r-.html#-----."><i class="fa fa-check"></i><b>5.10</b> Манипуляция с данными, (группировка и агреция).</a><ul>
<li class="chapter" data-level="5.10.1" data-path="-1-r-.html"><a href="-1-r-.html#-dplyr"><i class="fa fa-check"></i><b>5.10.1</b> Пакет dplyr</a></li>
<li class="chapter" data-level="5.10.2" data-path="-1-r-.html"><a href="-1-r-.html#-data.table"><i class="fa fa-check"></i><b>5.10.2</b> Пакет data.table</a></li>
<li class="chapter" data-level="5.10.3" data-path="-1-r-.html"><a href="-1-r-.html#-sqldf"><i class="fa fa-check"></i><b>5.10.3</b> Пакет sqldf</a></li>
<li class="chapter" data-level="5.10.4" data-path="-1-r-.html"><a href="-1-r-.html#-tidyr"><i class="fa fa-check"></i><b>5.10.4</b> Пакет tidyr</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="-1-r-.html"><a href="-1-r-.html#------r--lubridate."><i class="fa fa-check"></i><b>5.11</b> Работа с датами и временем в R, пакет lubridate.</a><ul>
<li class="chapter" data-level="5.11.1" data-path="-1-r-.html"><a href="-1-r-.html#---------r"><i class="fa fa-check"></i><b>5.11.1</b> Базовые возможности по работе с датой и временем в R</a></li>
<li class="chapter" data-level="5.11.2" data-path="-1-r-.html"><a href="-1-r-.html#-lubridate"><i class="fa fa-check"></i><b>5.11.2</b> Пакет lubridate</a></li>
</ul></li>
<li class="chapter" data-level="5.12" data-path="-1-r-.html"><a href="-1-r-.html#--if-ifelse-switch--r"><i class="fa fa-check"></i><b>5.12</b> Условные конструкции if, ifelse, switch в R</a></li>
<li class="chapter" data-level="5.13" data-path="-1-r-.html"><a href="-1-r-.html#-for--while"><i class="fa fa-check"></i><b>5.13</b> Циклы for и while</a><ul>
<li class="chapter" data-level="5.13.1" data-path="-1-r-.html"><a href="-1-r-.html#-for"><i class="fa fa-check"></i><b>5.13.1</b> Цикл for</a></li>
<li class="chapter" data-level="5.13.2" data-path="-1-r-.html"><a href="-1-r-.html#-while"><i class="fa fa-check"></i><b>5.13.2</b> Цикл while</a></li>
</ul></li>
<li class="chapter" data-level="5.14" data-path="-1-r-.html"><a href="-1-r-.html#-----r"><i class="fa fa-check"></i><b>5.14</b> Разработка собственных функций в языке R</a></li>
<li class="chapter" data-level="5.15" data-path="-1-r-.html"><a href="-1-r-.html#---r--try"><i class="fa fa-check"></i><b>5.15</b> Обработка ошибок в R, функция try</a></li>
<li class="chapter" data-level="5.16" data-path="a-.html"><a href="a-.html#---"><i class="fa fa-check"></i><b>5.16</b> Рекомендации по оформлению кода</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="-2-api-.html"><a href="-2-api-.html"><i class="fa fa-check"></i><b>6</b> Модуль 2: Работа с API рекламных площадок.</a><ul>
<li class="chapter" data-level="6.1" data-path="-2-api-.html"><a href="-2-api-.html#--api"><i class="fa fa-check"></i><b>6.1</b> Что такое API</a><ul>
<li class="chapter" data-level="6.1.1" data-path="-2-api-.html"><a href="-2-api-.html#-http-"><i class="fa fa-check"></i><b>6.1.1</b> Типы HTTP запросов</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="-2-api-.html"><a href="-2-api-.html#--api-google-ads"><i class="fa fa-check"></i><b>6.2</b> Работа с API Google Ads</a><ul>
<li class="chapter" data-level="6.2.1" data-path="-2-api-.html"><a href="-2-api-.html#----api-google-ads"><i class="fa fa-check"></i><b>6.2.1</b> Как получить доступ к API Google Ads</a></li>
<li class="chapter" data-level="6.2.2" data-path="-2-api-.html"><a href="-2-api-.html#--api-google-ads"><i class="fa fa-check"></i><b>6.2.2</b> Как устроен API Google Ads</a></li>
<li class="chapter" data-level="6.2.3" data-path="-2-api-.html"><a href="-2-api-.html#-radwords"><i class="fa fa-check"></i><b>6.2.3</b> Пакет RAdwords</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="-2-api-.html"><a href="-2-api-.html#--api--"><i class="fa fa-check"></i><b>6.3</b> Работа с API Яндекс Директ</a><ul>
<li class="chapter" data-level="6.3.1" data-path="-2-api-.html"><a href="-2-api-.html#-ryandexdirect"><i class="fa fa-check"></i><b>6.3.1</b> Пакет ryandexdirect</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="-2-api-.html"><a href="-2-api-.html#--api-facebook"><i class="fa fa-check"></i><b>6.4</b> Работа с API Facebook</a><ul>
<li class="chapter" data-level="6.4.1" data-path="-2-api-.html"><a href="-2-api-.html#---facebook"><i class="fa fa-check"></i><b>6.4.1</b> Создание приложения в Facebook</a></li>
<li class="chapter" data-level="6.4.2" data-path="-2-api-.html"><a href="-2-api-.html#--api-facebook"><i class="fa fa-check"></i><b>6.4.2</b> Авторизация в API Facebook</a></li>
<li class="chapter" data-level="6.4.3" data-path="-2-api-.html"><a href="-2-api-.html#-----facebook"><i class="fa fa-check"></i><b>6.4.3</b> Загрузка объектов из рекламного кабинета Facebook</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="-2-api-.html"><a href="-2-api-.html#--api--vk.com"><i class="fa fa-check"></i><b>6.5</b> Работа с API Вконтакте (vk.com)</a><ul>
<li class="chapter" data-level="6.5.1" data-path="-2-api-.html"><a href="-2-api-.html#-----api-"><i class="fa fa-check"></i><b>6.5.1</b> Создание приложения для работы с API Вконтакте</a></li>
<li class="chapter" data-level="6.5.2" data-path="-2-api-.html"><a href="-2-api-.html#--api-"><i class="fa fa-check"></i><b>6.5.2</b> Авторизация в API Вконтакте</a></li>
<li class="chapter" data-level="6.5.3" data-path="-2-api-.html"><a href="-2-api-.html#--rvkstat"><i class="fa fa-check"></i><b>6.5.3</b> Функции пакета rvkstat</a></li>
<li class="chapter" data-level="6.5.4" data-path="a-.html"><a href="a-.html#-----"><i class="fa fa-check"></i><b>6.5.4</b> Загрузка объектов из рекламного кабинета Вконтакте</a></li>
<li class="chapter" data-level="6.5.5" data-path="a-.html"><a href="a-.html#-----"><i class="fa fa-check"></i><b>6.5.5</b> Загрузка статистики из рекламного кабинета Вконтакте</a></li>
<li class="chapter" data-level="6.5.6" data-path="a-.html"><a href="a-.html#------"><i class="fa fa-check"></i><b>6.5.6</b> Загрузка статистики по сообществам и группам Вконтакте</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="-2-api-.html"><a href="-2-api-.html#--api-mytarget"><i class="fa fa-check"></i><b>6.6</b> Работа с API MyTarget</a><ul>
<li class="chapter" data-level="6.6.1" data-path="-2-api-.html"><a href="-2-api-.html#--api-mytarget"><i class="fa fa-check"></i><b>6.6.1</b> Авторизация в API MyTarget</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="-2-api-.html"><a href="-2-api-.html#---google-analytics"><i class="fa fa-check"></i><b>6.7</b> Загрузка данных из Google Analytics</a><ul>
<li class="chapter" data-level="6.7.1" data-path="-2-api-.html"><a href="-2-api-.html#-api----google-analytics"><i class="fa fa-check"></i><b>6.7.1</b> Какие API интерфейсы доступны в Google Analytics</a></li>
<li class="chapter" data-level="6.7.2" data-path="-2-api-.html"><a href="-2-api-.html#--api-google-analytics"><i class="fa fa-check"></i><b>6.7.2</b> Авторизация в API Google Analytics</a></li>
<li class="chapter" data-level="6.7.3" data-path="-2-api-.html"><a href="-2-api-.html#--management-api"><i class="fa fa-check"></i><b>6.7.3</b> Работа с Management API</a></li>
<li class="chapter" data-level="6.7.4" data-path="-2-api-.html"><a href="-2-api-.html#--core-reporting-api"><i class="fa fa-check"></i><b>6.7.4</b> Работа с Core Reporting API</a></li>
<li class="chapter" data-level="6.7.5" data-path="-2-api-.html"><a href="-2-api-.html#--multi-channel-funnels-api"><i class="fa fa-check"></i><b>6.7.5</b> Работа с Multi-Channel Funnels API</a></li>
<li class="chapter" data-level="6.7.6" data-path="-2-api-.html"><a href="-2-api-.html#--real-time-reporting-api"><i class="fa fa-check"></i><b>6.7.6</b> Работа с Real time reporting API</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="-2-api-.html"><a href="-2-api-.html#---api--"><i class="fa fa-check"></i><b>6.8</b> Загрузка данных из API Яндекс Метрики</a><ul>
<li class="chapter" data-level="6.8.1" data-path="-2-api-.html"><a href="-2-api-.html#----api--"><i class="fa fa-check"></i><b>6.8.1</b> Авторизация для работы с API Яндекс Метрики</a></li>
<li class="chapter" data-level="6.8.2" data-path="-2-api-.html"><a href="-2-api-.html#----api---"><i class="fa fa-check"></i><b>6.8.2</b> Функции для работы с API управления Яндекс Метрики</a></li>
<li class="chapter" data-level="6.8.3" data-path="-2-api-.html"><a href="-2-api-.html#---api---"><i class="fa fa-check"></i><b>6.8.3</b> Загрузка данных из API отчётов Яндекс Метрики</a></li>
<li class="chapter" data-level="6.8.4" data-path="-2-api-.html"><a href="-2-api-.html#---logs-api--"><i class="fa fa-check"></i><b>6.8.4</b> Загрузка данных из Logs API Яндекс Метрики</a></li>
<li class="chapter" data-level="6.8.5" data-path="-2-api-.html"><a href="-2-api-.html#---api-----core-reporting-api-google-analytics"><i class="fa fa-check"></i><b>6.8.5</b> Загрузка данных из API Яндекс Метрики совместимого с Core Reporting API Google Analytics</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="-2-api-.html"><a href="-2-api-.html#--google-search-console"><i class="fa fa-check"></i><b>6.9</b> Работа с Google Search Console</a><ul>
<li class="chapter" data-level="6.9.1" data-path="-2-api-.html"><a href="-2-api-.html#----5000---1-"><i class="fa fa-check"></i><b>6.9.1</b> Как обойти ограничение в 5000 строк на 1 запрос</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="-2-api-.html"><a href="-2-api-.html#--google-trends"><i class="fa fa-check"></i><b>6.10</b> Работа с Google Trends</a><ul>
<li class="chapter" data-level="6.10.1" data-path="-2-api-.html"><a href="-2-api-.html#-----google-trends"><i class="fa fa-check"></i><b>6.10.1</b> Манипуляция с данными полученными из Google Trends</a></li>
</ul></li>
<li class="chapter" data-level="6.11" data-path="-1-r-.html"><a href="-1-r-.html#--"><i class="fa fa-check"></i><b>6.11</b> Парсинг веб сайтов</a><ul>
<li class="chapter" data-level="6.11.1" data-path="-1-r-.html"><a href="-1-r-.html#----"><i class="fa fa-check"></i><b>6.11.1</b> Поиск элементов на веб странице</a></li>
<li class="chapter" data-level="6.11.2" data-path="-2-api-.html"><a href="-2-api-.html#-----html-"><i class="fa fa-check"></i><b>6.11.2</b> Извлечение значений из полученныз элементов HTML страницы</a></li>
<li class="chapter" data-level="6.11.3" data-path="a-.html"><a href="a-.html#---"><i class="fa fa-check"></i><b>6.11.3</b> Имитация пользовательской веб сессии</a></li>
</ul></li>
<li class="chapter" data-level="6.12" data-path="-2-api-.html"><a href="-2-api-.html#-http-"><i class="fa fa-check"></i><b>6.12</b> отправка HTTP запросов</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="-3-api-.html"><a href="-3-api-.html"><i class="fa fa-check"></i><b>7</b> Модуль 3: Работа с загруженными из API интерфейсов различных сервисов данными.</a><ul>
<li class="chapter" data-level="7.1" data-path="-3-api-.html"><a href="-3-api-.html#-----google-"><i class="fa fa-check"></i><b>7.1</b> Отправка и стение данных из Google Таблиц</a></li>
<li class="chapter" data-level="7.2" data-path="-3-api-.html"><a href="-3-api-.html#-----ggplot2"><i class="fa fa-check"></i><b>7.2</b> Визуализация данных с помощью пакета ggplot2</a><ul>
<li class="chapter" data-level="7.2.1" data-path="-3-api-.html"><a href="-3-api-.html#---qplot"><i class="fa fa-check"></i><b>7.2.1</b> Быстрый график, функция <code>qplot</code></a></li>
<li class="chapter" data-level="7.2.2" data-path="a-.html"><a href="a-.html#---"><i class="fa fa-check"></i><b>7.2.2</b> Построение графиков наложением слоёв</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="-3-api-.html"><a href="-3-api-.html#----dbi-------"><i class="fa fa-check"></i><b>7.3</b> Работа с базами данных, DBI - Интерфейс взаимодействия с базами данных</a><ul>
<li class="chapter" data-level="7.3.1" data-path="-3-api-.html"><a href="-3-api-.html#---mysql"><i class="fa fa-check"></i><b>7.3.1</b> Работа с СУБД MySQL</a></li>
<li class="chapter" data-level="7.3.2" data-path="-3-api-.html"><a href="-3-api-.html#----postgresql"><i class="fa fa-check"></i><b>7.3.2</b> Работа с базой данных PostgreSQL</a></li>
<li class="chapter" data-level="7.3.3" data-path="-3-api-.html"><a href="-3-api-.html#----sqlite"><i class="fa fa-check"></i><b>7.3.3</b> Работа с базой данных SQLite</a></li>
<li class="chapter" data-level="7.3.4" data-path="-3-api-.html"><a href="-3-api-.html#-----google-bigquery"><i class="fa fa-check"></i><b>7.3.4</b> Работа с облачной базой данных Google BigQuery</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="-1-r-.html"><a href="-1-r-.html#----r"><i class="fa fa-check"></i><b>7.4</b> Отправка почты с помощью R</a></li>
<li class="chapter" data-level="7.5" data-path="-3-api-.html"><a href="-3-api-.html#---r---"><i class="fa fa-check"></i><b>7.5</b> Как настроить запуск R скриптов по рассписанию</a><ul>
<li class="chapter" data-level="7.5.1" data-path="a-.html"><a href="a-.html#---"><i class="fa fa-check"></i><b>7.5.1</b> Настройка расписание через плагин</a></li>
<li class="chapter" data-level="7.5.2" data-path="-3-api-.html"><a href="-3-api-.html#------taskscheduler"><i class="fa fa-check"></i><b>7.5.2</b> Настройка расписание с помощью функций пакета taskscheduleR</a></li>
<li class="chapter" data-level="7.5.3" data-path="-3-api-.html"><a href="-3-api-.html#------windows"><i class="fa fa-check"></i><b>7.5.3</b> Ручная настройка рассписания через планировщик задач Windows</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Язык R в интернет маркетинге</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="-2---api--." class="section level1">
<h1><span class="header-section-number">6</span> Модуль 2: Работа с API рекламных площадок.</h1>
<div id="--api" class="section level2">
<h2><span class="header-section-number">6.1</span> Что такое API</h2>
<p>Взаимодействие пользователя с различными программами осуществляется с помощью графического интерфейса программы, пользователь взаимодействует с элементами графического интерфейса, такими как кнопки, списки, меню и таким образом задаёт программе различные команды которая она должна выполнить.</p>
<p>Подобное взаимодействие между двумя приложениями осуществляется с помощью API интерфейса, вместо элементов графического интерфейса в API используются различные методы, с помощью которых одно приложение задаёт другому какие либо команды.</p>
<div class="figure">
<img src="r_for_marketing_2018_files/figure-html/api.png" alt="Взаимодейтсвие между двумя приложениями" />
<p class="caption">Взаимодейтсвие между двумя приложениями</p>
</div>
<p>Взаимодействие происходит с помощью HTTP запросов, которое одно приложение (клиент) отправляет другому (сервер), далее сервер обрабатывает входящий запрос и отправляет обратно клиенту ответ.</p>
<div id="-http-" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Типы HTTP запросов</h3>
<p>HTTP запросы в свою очередь бывают разных типов, от типа запроса зависит действие которое каждый запрос выполняеи, наиболее часто встречающиеся это:</p>
<ol style="list-style-type: decimal">
<li>PUT - Создание;</li>
<li>GET - Чтение;</li>
<li>POST - Изменение;</li>
<li>DELETE - Удаление.</li>
</ol>
<p>В свою очередь все запросы состоят из нескольких компонентов:</p>
<ol style="list-style-type: decimal">
<li>URL – URL адрес сервера;</li>
<li>Headers – Заголовки запроса;</li>
<li>Body – Тело запроса.</li>
</ol>
<p>Сервер, приняви обработав запрос от клиент, возвращает ответ, ответ от сервера имеет статус, в котором указано успешно ли был выполнен ваш запрос, все статусы деляться на 5 классов, класс статса определяется по первой цыфре его кода.</p>
<ul>
<li>1xx – Информационные;</li>
<li>2xx – Запрос выполнен успешно;</li>
<li>3xx – Redirect;</li>
<li>4xx– Ошибка клиента;</li>
<li>5xx – Ошибка сервера.</li>
</ul>
</div>
</div>
<div id="--api-google-ads" class="section level2">
<h2><span class="header-section-number">6.2</span> Работа с API Google Ads</h2>
<div id="----api-google-ads" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Как получить доступ к API Google Ads</h3>
<p>Актуальная информация о том как получить доступ к API Google Ads можно получить в <a href="https://www.google.com/intl/ru/adwords/myclientcenter/">официциальноц справке</a>.</p>
<p>Для доступа Вам необходимо:</p>
<ol style="list-style-type: decimal">
<li>Создать центр клиентов, перейдите по <a href="https://www.google.com/intl/ru/adwords/myclientcenter/">этой ссылке</a> и зарегистрируйте новый центр клиентов, обратите внимание, что центр клиентов можно создать толко в том Google аккаунте к которому ещё не привязан ниодин аккаунт Google Ads.</li>
<li>Далее необходимо подать заявку на доступ к API, перейдите в Настройки (значок шестеренки в правом верхнем углу) &gt; Настройки аккаунта (раскрывающееся меню) &gt; Центр API AdWords (меню слева). Запонлите все поля и перейдите в форму заполненеия завки нажав на “Уровень доступа”. <img src="r_for_marketing_2018_files\figure-html\adw_api_2.png" alt="Google Ads API report" /></li>
<li>Далее ваша заявка будет рассмотрена и ободобрена.</li>
<li>СОздаём приложение в <a href="https://cloud.google.com/">Google Cloud</a>, для этого переходим в консоль google cloud, создаём первый проект, и в нём идём в меню &gt; API и сервисы &gt; учётные данные. <a href="http://img.netpeak.ua/alsey/153454508424_kiss_32kb.png">Google Cloud</a></li>
<li>Далее жмём кнопку “создать учётные данные” и выбираем “Идентификатор клиента OAuth”. <img src="r_for_marketing_2018_files\figure-html\adw_api_3.png" alt="Google Ads API report" />.</li>
</ol>
</div>
<div id="--api-google-ads" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Как устроен API Google Ads</h3>
<p>Google Ads является наиболее популярной системой онлайн реклмы в миру, и имеет довольно мощный API интерфейс для работы со статистикой. API состоит из 48 отчётов (версия 201806):</p>
<ul>
<li>ACCOUNT PERFORMANCE REPORT<br />
</li>
<li>AD CUSTOMIZERS FEED ITEM REPORT</li>
<li>AD PERFORMANCE REPORT</li>
<li>ADGROUP PERFORMANCE REPORT</li>
<li>AGE RANGE PERFORMANCE REPORT</li>
<li>AUDIENCE PERFORMANCE REPORT</li>
<li>AUTOMATIC PLACEMENTS PERFORMANCE REPORT<br />
</li>
<li>BID GOAL PERFORMANCE REPORT</li>
<li>BUDGET PERFORMANCE REPORT<br />
</li>
<li>CALL METRICS CALL DETAILS REPORT</li>
<li>CAMPAIGN AD SCHEDULE TARGET REPORT</li>
<li>CAMPAIGN CRITERIA REPORT</li>
<li>CAMPAIGN GROUP PERFORMANCE REPORT</li>
<li>CAMPAIGN LOCATION TARGET REPORT<br />
</li>
<li>CAMPAIGN NEGATIVE KEYWORDS PERFORMANCE REPORT<br />
</li>
<li>CAMPAIGN NEGATIVE LOCATIONS REPORT<br />
</li>
<li>CAMPAIGN NEGATIVE PLACEMENTS PERFORMANCE REPORT</li>
<li>CAMPAIGN PERFORMANCE REPORT<br />
</li>
<li>CAMPAIGN SHARED SET REPORT<br />
</li>
<li>CLICK PERFORMANCE REPORT<br />
</li>
<li>CREATIVE CONVERSION REPORT<br />
</li>
<li>CRITERIA PERFORMANCE REPORT<br />
</li>
<li>DESTINATION URL REPORT<br />
</li>
<li>DISPLAY KEYWORD PERFORMANCE REPORT<br />
</li>
<li>DISPLAY TOPICS PERFORMANCE REPORT<br />
</li>
<li>FINAL URL REPORT<br />
</li>
<li>GENDER PERFORMANCE REPORT<br />
</li>
<li>GEO PERFORMANCE REPORT<br />
</li>
<li>KEYWORDLESS CATEGORY REPORT<br />
</li>
<li>KEYWORDLESS QUERY REPORT<br />
</li>
<li>KEYWORDS PERFORMANCE REPORT<br />
</li>
<li>LABEL REPORT<br />
</li>
<li>LANDING PAGE REPORT<br />
</li>
<li>MARKETPLACE PERFORMANCE REPORT<br />
</li>
<li>PAID ORGANIC QUERY REPORT<br />
</li>
<li>PARENTAL STATUS PERFORMANCE REPORT<br />
</li>
<li>PLACEHOLDER FEED ITEM REPORT<br />
</li>
<li>PLACEHOLDER REPORT<br />
</li>
<li>PLACEMENT PERFORMANCE REPORT<br />
</li>
<li>PRODUCT PARTITION REPORT<br />
</li>
<li>SEARCH QUERY PERFORMANCE REPORT<br />
</li>
<li>SHARED SET CRITERIA REPORT<br />
</li>
<li>SHARED SET REPORT<br />
</li>
<li>SHOPPING PERFORMANCE REPORT</li>
<li>TOP CONTENT PERFORMANCE REPORT<br />
</li>
<li>URL PERFORMANCE REPORT</li>
<li>USER AD DISTANCE REPORT<br />
</li>
<li>VIDEO PERFORMANCE REPORT</li>
</ul>
<p>Посмотреть актуальный список отчётов можно в <a href="https://developers.google.com/adwords/api/docs/appendix/reports">официальной документации</a>, там же доступно описание каждого отчёта.</p>
<p>Каждый отчёт отвечает за группировку данных и в свою очередь состоит из полей, каждое поле отчёта может иметь один из трёх типов.</p>
<div class="figure">
<img src="r_for_marketing_2018_files\figure-html\adw_api_1.png" alt="Google Ads API report" />
<p class="caption">Google Ads API report</p>
</div>
<ul>
<li>Атрибут - поле содержит фиксированное значение в соответствии с заданными группировками, добавление такого поля в отчет не приводит к появлению новой группировки;</li>
<li>Сегмент - при выводе в отчете поле используется для группировки данных;</li>
<li>Метрика - поле содержит числовое значение, рассчитанное в соответствии с заданными фильтрами и группировками.</li>
</ul>
<p>Обращаячь к API вы запрашиваете какие либо поля из любого отчёта, и получается таким образом нужную вам статистику.</p>
</div>
<div id="-radwords" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Пакет RAdwords</h3>
<p>Для работы с API Google Ads в R существует пакет <strong>RAdwords</strong>.</p>
<p>Ранее, все пакеты которые мы устанавливали, мы скачивали и инсалировали из основного репозитория хранения данных в R CRAN, но пакеты в этом репозитории обновляются медленее чем dev версии пакетов ранящиеся у авторов на GitHub, для установки наиболее актуальных версий пакетов непосредственно из GitHub нам надо установить пакет *devtools** и далее устанавливать пакеты с помощью функции <code>install_github</code>, указав логин автора пакета и название репозитория в котором хранится пакет.</p>
<p>Например для установки пакета **RAdwords* из репозитория автора можно использовать следующий код:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)
<span class="kw">library</span>(devtools)
<span class="kw">install_github</span>(<span class="st">&quot;jburkhardt/RAdwords&quot;</span>)</code></pre></div>
<p>Где <em>jburkhardt/RAdwords</em> это логин автора RAdwords на GitHub и название репозитория где он хранится, получить их можно из ссылки на репозиторий - <a href="https://github.com/jburkhardt/RAdwords" class="uri">https://github.com/jburkhardt/RAdwords</a>.</p>
<p><em>Советую обновлять пакет как минимум раз в несколько месяцев, именно с таким интервалом Google релизит новую версию API Google Ads, и для того, что иметь доступ к новому функционалу необходимо обновлять пакет, обновляется пакет точно так же как и устанавливается, с помощью приведённого выше кода.</em></p>
<p>Теперь давайте перейдём к функциям пакета <em>RAdwords</em>, для того что бы получить список отчётов доступных в какой либо версии API можно воспользоваться функцией <code>reports</code>, для загрузки списка полей, доступных в каком либо отчёте есть функция <code>metrics</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RAdwords)
<span class="kw">reports</span>(<span class="dt">apiVersion =</span> <span class="st">&quot;201806&quot;</span>) <span class="co"># список доступных отчётов</span></code></pre></div>
<pre><code>##  [1] &quot;ACCOUNT_PERFORMANCE_REPORT&quot;                     
##  [2] &quot;AD_CUSTOMIZERS_FEED_ITEM_REPORT&quot;                
##  [3] &quot;AD_PERFORMANCE_REPORT&quot;                          
##  [4] &quot;ADGROUP_PERFORMANCE_REPORT&quot;                     
##  [5] &quot;AGE_RANGE_PERFORMANCE_REPORT&quot;                   
##  [6] &quot;AUDIENCE_PERFORMANCE_REPORT&quot;                    
##  [7] &quot;AUTOMATIC_PLACEMENTS_PERFORMANCE_REPORT&quot;        
##  [8] &quot;BID_GOAL_PERFORMANCE_REPORT&quot;                    
##  [9] &quot;BUDGET_PERFORMANCE_REPORT&quot;                      
## [10] &quot;CALL_METRICS_CALL_DETAILS_REPORT&quot;               
## [11] &quot;CAMPAIGN_AD_SCHEDULE_TARGET_REPORT&quot;             
## [12] &quot;CAMPAIGN_CRITERIA_REPORT&quot;                       
## [13] &quot;CAMPAIGN_GROUP_PERFORMANCE_REPORT&quot;              
## [14] &quot;CAMPAIGN_LOCATION_TARGET_REPORT&quot;                
## [15] &quot;CAMPAIGN_NEGATIVE_KEYWORDS_PERFORMANCE_REPORT&quot;  
## [16] &quot;CAMPAIGN_NEGATIVE_LOCATIONS_REPORT&quot;             
## [17] &quot;CAMPAIGN_NEGATIVE_PLACEMENTS_PERFORMANCE_REPORT&quot;
## [18] &quot;CAMPAIGN_PERFORMANCE_REPORT&quot;                    
## [19] &quot;CAMPAIGN_SHARED_SET_REPORT&quot;                     
## [20] &quot;CLICK_PERFORMANCE_REPORT&quot;                       
## [21] &quot;CREATIVE_CONVERSION_REPORT&quot;                     
## [22] &quot;CRITERIA_PERFORMANCE_REPORT&quot;                    
## [23] &quot;DESTINATION_URL_REPORT&quot;                         
## [24] &quot;DISPLAY_KEYWORD_PERFORMANCE_REPORT&quot;             
## [25] &quot;DISPLAY_TOPICS_PERFORMANCE_REPORT&quot;              
## [26] &quot;FINAL_URL_REPORT&quot;                               
## [27] &quot;GENDER_PERFORMANCE_REPORT&quot;                      
## [28] &quot;GEO_PERFORMANCE_REPORT&quot;                         
## [29] &quot;KEYWORDLESS_CATEGORY_REPORT&quot;                    
## [30] &quot;KEYWORDLESS_QUERY_REPORT&quot;                       
## [31] &quot;KEYWORDS_PERFORMANCE_REPORT&quot;                    
## [32] &quot;LABEL_REPORT&quot;                                   
## [33] &quot;LANDING_PAGE_REPORT&quot;                            
## [34] &quot;MARKETPLACE_PERFORMANCE_REPORT&quot;                 
## [35] &quot;PAID_ORGANIC_QUERY_REPORT&quot;                      
## [36] &quot;PARENTAL_STATUS_PERFORMANCE_REPORT&quot;             
## [37] &quot;PLACEHOLDER_FEED_ITEM_REPORT&quot;                   
## [38] &quot;PLACEHOLDER_REPORT&quot;                             
## [39] &quot;PLACEMENT_PERFORMANCE_REPORT&quot;                   
## [40] &quot;PRODUCT_PARTITION_REPORT&quot;                       
## [41] &quot;SEARCH_QUERY_PERFORMANCE_REPORT&quot;                
## [42] &quot;SHARED_SET_CRITERIA_REPORT&quot;                     
## [43] &quot;SHARED_SET_REPORT&quot;                              
## [44] &quot;SHOPPING_PERFORMANCE_REPORT&quot;                    
## [45] &quot;TOP_CONTENT_PERFORMANCE_REPORT&quot;                 
## [46] &quot;URL_PERFORMANCE_REPORT&quot;                         
## [47] &quot;USER_AD_DISTANCE_REPORT&quot;                        
## [48] &quot;VIDEO_PERFORMANCE_REPORT&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">metrics</span>(<span class="dt">report =</span> <span class="st">&quot;CAMPAIGN_PERFORMANCE_REPORT&quot;</span>, <span class="dt">apiVersion =</span> <span class="st">&quot;201806&quot;</span>)</code></pre></div>
<pre><code>##   [1] AccountCurrencyCode                                  
##   [2] AccountDescriptiveName                               
##   [3] AccountTimeZone                                      
##   [4] ActiveViewCpm                                        
##   [5] ActiveViewCtr                                        
##   [6] ActiveViewImpressions                                
##   [7] ActiveViewMeasurability                              
##   [8] ActiveViewMeasurableCost                             
##   [9] ActiveViewMeasurableImpressions                      
##  [10] ActiveViewViewability                                
##  [11] AdNetworkType1                                       
##  [12] AdNetworkType2                                       
##  [13] AdvertisingChannelSubType                            
##  [14] AdvertisingChannelType                               
##  [15] AllConversionRate                                    
##  [16] AllConversions                                       
##  [17] AllConversionValue                                   
##  [18] Amount                                               
##  [19] AverageCost                                          
##  [20] AverageCpc                                           
##  [21] AverageCpe                                           
##  [22] AverageCpm                                           
##  [23] AverageCpv                                           
##  [24] AverageFrequency                                     
##  [25] AveragePageviews                                     
##  [26] AveragePosition                                      
##  [27] AverageTimeOnSite                                    
##  [28] BaseCampaignId                                       
##  [29] BiddingStrategyId                                    
##  [30] BiddingStrategyName                                  
##  [31] BiddingStrategyType                                  
##  [32] BounceRate                                           
##  [33] BudgetId                                             
##  [34] CampaignDesktopBidModifier                           
##  [35] CampaignGroupId                                      
##  [36] CampaignId                                           
##  [37] CampaignMobileBidModifier                            
##  [38] CampaignName                                         
##  [39] CampaignStatus                                       
##  [40] CampaignTabletBidModifier                            
##  [41] CampaignTrialType                                    
##  [42] ClickAssistedConversions                             
##  [43] ClickAssistedConversionsOverLastClickConversions     
##  [44] ClickAssistedConversionValue                         
##  [45] Clicks                                               
##  [46] ClickType                                            
##  [47] ContentBudgetLostImpressionShare                     
##  [48] ContentImpressionShare                               
##  [49] ContentRankLostImpressionShare                       
##  [50] ConversionCategoryName                               
##  [51] ConversionLagBucket                                  
##  [52] ConversionRate                                       
##  [53] Conversions                                          
##  [54] ConversionTrackerId                                  
##  [55] ConversionTypeName                                   
##  [56] ConversionValue                                      
##  [57] Cost                                                 
##  [58] CostPerAllConversion                                 
##  [59] CostPerConversion                                    
##  [60] CostPerCurrentModelAttributedConversion              
##  [61] CrossDeviceConversions                               
##  [62] Ctr                                                  
##  [63] CurrentModelAttributedConversions                    
##  [64] CurrentModelAttributedConversionValue                
##  [65] CustomerDescriptiveName                              
##  [66] Date                                                 
##  [67] DayOfWeek                                            
##  [68] Device                                               
##  [69] EndDate                                              
##  [70] EngagementRate                                       
##  [71] Engagements                                          
##  [72] EnhancedCpcEnabled                                   
##  [73] ExternalConversionSource                             
##  [74] ExternalCustomerId                                   
##  [75] FinalUrlSuffix                                       
##  [76] GmailForwards                                        
##  [77] GmailSaves                                           
##  [78] GmailSecondaryClicks                                 
##  [79] HourOfDay                                            
##  [80] ImpressionAssistedConversions                        
##  [81] ImpressionAssistedConversionsOverLastClickConversions
##  [82] ImpressionAssistedConversionValue                    
##  [83] ImpressionReach                                      
##  [84] Impressions                                          
##  [85] InteractionRate                                      
##  [86] Interactions                                         
##  [87] InteractionTypes                                     
##  [88] InvalidClickRate                                     
##  [89] InvalidClicks                                        
##  [90] IsBudgetExplicitlyShared                             
##  [91] LabelIds                                             
##  [92] Labels                                               
##  [93] MaximizeConversionValueTargetRoas                    
##  [94] Month                                                
##  [95] MonthOfYear                                          
##  [96] NumOfflineImpressions                                
##  [97] NumOfflineInteractions                               
##  [98] OfflineInteractionRate                               
##  [99] PercentNewVisitors                                   
## [100] Period                                               
## [101] Quarter                                              
## [102] RelativeCtr                                          
## [103] SearchAbsoluteTopImpressionShare                     
## [104] SearchBudgetLostImpressionShare                      
## [105] SearchClickShare                                     
## [106] SearchExactMatchImpressionShare                      
## [107] SearchImpressionShare                                
## [108] SearchRankLostImpressionShare                        
## [109] ServingStatus                                        
## [110] Slot                                                 
## [111] StartDate                                            
## [112] TotalAmount                                          
## [113] TrackingUrlTemplate                                  
## [114] UrlCustomParameters                                  
## [115] ValuePerAllConversion                                
## [116] ValuePerConversion                                   
## [117] ValuePerCurrentModelAttributedConversion             
## [118] VideoQuartile100Rate                                 
## [119] VideoQuartile25Rate                                  
## [120] VideoQuartile50Rate                                  
## [121] VideoQuartile75Rate                                  
## [122] VideoViewRate                                        
## [123] VideoViews                                           
## [124] ViewThroughConversions                               
## [125] Week                                                 
## [126] Year                                                 
## 126 Levels: AccountCurrencyCode AccountDescriptiveName ... Year</code></pre>
<p>Для работы с API Google Ads вам для начала необходимо авторизоваться под каким либо Google аккаунтом, к которому привязан аккаунт Google Ads. Для авторизации вам необходимо использовать функцию <code>doAuth()</code>. При первом запуске этой функции будет открыт браузер, в котором вы выберите нужный аккаунт и подтвердите к нему доступ, при этом в рабочй директории будет создан файл <em>.google.auth.RData</em>, в котором будут хранится учётные данные для работы с API, в дальнейшем вам не придётся проходить авторизацию через браузер т.к. пакет будет запрашивать все необходимые для работы с API данные уже из локального файла.</p>
<p>Формирование и отправка запроса на загрузку каких либо данных из API Google Ads осуществляется в два этапа, с помощью функции <code>statement</code> мы формируем запрос, и отправляем с помощью функции <code>getData</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Составляем запрос</span>
body &lt;-<span class="st"> </span><span class="kw">statement</span>(<span class="dt">select =</span> <span class="kw">c</span>(<span class="st">&quot;Date&quot;</span>,
                             <span class="st">&quot;CampaignName&quot;</span>,
                             <span class="st">&quot;Device&quot;</span>,
                             <span class="st">&quot;Clicks&quot;</span>,
                             <span class="st">&quot;Impressions&quot;</span>,
                             <span class="st">&quot;Cost&quot;</span>),
                  <span class="dt">report =</span> <span class="st">&quot;CAMPAIGN_PERFORMANCE_REPORT&quot;</span>,
                  <span class="dt">where  =</span> <span class="st">&quot;Impressions &gt; 50&quot;</span>,
                  <span class="dt">start  =</span> <span class="st">&quot;2018-07-01&quot;</span>,
                  <span class="dt">end    =</span> <span class="st">&quot;2018-07-31&quot;</span>)

<span class="co"># Запрашиваем данные</span>
data &lt;-<span class="st"> </span><span class="kw">getData</span>(<span class="dt">clientCustomerId       =</span> <span class="st">&quot;123-456-7890&quot;</span>,
                <span class="dt">google_auth            =</span> ads_auth,
                <span class="dt">statement              =</span> body,
                <span class="dt">includeZeroImpressions =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
</div>
<div id="--api--" class="section level2">
<h2><span class="header-section-number">6.3</span> Работа с API Яндекс Директ</h2>
<p>Для работы с API Яндекс Директ в R есть пакет ryandexdirect, его функции позволяют вам выполнять следующие действия:</p>
<ol style="list-style-type: decimal">
<li>Авторизовываться в API.</li>
<li>Получать список различных объектов рекламного кабинета, рекламных кампаний, групп объявлений, объявлений, для агентских аккаунтов можно запрашивать список клиентов, и параметры каждого клиента.</li>
<li>Управлять показами на уровне рекламных кампаний, групп объявлений и объявлений.</li>
<li>Загружать статистику.</li>
<li>Загружать справочную информацию.</li>
</ol>
<p>Для автоизации в API можно использовать функцию <code>yadirAuth</code>, но делать это необязательно т.к. при вызове любой из функций пакета изначально R ищет файл в котором хранятся учётные данные, и если не находит то вы автоматически переходите в браузер для прохождения процесса авторизации.</p>
<div id="-ryandexdirect" class="section level3">
<h3><span class="header-section-number">6.3.1</span> Пакет ryandexdirect</h3>
<p>Устанавливать пакет <code>ryandexdirect</code> рекомендую из моего репозитория на GitHub с помощью команды <code>devtools::install_github('selesnow/ryandexdirect')</code>.</p>
<p>Для прохождения процесса авторизации в ryandexdirect существует функция <code>yadirAuth</code>, но отдельно вызывать её нет необходимости, т.к. при запуске любой из функций пакета, изначально запускается процесс поиска файла хранящего учётные данные, если такой файл функция не находит то автоматически запускается процесс авторизации.</p>
<p>Все функции пакета содержат набор аргументов для работы с учётными данными: * Login - Логин на яндексе клиентского аккаунта, используется для авторизации под обычным, клиентским аккаунтом, а так же в названии файла в котором хранятся учётные данные. * AgencyAccount - Логин на яндексе для управляющего, агентского аккаунта, используется для авторизации под агентским аккаунтом, а так же в названии файла в котором хранятся учётные данные. * TokenPath - Путь к папке в которой вы храните файлы с учётными данными, при первом обращении к API из под какого либо аккаунта файл сохраняется в указанной папке, далее при работе с этим аккаунтом, функции пакета ищут его в указанной папке по аккаунту указанному в аргементе Login или AgencyAccount. * Token - <strong>Устаревший аргумент</strong>, не рекомендуемый к использованию, принимает токен доступа к API в виде строки, сохранён для воспроизведения кода написаного до версии 3.0.0.</p>
<div id="---api--" class="section level4">
<h4><span class="header-section-number">6.3.1.1</span> Загрузка объектов из API Яндекс Директ</h4>
<p>Для загрузки различных объектов из рекламного кабинета Яндекс Директ в пакете <em>ryandecdirect</em> есть одноимённые функции:</p>
<ul>
<li><code>yadirGetCampaignList</code> - Загрузка списка рекламных кампаний</li>
<li><code>yadirGetAdGroups</code> - Загрузка списка групп объявлений</li>
<li><code>yadirGetKeyWords</code> - Загрузка списка ключевых слов</li>
<li><code>yadirGetSiteLinks</code> - Загрузка списка быстрых ссылок</li>
<li><code>yadirGetBalance</code> - Загрузка параметров общего счёта</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ryandexdirect)
<span class="kw">setwd</span>(<span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">r_for_marketing_course</span><span class="ch">\\</span><span class="st">Материалы курса</span><span class="ch">\\</span><span class="st">Модуль 2</span><span class="ch">\\</span><span class="st">Урок 3&quot;</span>)

<span class="co"># Запрос объектов рекламного аккаунта</span>
<span class="co"># Список рекламных кампаний</span>
my_camp   &lt;-<span class="st"> </span><span class="kw">yadirGetCampaignList</span>(<span class="dt">Logins    =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                                  <span class="dt">TokenPath =</span> <span class="st">&quot;direct_tokens&quot;</span>)
<span class="co"># Список групп объявлений</span>
my_group  &lt;-<span class="st"> </span><span class="kw">yadirGetAdGroups</span>(<span class="dt">Login     =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                              <span class="dt">TokenPath =</span> <span class="st">&quot;direct_tokens&quot;</span>)

<span class="co"># Список ключевых слов</span>
my_keyw   &lt;-<span class="st"> </span><span class="kw">yadirGetKeyWords</span>(<span class="dt">Login     =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                              <span class="dt">States    =</span> <span class="st">&quot;ON&quot;</span>,
                              <span class="dt">TokenPath =</span> <span class="st">&quot;direct_tokens&quot;</span>)

<span class="co"># Список быстрых ссылок</span>
my_links  &lt;-<span class="st"> </span><span class="kw">yadirGetSiteLinks</span>(<span class="dt">Login     =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                               <span class="dt">TokenPath =</span> <span class="st">&quot;direct_tokens&quot;</span>)

<span class="co"># Загрузка данных по общему счёту, ключая остаток</span>
balance       &lt;-<span class="st"> </span><span class="kw">yadirGetBalance</span>(<span class="dt">Login     =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                                 <span class="dt">TokenPath =</span> <span class="st">&quot;direct_tokens&quot;</span>)</code></pre></div>
</div>
<div id="----api--" class="section level4">
<h4><span class="header-section-number">6.3.1.2</span> Загрузка справочной информации из API Яндекс Директ</h4>
<p>Для загрузки справочной информации из API Яндекс Директ необхоимо использовать функцию <code>yadirGetDictionary</code>, передав в аргумент <em>DictionaryName</em> название справочника который хотите получить.</p>
<ul>
<li>Currencies - Курсы валют, валютные параметры и ограничения.</li>
<li>MetroStations - Станции метрополитена (только для Москвы, Санкт-Петербурга и Киева).</li>
<li>GeoRegions - Регионы.</li>
<li>TimeZones - Часовые пояса.</li>
<li>Constants - Ограничения на значения параметров.</li>
<li>AdCategories - Особые категории рекламируемых товаров и услуг.</li>
<li>OperationSystemVersions - Версии операционных систем для рекламы мобильных приложений.</li>
<li>ProductivityAssertions - Параметр утратил актуальность и не возвращается.</li>
<li>SupplySidePlatforms - Внешние сети (SSP).</li>
<li>Interests - Интересы к категориям мобильных приложений.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">geo      &lt;-<span class="st"> </span><span class="kw">yadirGetDictionary</span>(<span class="dt">DictionaryName =</span> <span class="st">&quot;GeoRegions&quot;</span>,
                               <span class="dt">Login          =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                               <span class="dt">TokenPath      =</span> <span class="st">&quot;direct_tokens&quot;</span>)

cur      &lt;-<span class="st"> </span><span class="kw">yadirGetDictionary</span>(<span class="dt">DictionaryName =</span> <span class="st">&quot;Currencies&quot;</span>,
                               <span class="dt">Login          =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                               <span class="dt">TokenPath      =</span> <span class="st">&quot;direct_tokens&quot;</span>)

adcategories &lt;-<span class="st"> </span><span class="kw">yadirGetDictionary</span>(<span class="dt">DictionaryName =</span> <span class="st">&quot;AdCategories&quot;</span>,
                                   <span class="dt">Login          =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                                   <span class="dt">TokenPath      =</span> <span class="st">&quot;direct_tokens&quot;</span>)

constant     &lt;-<span class="st"> </span><span class="kw">yadirGetDictionary</span>(<span class="dt">DictionaryName =</span> <span class="st">&quot;Constants&quot;</span>,
                                   <span class="dt">Login          =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                                   <span class="dt">TokenPath      =</span> <span class="st">&quot;direct_tokens&quot;</span>)</code></pre></div>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">6.3.1.3</span> Управление показами</h4>
<p>Помимо загрузки различных объектов из рекламного кабинета с помощью <code>ryandexdirect</code> вы можете останавливать и возобновлять показы на уровне рекламных кампаний, ключевых слов и объявлений.</p>
<p>Для остановки показов необходимо воспользоваться одной из функций: * yadirStopCampaigns - Остановка показов на уровне рекламных кампаний * yadirStopKeyWords - Остановка показов на уровне ключевых слов * yadirStopAds - Остановка показов на уровне объявлений</p>
<p>Возобновление показов осуществляется с помощью группы функций <code>yadirStart</code>: * yadirStartCampaigns - Возобновление показов на уровне рекламных кампаний * yadirStartKeyWords - Возобновление показов на уровне ключевых слов * yadirStartAds - Возобновление показов на уровне объявлений</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Список рекламных кампаний</span>
my_camp   &lt;-<span class="st"> </span><span class="kw">yadirGetCampaignList</span>(<span class="dt">Logins    =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                                  <span class="dt">TokenPath =</span> <span class="st">&quot;direct_tokens&quot;</span>)

<span class="co"># Запуск и остановка показов</span>
<span class="co"># получаем список активных РК</span>
active_campaign_before &lt;-<span class="st"> </span>my_camp<span class="op">$</span>Id[my_camp<span class="op">$</span>State <span class="op">==</span><span class="st"> &quot;ON&quot;</span>]
<span class="co"># остановка рекламных кампаний</span>
<span class="kw">yadirStopCampaigns</span>(<span class="dt">Ids =</span> <span class="kw">c</span>(<span class="dv">30361157</span>, <span class="dv">30361191</span>),
                   <span class="dt">Login          =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                   <span class="dt">TokenPath      =</span> <span class="st">&quot;direct_tokens&quot;</span>)

<span class="co"># получаем список активных РК</span>
my_camp_new &lt;-<span class="st"> </span><span class="kw">yadirGetCampaignList</span>(<span class="dt">Logins    =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                                    <span class="dt">TokenPath =</span> <span class="st">&quot;direct_tokens&quot;</span>)

active_campaign_after_stoped &lt;-<span class="st"> </span>my_camp_new<span class="op">$</span>Id[my_camp_new<span class="op">$</span>State <span class="op">==</span><span class="st"> &quot;ON&quot;</span>]

<span class="co"># запускаем РК</span>
<span class="kw">yadirStartCampaigns</span>(<span class="dt">Ids =</span> <span class="kw">c</span>(<span class="dv">30361157</span>, <span class="dv">30361191</span>),
                    <span class="dt">Login          =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                    <span class="dt">TokenPath      =</span> <span class="st">&quot;direct_tokens&quot;</span>)
<span class="co"># получаем список активных РК</span>
my_camp_new2 &lt;-<span class="st"> </span><span class="kw">yadirGetCampaignList</span>(<span class="dt">Logins    =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                                     <span class="dt">TokenPath =</span> <span class="st">&quot;direct_tokens&quot;</span>)

active_campaign_after_start &lt;-<span class="st"> </span>my_camp_new<span class="op">$</span>Id[my_camp_new2<span class="op">$</span>State <span class="op">==</span><span class="st"> &quot;ON&quot;</span>]

<span class="co"># сверяем со списком который был до остановки</span>
<span class="kw">all.equal</span>(active_campaign_before, active_campaign_after_start)</code></pre></div>
<p>В аргумент <em>Id</em> необходимо передавать вектор Id тех объектов по которым вы хотите запустить или остановить показы.</p>
</div>
<div id="---api--" class="section level4">
<h4><span class="header-section-number">6.3.1.4</span> Загрузка статистики из API Яндекс Директ</h4>
<p>API интерфейс Reports в Яндекс Директ похож на Google Ads, так же состоит из отчётов и полей. На момент последнего редактирования данного конспекта в API ЯНдекс Директ существует 8 отчётов.</p>
<ol style="list-style-type: decimal">
<li>ACCOUNT_PERFORMANCE_REPORT - Статистика по аккаунту рекламодателя</li>
<li>CAMPAIGN_PERFORMANCE_REPORT - Статистика по кампаниям</li>
<li>ADGROUP_PERFORMANCE_REPORT - Статистика по группам объявлений</li>
<li>AD_PERFORMANCE_REPORT - Статистика по объявлениям</li>
<li>CRITERIA_PERFORMANCE_REPORT - Статистика по условиям показа</li>
<li>CUSTOM_REPORT - Статистика с произвольными группировками</li>
<li>REACH_AND_FREQUENCY_PERFORMANCE_REPORT - Статистика по медийным кампаниям. Отчет содержит только данные по кампаниям с типом «Медийная кампания», кампании остальных типов игнорируются</li>
<li>SEARCH_QUERY_PERFORMANCE_REPORT - Статистика по поисковым запросам</li>
</ol>
<p>Актуальный список отчётов можно найти по <a href="https://tech.yandex.ru/direct/doc/reports/type-docpage/">ссылке</a>, список полей можно найти <a href="https://tech.yandex.ru/direct/doc/reports/fields-list-docpage/">тут</a>.</p>
<p>Все поля поделены на 4 группы:</p>
<ul>
<li><p>фильтр — поле используется только для фильтрации данных и не может быть выведено в отчете;</p></li>
<li><p>сегмент — при выводе в отчете поле используется для группировки данных;</p></li>
<li><p>метрика — поле содержит числовое значение, рассчитанное в соответствии с заданными фильтрами и группировками;</p></li>
<li><p>атрибут — поле содержит фиксированное значение в соответствии с заданными группировками, добавление такого поля в отчет не приводит к появлению новой группировки.</p></li>
</ul>
<p>Загрузка статистики осуществляется с помощью функции <code>yadirGetReport</code>, которая принимает следующие аргументы.</p>
<ul>
<li>ReportType - Тип отчёта</li>
<li>DateRangeType - Отчётный период, принимает следующие значения (TODAY, YESTERDAY, LAST_3_DAYS, LAST_5_DAYS, LAST_7_DAYS, LAST_14_DAYS, LAST_30_DAYS, LAST_90_DAYS, LAST_365_DAYS, THIS_WEEK_MON_TODAY ,THIS_WEEK_SUN_TODAY, LAST_WEEK, LAST_BUSINESS_WEEK, LAST_WEEK_SUN_SAT, THIS_MONTH, LAST_MONTH, ALL_TIME, CUSTOM_DATE, AUTO)</li>
<li>DateFrom и DateTo - Дата начала и завершения отчётного перода, используется только если в аргумент <em>DateRangeType</em> установлено значение <em>CUSTOM_DATE</em>.</li>
<li>FieldNames - Список полей отчёта.</li>
<li>FilterList - Вектор содержащий условия фильтрации, пример <code>c(&quot;Clicks GREATER_THAN 99&quot;,&quot;Impressions LESS_THAN 1000&quot;)</code>.</li>
<li>IncludeVAT - Учитывать в расчёте трат НДС или нет.</li>
<li>IncludeDiscount - Учитывать в расчёте трат скидку или нет.</li>
<li>Login - Логин клиентского аккаунта.</li>
<li>AgencyAccount - Логин агентского аккаунта, используется только при работе с агентским аккаунтом.</li>
<li>TokenPath - Путь к папке в которую будет созранён файл с учётными данными, либо где уже есть данный файл.</li>
</ul>
<p>Пример загрузки данных из обычного, клиентского аккаунта:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Загрузка статистики</span>
<span class="co"># Работа с обычным рекламным аккаунтом</span>
<span class="co"># Статистика по рекламным кампаниям за пользовательский период с применением фильтра</span>
my_camp_stat &lt;-<span class="st"> </span><span class="kw">yadirGetReport</span>(<span class="dt">ReportType    =</span> <span class="st">&quot;CAMPAIGN_PERFORMANCE_REPORT&quot;</span>,
                               <span class="dt">DateRangeType =</span> <span class="st">&quot;CUSTOM_DATE&quot;</span>,
                               <span class="dt">DateFrom      =</span> <span class="st">&quot;2018-07-01&quot;</span>,
                               <span class="dt">DateTo        =</span> <span class="st">&quot;2018-07-31&quot;</span>,
                               <span class="dt">FieldNames    =</span> <span class="kw">c</span>(<span class="st">&quot;Date&quot;</span>, <span class="st">&quot;CampaignId&quot;</span>, <span class="st">&quot;Clicks&quot;</span>),
                               <span class="dt">FilterList    =</span> <span class="kw">c</span>(<span class="st">&quot;Clicks GREATER_THAN 1&quot;</span>,<span class="st">&quot;Impressions LESS_THAN 1000&quot;</span>),
                               <span class="dt">IncludeVAT    =</span> <span class="st">&quot;YES&quot;</span>,
                               <span class="dt">IncludeDiscount =</span> <span class="st">&quot;NO&quot;</span>,
                               <span class="dt">Login         =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                               <span class="dt">TokenPath     =</span> <span class="st">&quot;direct_tokens&quot;</span>)

<span class="co"># Статистика за прошлую рабочую неделю</span>
my_daily_stat &lt;-<span class="st"> </span><span class="kw">yadirGetReport</span>(<span class="dt">ReportType      =</span> <span class="st">&quot;CUSTOM_REPORT&quot;</span>,
                                <span class="dt">DateRangeType   =</span> <span class="st">&quot;LAST_BUSINESS_WEEK&quot;</span>,
                                <span class="dt">FieldNames      =</span> <span class="kw">c</span>(<span class="st">&quot;Date&quot;</span>, <span class="st">&quot;Clicks&quot;</span>, <span class="st">&quot;Impressions&quot;</span>),
                                <span class="dt">Login           =</span> <span class="st">&quot;netpeak.vyacheslav&quot;</span>,
                                <span class="dt">IncludeVAT      =</span> <span class="st">&quot;YES&quot;</span>,
                                <span class="dt">IncludeDiscount =</span> <span class="st">&quot;NO&quot;</span>,
                                <span class="dt">TokenPath       =</span> <span class="st">&quot;direct_tokens&quot;</span>)</code></pre></div>
<p>Для работы с агентским аккаунтом вам необходимо указать в аргументе <em>AgencyAccount</em> логин агентского аккаунта, в аругмент <em>Login</em> логин клиентского аккаунта из которого вы хотите загрузить данные.</p>
<p>При работе с агентским аккаунтом в аргумент <em>Login</em> можно передавать вектор содержащий логини клиентских аккаунтов, загрузить список клиентов можно с помощью функции <code>yadirGetClientList</code>, загрузить дополнительные параметры клиентов из агентского аккаунта можно с помощью функции <code>yadirGetClientParam</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Работа с агентским рекламным аккаунтом</span>
<span class="co"># загрузка списка клиентов</span>
my_client &lt;-<span class="st"> </span><span class="kw">yadirGetClientList</span>(<span class="dt">AgencyAccount =</span> <span class="st">&quot;netpeak.kz&quot;</span>,
                                <span class="dt">TokenPath     =</span> <span class="st">&quot;direct_tokens&quot;</span>)

<span class="co"># Загрузка данных о стране клиента, валюте аккаунта, оценка показателя качества аккаунтаа</span>
my_cl_param &lt;-<span class="st"> </span><span class="kw">yadirGetClientParam</span>(<span class="dt">AgencyAccount =</span> <span class="st">&quot;netpeak.kz&quot;</span>,
                                   <span class="dt">TokenPath     =</span> <span class="st">&quot;direct_tokens&quot;</span>)

<span class="co"># загрузка статистики по клиентам</span>
my_client_stat &lt;-<span class="st"> </span><span class="kw">yadirGetReport</span>(<span class="dt">ReportType      =</span> <span class="st">&quot;CUSTOM_REPORT&quot;</span>,
                                 <span class="dt">DateRangeType   =</span> <span class="st">&quot;LAST_BUSINESS_WEEK&quot;</span>,
                                 <span class="dt">FieldNames      =</span> <span class="kw">c</span>(<span class="st">&quot;Clicks&quot;</span>, <span class="st">&quot;Impressions&quot;</span>),
                                 <span class="dt">AgencyAccount   =</span> <span class="st">&quot;netpeak.kz&quot;</span>,
                                 <span class="dt">Login           =</span> my_client<span class="op">$</span>Login[<span class="dv">5</span><span class="op">:</span><span class="dv">11</span>],
                                 <span class="dt">IncludeVAT      =</span> <span class="st">&quot;YES&quot;</span>,
                                 <span class="dt">IncludeDiscount =</span> <span class="st">&quot;NO&quot;</span>,
                                 <span class="dt">TokenPath       =</span> <span class="st">&quot;direct_tokens&quot;</span>)</code></pre></div>
</div>
</div>
</div>
<div id="--api-facebook" class="section level2">
<h2><span class="header-section-number">6.4</span> Работа с API Facebook</h2>
<p>Для работы с API Facebook мною был разработан пакет <code>rfacebookstat</code>, функции данного пакета позволяют.</p>
<ol style="list-style-type: decimal">
<li>Загружать объекты из рекламного кабинета Facebook.</li>
<li>Загружать статистику из рекламных кабинетов Facebook.</li>
<li>Управлять доступами к реламным кабинетам Facebook.</li>
</ol>
<p>Установить пакет <code>rfacebookstat</code> можно как из моего репозитория на GitHub, так и из основного репозитория CRAN.</p>
<ul>
<li>Установка с GitHub - <code>devtools::install_github('selesnow/rfacebokstat')</code></li>
<li>Установка с CRAN - <code>install.packages('rfacebookstat')</code></li>
</ul>
<div id="---facebook" class="section level3">
<h3><span class="header-section-number">6.4.1</span> Создание приложения в Facebook</h3>
<p>Для доступа к API Facebook вам необходимо создать приложение в веб интерфейсе Facebook.</p>
<p>1, В основном меню Facebook выберите пункт “Управление приложениями” или перейдите по <a href="https://developers.facebook.com/apps/">этой ссылке</a>.</p>
<div class="figure">
<img src="r_for_marketing_2018_files/figure-html/fb_app_1.png" alt="Создание приложения в Facebook" />
<p class="caption">Создание приложения в Facebook</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Нажмите кнопку “Добавить новое приложение”, которая находится в правом верхнем углу.</li>
<li>Заполните поля в открывшемся дилоговом окне “Создайте ID приложения” и нажмите кнопку ЭСоздайте ID приложения&quot;</li>
<li>Добавьте продукты “API Marketing” и “Вход через Facebook”</li>
</ol>
<div class="figure">
<img src="r_for_marketing_2018_files/figure-html/fb_app_2.png" alt="Добавление продуктов" />
<p class="caption">Добавление продуктов</p>
</div>
<ol start="5" style="list-style-type: decimal">
<li>В настройка продукта “Вход через Facebook” установите в качестве Действительные URI перенаправления для OAuth ссылку - <a href="https://selesnow.github.io/rfacebookstat/getToken/get_token.html" class="uri">https://selesnow.github.io/rfacebookstat/getToken/get_token.html</a> <img src="r_for_marketing_2018_files/figure-html/fb_app_3.png" alt="Настраиваем доступ через Facebook" /></li>
</ol>
</div>
<div id="--api-facebook" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Авторизация в API Facebook</h3>
<p>Для прохождения процесса авторизации в API Facebook вам необходимо использовать 2 функции:</p>
<ul>
<li><code>fbGetToken</code> - Для получения краткосрочного токена.</li>
<li><code>fbGetLongTimeToken</code> - Для обмена кратсрочного токена на долгосрочный.</li>
</ul>
<p>В качестве аргументов вам понадобится информация по идентификатору и секрету созданного на прошлом шаге приложения, найти эту информацию можно в его настройках, перейдя в меню “Основное.” <img src="https://img.netpeak.ua/alsey/153660172179_kiss_20kb.png" alt="Настройки приложения" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># авторизация в API</span>
<span class="co"># краткосрочный токен</span>
my_st_token &lt;-<span class="st"> </span><span class="kw">fbGetToken</span>(<span class="dt">app_id =</span> <span class="dv">1672451129546934</span>)

<span class="co"># долгосрочный токен</span>
fb_token    &lt;-<span class="st"> </span><span class="kw">fbGetLongTimeToken</span>(<span class="dt">client_id =</span> <span class="dv">1672451129546934</span>,
                                  <span class="dt">client_secret =</span> <span class="st">&quot;a6c01acdb9a4100216de5f8874adbce5&quot;</span>,
                                  <span class="dt">fb_exchange_token =</span> my_st_token)

<span class="co"># Сохраняем токен</span>
<span class="kw">save</span>(<span class="dt">file =</span> <span class="st">&quot;fb_token.RData&quot;</span>)</code></pre></div>
<p>Таким образом мы авторизовались в API, поменяли краткосрочный токен на долгосрочный, и сохранили его в рабочей директории в файл fb_token.RData.</p>
</div>
<div id="-----facebook" class="section level3">
<h3><span class="header-section-number">6.4.3</span> Загрузка объектов из рекламного кабинета Facebook</h3>
<p>Для загрузки различных объектов из рекламного кабинета в пакете <strong>rfacebookstat</strong> существуют одноимённые функции.</p>
<div id="----" class="section level4">
<h4><span class="header-section-number">6.4.3.1</span> Загрузка объектов из бизнес менеджера</h4>
<ul>
<li><code>fbGetBusinessManagers</code> - Загрузка списка доступных бизнес менеджеров</li>
<li><code>fbGetProjects</code> - Загрузка списка проектов из бизнес менеджера</li>
<li><code>fbGetAdAccounts</code> - Загрузка списка рекламных аккаунтов</li>
<li><code>fbGetPages</code> - Загрузка списка продвигаемых страниц из проектоа</li>
<li><code>fbGetApps</code> - Загрузка списка приложений</li>
</ul>
<p><strong>Аргументы</strong> которые встречаются в функциях для загрузки объектов из бизнес менеджера:</p>
<ul>
<li>access_token - Токен полученный при авторизации в API</li>
<li>bussiness_id - ID бизнес менеджера</li>
<li>source_id - ID бизнес менеджера или проекта</li>
<li>projects_id - ID проекта</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># бизнес менеджеры</span>
my_fb_bm   &lt;-<span class="st"> </span><span class="kw">fbGetBusinessManagers</span>(<span class="dt">access_token =</span> fb_token)

<span class="co"># проекты из бизнес менеджера</span>
my_fb_proj &lt;-<span class="st"> </span><span class="kw">fbGetProjects</span>(<span class="dt">bussiness_id =</span> my_fb_bm<span class="op">$</span>id,
                            <span class="dt">access_token =</span> fb_token)
<span class="co"># рекламные аккаунты</span>
my_fb_acc  &lt;-<span class="st"> </span><span class="kw">fbGetAdAccounts</span>(<span class="dt">source_id =</span> my_fb_bm<span class="op">$</span>id,
                              <span class="dt">access_token =</span> fb_token)
<span class="co"># страницы</span>
my_fb_page &lt;-<span class="st"> </span><span class="kw">fbGetPages</span>(<span class="dt">projects_id =</span> my_fb_proj<span class="op">$</span>id, <span class="dt">access_token =</span> fb_token)
<span class="co"># приложения</span>
my_fb_apps &lt;-<span class="st"> </span><span class="kw">fbGetApps</span>(<span class="dt">projects_id =</span> my_fb_proj<span class="op">$</span>id, <span class="dt">access_token =</span> fb_token)</code></pre></div>
</div>
<div id="----" class="section level4">
<h4><span class="header-section-number">6.4.3.2</span> Загрузка объектов из рекламного аккаунта</h4>
<ul>
<li><code>fbGetCampaigns</code> - Загрузка списка рекламных кампаний</li>
<li><code>fbGetAdSets</code> - Загрузка списка групп объявлений</li>
<li><code>fbGetAds</code> -Загрузка списка объявлений</li>
<li><code>fbGetAdCreative</code> - Загрузка контента объявлений</li>
</ul>
<p><strong>Аргументы</strong> которые встречаются в функциях для загрузки объектов из рекламного аккаунта:</p>
<ul>
<li>accounts_id - ID рекламного кабинета, в формате act_00000000000</li>
<li>access_token - Токен полученный при авторизации в API</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Объекты рекламного аккаунта</span>
<span class="co"># кампании</span>
my_fb_camp &lt;-<span class="st"> </span><span class="kw">fbGetCampaigns</span>(<span class="dt">accounts_id  =</span> <span class="st">&quot;act_262115113&quot;</span>,
                             <span class="dt">access_token =</span> fb_token)

<span class="co"># группы объявлений</span>
my_fb_adsets &lt;-<span class="st"> </span><span class="kw">fbGetAdSets</span>(<span class="dt">accounts_id  =</span> <span class="st">&quot;act_262115113&quot;</span>,
                            <span class="dt">access_token =</span> fb_token)
<span class="co"># объявления</span>
my_fb_ads    &lt;-<span class="st"> </span><span class="kw">fbGetAds</span>(<span class="dt">accounts_id  =</span> <span class="st">&quot;act_262115113&quot;</span>,
                         <span class="dt">access_token =</span> fb_token)

<span class="co"># контент объявлений</span>
my_fb_ad_content &lt;-<span class="st"> </span><span class="kw">fbGetAdCreative</span>(<span class="dt">accounts_id  =</span> <span class="st">&quot;act_262115113&quot;</span>,
                                    <span class="dt">access_token =</span> fb_token)</code></pre></div>
</div>
<div id="-----facebook" class="section level4">
<h4><span class="header-section-number">6.4.3.3</span> Загрузка статистики из рекламного аккаунта Facebook</h4>
<p>Статистику из рекламного кабинета можно получить с помощью функции <code>fbGetMarketingStat</code>.</p>
<p><strong>Аргументы</strong> доступные в функции <code>fbGetMarketingStat</code>:</p>
<ul>
<li><p>accounts_id — ID рекламного аккаунта. Это обязательный аргумент. Вы можете получить его из URL, если перейдете в нужный рекламный аккаунт Facebook, указывайте ID аккаунта с приставкой «act_», как в примере: accounts_id = “act_000000000000”.</p></li>
<li><p>sorting — cортировка данных. Необязательный аргумент. На входе принимает список полей и направление сортировки (по возрастанию или по убыванию). Пример: reach_descending, impressions_ascending.</p></li>
<li><p>level — уровень детализации данных. Обязательный аргумент. Принимает значения ad, adset, campaign, account. Пример — level = “account”.</p></li>
<li><p>fields — список полей, по которым вы планируете получить данные. Обязательный аргумент. Пример: fields = “account_id,account_name,campaign_name,impressions,unique_impressions,clicks,unique_clicks,reach,spend”. Актуальный список всех доступных полей можно посмотреть в официальной документации к API по <a href="https://developers.facebook.com/docs/marketing-api/insights/fields/">ссылке</a>.</p></li>
<li><p>filtering — фильтр данных. Необязательный аргумент. Фильтры задаются в виде JSON объектов «ключ:значение». Необходимо прописать три свойства:</p>
<ul>
<li>field — поле, по которому будет осуществляться фильтрация;</li>
<li>operator — оператор логического значения (‘EQUAL’, ‘NOT_EQUAL’, ‘GREATER_THAN’, ‘GREATER_THAN_OR_EQUAL’, ‘LESS_THAN’, ‘LESS_THAN_OR_EQUAL’, ‘IN_RANGE’, ‘NOT_IN_RANGE’, ‘CONTAIN’, ‘NOT_CONTAIN’, ‘IN’, ‘NOT_IN’, ‘ANY’, ‘ALL’, ‘NONE’);</li>
<li>value — значения, по которому будет фильтроваться указанное поле. Пример: filtering = “[{‘field’:‘publisher_platform’,‘operator’:‘IN’,‘value’:[‘instagram’]}]</li>
</ul></li>
<li><p>breakdowns — аргумент, с помощью которого можно получить данные в разбивке на различные сегменты. Список доступных срезов информации, а так же информацию о том как они могут друг с другом сочитаться можно посмотреть в официальной документации к API по <a href="https://developers.facebook.com/docs/marketing-api/insights/breakdowns/">ссылке</a>.</p></li>
<li><p>date_start — начальная дата отчетного периода в формате YYYY-MM-DDD.</p></li>
<li><p>date_stop — конечная дата отчетного периода в формате YYYY-MM-DDD.</p></li>
<li><p>interval - временная разбивка, допустимые значения “day”, “week”, “month”, “quarter”, “year”, “overall”</p></li>
<li>console_type - текстовое значение, тип ответов в консоли, принимает одно из двух значений:
<ul>
<li>progressbar (по умолчанию) - для вывода в консоли прогресс бара, отображающего % загруженных даных.</li>
<li>message - для вывода сообщений о процессе загрузки, например вывод сообщений о том, что был запущен механизм обхода пользовательского лимита на количество допустимых запросов к API Facebook.</li>
</ul></li>
<li>request_speed - скорость оправки запросов к API, в зависимости от уровня доступа вашего приложения установите следующее значение:
<ul>
<li>Уровень доступа к API Development - “slow”</li>
<li>Уровень доступа к API Basic - “normal”</li>
<li>Уровень доступа к API Standart - “fast” Подробно работа с этим аргументом описана <a href="https://alexeyseleznev.wordpress.com/2017/12/26/rfacebookstat-1-5-0-%D0%BA%D0%B0%D0%BA-%D0%BF%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D1%8C%D0%BD%D0%BE-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D1%8C-%D0%B0%D1%80%D0%B3%D1%83%D0%BC/">тут</a>. Информация об уровнях доступа к API Facebook находится <a href="https://developers.facebook.com/docs/marketing-api/access">тут</a>.</li>
</ul></li>
<li><p>api_version — версия API Facebook, в формате v<em>.</em>, например “v3.1”</p></li>
<li><p>access_token — токен доступа.</p></li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_fb_stats &lt;-<span class="st"> </span><span class="kw">fbGetMarketingStat</span>(<span class="dt">accounts_id =</span> <span class="st">&quot;act_262115113&quot;</span>,
                                  <span class="dt">level =</span> <span class="st">&quot;campaign&quot;</span>,
                                  <span class="dt">fields =</span> <span class="st">&quot;account_name,campaign_name,impressions,clicks&quot;</span>,
                                  <span class="dt">breakdowns =</span> <span class="st">&quot;device_platform&quot;</span>,
                                  <span class="dt">date_start =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                                  <span class="dt">date_stop =</span> <span class="st">&quot;2018-08-07&quot;</span>,
                                  <span class="dt">interval =</span> <span class="st">&quot;day&quot;</span>,
                                  <span class="dt">access_token =</span> fb_token)</code></pre></div>
</div>
<div id="--------facebook" class="section level4">
<h4><span class="header-section-number">6.4.3.4</span> Управление списком пользователей и доступами к рекламного аккаунта Facebook</h4>
<ul>
<li><code>fbGetAdAccountUsers</code> - Получить список пользователей из рекламного аккаунта</li>
<li><code>fbDeleteAdAccountUsers</code> - Удалить пользователя рекламого аккаунта</li>
<li><code>fbUpdateAdAccountUsers</code> - Добавить пользователя в рекламный аккаунт.</li>
</ul>
<p><strong>Аргументы</strong></p>
<ul>
<li>accounts_id - ID рекламного аккаунта в формате act_0000000000</li>
<li>access_token - Токен доступа к API Facebook</li>
<li>user_ids - ID пользователя</li>
<li>role - Роль, которая определяет набор порав, которые будут у пользователя рекламного аккаунта, возможные значения: administator, advertiser, ad manager, analyst, sales, direct sales. Подробнее о полях можно узнать по <a href="https://developers.facebook.com/docs/marketing-api/aduser/">ссылке</a>.</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># управление пользователями</span>
<span class="co"># загрузка списка пользоватеелей</span>
fb_acc_user &lt;-<span class="st"> </span><span class="kw">fbGetAdAccountUsers</span>(<span class="dt">accounts_id  =</span>  <span class="st">&quot;act_262115113&quot;</span>,
                                   <span class="dt">access_token =</span> fb_token,
                                   <span class="dt">console_type =</span> <span class="st">&quot;message&quot;</span>)

<span class="co"># удаление пользователя с ID 823041644481205</span>
<span class="kw">fbDeleteAdAccountUsers</span>(<span class="dt">user_ids =</span> <span class="st">&quot;823041644481205&quot;</span>,
                       <span class="dt">accounts_id  =</span>  <span class="st">&quot;act_262115113&quot;</span>,
                       <span class="dt">access_token =</span> fb_token,
                       <span class="dt">api_version =</span> <span class="st">&quot;v3.1&quot;</span>)

<span class="co"># загрузка списка пользоватеелей</span>
fb_acc_user2 &lt;-<span class="st"> </span><span class="kw">fbGetAdAccountUsers</span>(<span class="dt">accounts_id  =</span>  <span class="st">&quot;act_262115113&quot;</span>,
                                    <span class="dt">access_token =</span> fb_token,
                                    <span class="dt">console_type =</span> <span class="st">&quot;message&quot;</span>)

<span class="co"># сравнение списка пользователей до и после удаления пользователя с ID 823041644481205</span>
<span class="kw">all.equal</span>(fb_acc_user, fb_acc_user2)

<span class="co"># добавление пользователя</span>
<span class="kw">fbUpdateAdAccountUsers</span>(<span class="dt">user_ids =</span> <span class="st">&quot;823041644481205&quot;</span>, 
                       <span class="dt">accounts_id =</span> <span class="st">&quot;act_262115113&quot;</span>, 
                       <span class="dt">role =</span> <span class="st">&quot;advertiser&quot;</span>,
                       <span class="dt">access_token =</span> fb_token)</code></pre></div>
</div>
</div>
</div>
<div id="--api--vk.com" class="section level2">
<h2><span class="header-section-number">6.5</span> Работа с API Вконтакте (vk.com)</h2>
<p>Для работы с API Вконтакте необходимо установить пакет <code>rvkstat</code>, на данный момент пакет доступен только из моего репозитория на GitHub, для установки воспользуйтесь командой <code>devtools::install_github('selesnow/rvkstat')</code>.</p>
<div id="-----api-" class="section level3">
<h3><span class="header-section-number">6.5.1</span> Создание приложения для работы с API Вконтакте</h3>
Для создания приложения перейдите по этой <a href="https://vk.com/editapp?act=create">ссылке</a>, и выберите в разделе платформа Веб-сайт, если вы планируете загрузить диалоги из сообщества выбирайте - Standalone-приложение.
<p align="center">
<img src="http://img.netpeak.ua/alsey/152232828829_kiss_19kb.png" data-canonical-src="http://img.netpeak.ua/alsey/152232828829_kiss_19kb.png" style="max-width:100%;">
</p>
<p>Далее, если вы создали веб приложение перейдите в меню настроек приложения, и влючите Open API: <img src="http://img.netpeak.ua/alsey/152232852842_kiss_39kb.png" alt="настройки приложения - Open API - Включить" /></p>
<p>После чего появятся настройки Open API, введите в них следующие значения: <b>Адрес сайта: </b><a href="http://selesnow.github.io" class="uri">http://selesnow.github.io</a> <Br> <b>Адрес сайта: </b>selesnow.github.io <Br> <b>Доверенный redirect URI: </b><a href="https://selesnow.github.io/rvkstat/getCode/get_code.html" class="uri">https://selesnow.github.io/rvkstat/getCode/get_code.html</a> <Br> <b>Доверенный redirect URI: </b><a href="https://selesnow.github.io/rvkstat/getCode/get_token.html" class="uri">https://selesnow.github.io/rvkstat/getCode/get_token.html</a> <Br> <b>Доверенный redirect URI: </b><a href="https://oauth.vk.com/blank.html" class="uri">https://oauth.vk.com/blank.html</a> <Br> <img src="http://img.netpeak.ua/alsey/152232876897_kiss_27kb.png" alt="Настройка Open API" /></p>
<p>Для начала работы с функциями пакета и для того, что бы с помощью <a href="##Форма-для-получения-токена-доступа-пользователя-по-схеме-implict-flow">формы получения токена</a> или функции авторизации в Вконтакте получить токен разработчика используйте ID и Защищённый ключ приложения, вы в любой момент сможете найти их в настройках вашего приложения.</p>
<div class="figure">
<img src="http://img.netpeak.ua/alsey/152232895640_kiss_14kb.png" alt="ID и секрет приложения" />
<p class="caption">ID и секрет приложения</p>
</div>
</div>
<div id="--api-" class="section level3">
<h3><span class="header-section-number">6.5.2</span> Авторизация в API Вконтакте</h3>
<p>Для прохождения авторизации в <code>rvkstat</code> есть несколько функций, но рекомендуется использовать <code>vkAuth</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myToken &lt;-<span class="st"> </span><span class="kw">vkAuth</span>(<span class="dt">app_id =</span> <span class="op">&lt;</span>ID Вашего Приложения<span class="op">&gt;</span>, 
                  <span class="dt">app_secret =</span> <span class="op">&lt;</span>Защищённый Ключ Вашего Приложения<span class="op">&gt;</span>)</code></pre></div>
</div>
<div id="--rvkstat" class="section level3">
<h3><span class="header-section-number">6.5.3</span> Функции пакета rvkstat</h3>
<p>Все функции пакета поделены на 4 группы, определить к какой группе относится функция можно из её названия, название группы к которой относится функция идёт сразу после префикса vk:</p>
<ul>
<li>GetGroupStat - загрузка статистики по сообществам Вконтакте.</li>
<li>GetAd - загрузка данных из рекламного кабинета Вконтакте.</li>
<li>GetDb - загрузка справочной информации из Вконтакте.</li>
<li>GetUser - загрузка данных о конкретном пользователе Вконтакте.</li>
</ul>
</div>
<div id="-----" class="section level3">
<h3><span class="header-section-number">6.5.4</span> Загрузка объектов из рекламного кабинета Вконтакте</h3>
<ul>
<li><code>vkGetAdCategories</code> - получить справочник тематик рекламных объявлений</li>
<li><code>vkGetAdAccounts</code> - получить список рекламных аккаунтов</li>
<li><code>vkGetAdClients</code> - получить список клиентов из агентского аккаунта</li>
<li><code>vkGetAdCampaigns</code> - получить список рекламных кампаний</li>
<li><code>vkGetAds</code> - получить список объявлений</li>
<li><code>vkGetAdsLayout</code> - получить внешний вид объявлений</li>
</ul>
<p><strong>Аргументы</strong> функций для работы с рекламным кабинетом:</p>
<ul>
<li>access_token - токен доступа к API, полученный с помощью функции <code>vkAuth</code></li>
<li>account_id - id рекламного кабинета</li>
<li>client_id - id клиентского реклманого кабинета, при работе через агентский аккаунт</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vk_auth &lt;-<span class="st"> </span><span class="kw">vkAuth</span>(<span class="dt">app_id =</span> <span class="dv">6656352</span>, <span class="dt">app_secret =</span> <span class="st">&quot;wSGrZuNEs1D4RbffGKDY&quot;</span>)

<span class="co"># работа с рекламнымы аккаунтами</span>
<span class="co"># получить справочник тематик рекламных объявлений</span>
category &lt;-<span class="st"> </span><span class="kw">vkGetAdCategories</span>(<span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token, <span class="dt">api_version =</span> <span class="st">&quot;5.73&quot;</span>)

<span class="co"># получить список рекламных аккаунтов</span>
vk_acc &lt;-<span class="st"> </span><span class="kw">vkGetAdAccounts</span>(<span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token)
<span class="co"># получить список клиентов из агентского аккаунта</span>
vk_client &lt;-<span class="st"> </span><span class="kw">vkGetAdClients</span>(<span class="dt">account_id =</span> <span class="dv">1900000891</span>,
                            <span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token,
                            <span class="dt">api_version =</span> <span class="st">&quot;5.73&quot;</span>)
<span class="co"># получить список рекламных кампаний</span>
vk_camp   &lt;-<span class="st"> </span><span class="kw">vkGetAdCampaigns</span>(<span class="dt">account_id =</span> <span class="dv">1900000891</span>,
                              <span class="dt">client_id =</span> <span class="dv">1602773233</span>,
                              <span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token)
<span class="co"># получить список объявлений</span>
vk_ads    &lt;-<span class="st"> </span><span class="kw">vkGetAds</span>(<span class="dt">account_id =</span> <span class="dv">1900000891</span>,
                      <span class="dt">client_id =</span> <span class="dv">1602773233</span>,
                      <span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token)

<span class="co"># внешний вид объявлений</span>
vk_ad_layout &lt;-<span class="st"> </span><span class="kw">vkGetAdsLayout</span>(<span class="dt">account_id =</span> <span class="dv">1900000891</span>,
                               <span class="dt">client_id =</span> <span class="dv">1602773233</span>,
                               <span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token)</code></pre></div>
</div>
<div id="-----" class="section level3">
<h3><span class="header-section-number">6.5.5</span> Загрузка статистики из рекламного кабинета Вконтакте</h3>
<p>Получить статистические данные из рекламного кабинета Вконтакте можно с помощью функции <code>vkGetAdStatistics</code>.</p>
<p><em>Аргументы</em> функции <code>vkGetAdStatistics</code></p>
<ul>
<li>account_id - Идентификатор рекламного кабинета, список всех доступных рекламных кабинетов можно получить с помщью функции vkGetAdAccounts.</li>
<li>ids_type - Тип запрашиваемых объектов, которые перечислены в параметре ids, допустимые значения:</li>
<li>ad — объявления</li>
<li>campaign — кампании</li>
<li>client — клиенты</li>
<li>office — кабинет</li>
<li>ids - Перечисленные через запятую id запрашиваемых объявлений, кампаний, клиентов или кабинета, в зависимости от того, что указано в параметре ids_type.</li>
<li>period - Способ группировки данных по датам, допустимые значения:</li>
<li>day — статистика по дням</li>
<li>month — статистика по месяцам</li>
<li>overall — статистика за всё время</li>
<li>date_from - Начальная дата выводимой статистики. Используется разный формат дат для разного значения параметра period</li>
<li>day: YYYY-MM-DD, пример: 2011-09-27 - 27 сентября 2011</li>
<li>month: YYYY-MM, пример: 2011-09 - сентябрь 2011</li>
<li>overall: 0</li>
<li>date_to - Конечная дата выводимой статистики. Используется разный формат дат для разного значения параметра period:</li>
<li>day: YYYY-MM-DD, пример: 2011-09-27 - 27 сентября 2011</li>
<li>month: YYYY-MM, пример: 2011-09 - сентябрь 2011</li>
<li>overall: 0</li>
<li>api_version - Версия API к который вы будете обращаться, список актуальных версий доступен по <a href="https://vk.com/dev/versions">ссылке</a>.</li>
<li>access_token - Токен доступа к API, полученный с помощью функций vkAuth</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Статистика рекламного кабинета</span>
camp_stat &lt;-<span class="st"> </span><span class="kw">vkGetAdStatistics</span>(<span class="dt">account_id =</span> <span class="dv">1900000891</span>,
                               <span class="dt">ids        =</span> vk_camp<span class="op">$</span>id,
                               <span class="dt">ids_type   =</span> <span class="st">&quot;campaign&quot;</span>,
                               <span class="dt">period     =</span> <span class="st">&quot;day&quot;</span>,
                               <span class="dt">date_from  =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                               <span class="dt">date_to    =</span> <span class="st">&quot;2018-08-08&quot;</span>,
                               <span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token)

<span class="co"># Статистика по клиентам агентского аккаунта</span>
client_stat &lt;-<span class="st"> </span><span class="kw">vkGetAdStatistics</span>(<span class="dt">account_id   =</span> <span class="dv">1900000891</span>,
                                 <span class="dt">ids          =</span> vk_client<span class="op">$</span>id,
                                 <span class="dt">ids_type     =</span> <span class="st">&quot;client&quot;</span>,
                                 <span class="dt">period       =</span> <span class="st">&quot;month&quot;</span>,
                                 <span class="dt">date_from    =</span> <span class="st">&quot;2018-01-01&quot;</span>,
                                 <span class="dt">date_to      =</span> <span class="st">&quot;2018-08-08&quot;</span>,
                                 <span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token,
                                 <span class="dt">api_version  =</span> <span class="st">&quot;5.73&quot;</span>)</code></pre></div>
</div>
<div id="------" class="section level3">
<h3><span class="header-section-number">6.5.6</span> Загрузка статистики по сообществам и группам Вконтакте</h3>
<p>Функции для работы со статистикой сообществ Вконтакте:</p>
<ul>
<li><code>vkGetUserGroups</code> - Список групп пользователя</li>
<li><code>vkGetGroupStat</code> - Общая статистика по сообществу</li>
<li><code>vkGetGroupStatAge</code> - Статистика по посетителям сообщества в разбивке по возрасту</li>
<li><code>vkGetGroupStatGender</code> - Статистика по посетителям сообщества в разбивке по полу</li>
<li><code>vkGetGroupStatGenderAge</code> - Статистика по посетителям сообщества в разбивке по полу и возрасту</li>
<li><code>vkGetGroupStatCity</code> - Статистика по посетителям сообщества в разбивке по городам</li>
<li><code>vkGetGroupStatCountries</code> - Статистика по посетителям сообщества в разбивке по странам</li>
</ul>
<p><strong>Аргументы</strong></p>
<ul>
<li>date_from - начальная дата отчётного периода</li>
<li>date_to - конечная дата отчётного периода</li>
<li>group_id - id сообщества по которому хотите получить статистику</li>
<li>access_token - токен полученный с помощью функции vkAuth</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># статистика сообщества</span>
<span class="co"># получить список всех групп пользователя</span>
my_groups &lt;-<span class="st"> </span><span class="kw">vkGetUserGroups</span>(<span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token)

<span class="co"># общаяя статистика по сообществу</span>
gr_stat &lt;-<span class="st"> </span><span class="kw">vkGetGroupStat</span>(<span class="dt">date_from =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                          <span class="dt">date_to =</span> <span class="st">&quot;2018-08-08&quot;</span>,
                          <span class="dt">group_id =</span> <span class="dv">119709976</span>,
                          <span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token)

<span class="co"># статистика по посетителям сообщества в разбивке по возрасту</span>
gr_stat_age &lt;-<span class="st"> </span><span class="kw">vkGetGroupStatAge</span>(<span class="dt">date_from =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                                 <span class="dt">date_to =</span> <span class="st">&quot;2018-08-08&quot;</span>,
                                 <span class="dt">group_id =</span> <span class="dv">119709976</span>,
                                 <span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token)

<span class="co"># статистика по посетителям сообщества в разбивке по полу</span>
gr_stat_gender &lt;-<span class="st"> </span><span class="kw">vkGetGroupStatGender</span>(<span class="dt">date_from =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                                       <span class="dt">date_to =</span> <span class="st">&quot;2018-08-08&quot;</span>,
                                       <span class="dt">group_id =</span> <span class="dv">119709976</span>,
                                       <span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token)

<span class="co"># статистика по посетителям сообщества в разбивке по полу и возрасту</span>
gr_stat_gen_age &lt;-<span class="st"> </span><span class="kw">vkGetGroupStatGenderAge</span>(<span class="dt">date_from =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                                           <span class="dt">date_to =</span> <span class="st">&quot;2018-08-08&quot;</span>,
                                           <span class="dt">group_id =</span> <span class="dv">119709976</span>,
                                           <span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token)

<span class="co"># статистика по посетителям сообщества в разбивке по городам</span>
gr_stat_city &lt;-<span class="st"> </span><span class="kw">vkGetGroupStatCity</span>(<span class="dt">date_from =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                                   <span class="dt">date_to =</span> <span class="st">&quot;2018-08-08&quot;</span>,
                                   <span class="dt">group_id =</span> <span class="dv">119709976</span>,
                                   <span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token)

<span class="co"># статистика по посетителям сообщества в разбивке по странам</span>
gr_stat_country &lt;-<span class="st"> </span><span class="kw">vkGetGroupStatCountries</span>(<span class="dt">date_from =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                                           <span class="dt">date_to =</span> <span class="st">&quot;2018-08-08&quot;</span>,
                                           <span class="dt">group_id =</span> <span class="dv">119709976</span>,
                                           <span class="dt">access_token =</span> vk_auth<span class="op">$</span>access_token)</code></pre></div>
</div>
</div>
<div id="--api-mytarget" class="section level2">
<h2><span class="header-section-number">6.6</span> Работа с API MyTarget</h2>
<p>Для работы с API интерфейсом рекламной платформы MyTarget вам необходимо установить пакет <code>rmytarget</code>, данный пакет пока доступен только для установки из моего репозитория на GitHub, для усатановки выполните команду <code>devtools::install_github(&quot;selesnow/rmytarget&quot;)</code>.</p>
<p>В <code>rmytarget</code> на данный момент всего 4 основные функции:</p>
<ul>
<li><code>myTarGetCampaignList</code> - Загрузка списка рекламных кампаний</li>
<li><code>myTarGetAdList</code> - Загрузка списка объявлений</li>
<li><code>myTarGetStats</code> - Загрузка статистики по рекламным кампаниям или ообъявлениям</li>
<li><code>myTarGetClientList</code> - Загрузка списка клиентов из агентского аккаунта</li>
</ul>
<div id="--api-mytarget" class="section level3">
<h3><span class="header-section-number">6.6.1</span> Авторизация в API MyTarget</h3>
<p>Процесс авторизации запускается при первом запуске любой из доступных в пакете функций, и состоит из следующих этапов:</p>
<ol style="list-style-type: decimal">
<li>При запуске любой функции изначально начинается поиск в папке указанной в агрументе <em>token_path</em>, локального файла содержащего в себе учётные данные, поиск файла осуществляется по его названию <em>login</em>.mytar.Auth.RData, где вместо <em>login</em> будет подставлено значеник указанное вами в аргументе <em>login</em>.</li>
<li>Если файл <em>login</em>.mytar.Auth.RData, в котором хранятся учётные данные был найден в указанной в аргументе <em>token_path</em> директории то запущенная функция загрузит из него необходимые для авторизации данные и продолжит работу по загрузке данных.</li>
<li>Если файл <em>login</em>.mytar.Auth.RData, в котором хранятся учётные данные не был найден в указанной в аргументе <em>token_path</em> директории то будет запущен браузер, в котором вам необходимо подтвердить доступ <code>rmytarget</code> к одному из ваших аккаунтов в MyTarget.</li>
<li>Далее вы будете перенаправлены на веб страницу на которой будет сгенерирован код подтверждения авторизации. Этот код необходимо скопировать и вставить в R консоль в ответ на запрос <em>“Enter code from browser:”</em>.</li>
<li>Далее в консоли будет выведено сообщение <em>“Do you want save API credential in local file (token_path/login.mytar.Auth.RData) for use it between R sessions?”</em>, в качестве отвта на который вам необходимо ввести “y” или “yes”. После чего полученные учётные данные будут сохранены в директории указанной в аргументе <em>token_path</em> в файле <em>login</em>.mytar.Auth.RData, где вместо <em>login</em> будет подставлено значеник указанное вами в аргументе <em>login</em>.</li>
<li>При следующем обращении к API с использованием любой из функций пакета авторизация будет проходить согласно пункту <strong>1</strong>.</li>
</ol>
<p><strong>Внимание</strong> API MyTarget даёт вам возможность получить максимум 5 токнов для одновременной работы на 1 аккаунт, т.е. если вы работаете под агентским аккаунтом то вы можете получить 5 токенов для самого агентского аккаунта, и по 5 токенов для каждого привязанного клиентского аккаунта, поэтому <strong>всегда</strong> сохраняйте учётные данные в файл, иначе возможна ситуация когда вы не сможете пройти авторизацию в API. В случае утери всех 5 токенов. Токены автоматически удаляются по истечении месяца неактивности (истечения expires_in), поэтому в случае когда вы получили все 5 токенов, и потеряли их запросить новый вы сможете не ранее чем через месяц после последнего обращения к API с помощью одного из утерянных токенов.</p>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rmytarget)

<span class="co"># обычный рекламный кабинет</span>
<span class="co"># загрузка объектов из рекламного кабинета</span>
camp &lt;-<span class="st"> </span><span class="kw">myTarGetCampaignList</span>(<span class="dt">login =</span> <span class="st">&quot;client_account&quot;</span>, <span class="dt">token_path =</span> <span class="st">&quot;tokens&quot;</span>)
ads  &lt;-<span class="st"> </span><span class="kw">myTarGetAdList</span>(<span class="dt">login =</span> <span class="st">&quot;client_account&quot;</span>, <span class="dt">token_path =</span> <span class="st">&quot;tokens&quot;</span>)

<span class="co"># загрузка статистики</span>
<span class="co"># статистика по рекламным кампаниям</span>
camp_stat &lt;-<span class="st"> </span><span class="kw">myTarGetStats</span>(<span class="dt">date_from   =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                           <span class="dt">date_to     =</span> <span class="st">&quot;2018-08-31&quot;</span>,
                           <span class="dt">object_id   =</span> camp<span class="op">$</span>id,
                           <span class="dt">object_type =</span> <span class="st">&quot;campaigns&quot;</span>,
                           <span class="dt">login       =</span> <span class="st">&quot;client_account&quot;</span>,
                           <span class="dt">token_path  =</span> <span class="st">&quot;tokens&quot;</span>)

<span class="co"># статистика по объявлениям</span>
ad_stats &lt;-<span class="st"> </span><span class="kw">myTarGetStats</span>(<span class="dt">date_from   =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                          <span class="dt">date_to     =</span> <span class="st">&quot;2018-08-31&quot;</span>,
                          <span class="dt">object_id   =</span> ads<span class="op">$</span>id,
                          <span class="dt">object_type =</span> <span class="st">&quot;banners&quot;</span>,
                          <span class="dt">login       =</span> <span class="st">&quot;client_account&quot;</span>,
                          <span class="dt">token_path  =</span> <span class="st">&quot;tokens&quot;</span>)

<span class="co"># агентский рекламный кабинет</span>
clients &lt;-<span class="st"> </span><span class="kw">myTarGetClientList</span>(<span class="dt">login =</span> <span class="st">&quot;agency_account&quot;</span>, <span class="dt">token_path =</span> <span class="st">&quot;tokens&quot;</span>)</code></pre></div>
</div>
</div>
<div id="---google-analytics" class="section level2">
<h2><span class="header-section-number">6.7</span> Загрузка данных из Google Analytics</h2>
<p>Для работы с API в R существует несколько пакетов, я пробовал работать как минимум с четырмя, но наиболее удобным и многофункциональным для меня был пакет <code>RGA</code> разработанный Артёмом Клевцовым. Для установки воспользуйтесь командой <code>install.packages(&quot;RGA&quot;)</code>.</p>
<div id="-api----google-analytics" class="section level3">
<h3><span class="header-section-number">6.7.1</span> Какие API интерфейсы доступны в Google Analytics</h3>
<p>В Google Analytics доступно 5 API интерфейсов.</p>
<ul>
<li><a href="https://developers.google.com/analytics/devguides/reporting/core/v4/?hl=ru">Core Reporting API</a> - Запрашивайте параметры и показатели для создания специальных отчетов.</li>
<li><a href="https://developers.google.com/analytics/devguides/config/mgmt?hl=ru">Management API</a> - Просматривайте аккаунты, свойства, представления, фильтры, разрешения и т. д. и управляйте ими.</li>
<li><a href="https://developers.google.com/analytics/devguides/reporting/mcf/v3/?hl=ru">Multi-Channel Funnels Reporting API</a> - Получайте отчеты по многоканальным последовательностям для анализа сложных путей конверсии.</li>
<li><a href="https://developers.google.com/analytics/devguides/reporting/realtime/v3/?hl=ru">Real Time Reporting API</a> - Получайте отчеты в режиме реального времени, чтобы знать, что происходит на вашем ресурсе прямо сейчас.</li>
<li><a href="https://developers.google.com/analytics/devguides/reporting/metadata/v3/?hl=ru">Metadata API</a> - Просматривайте список параметров, показателей, а также их атрибутов.</li>
</ul>
</div>
<div id="--api-google-analytics" class="section level3">
<h3><span class="header-section-number">6.7.2</span> Авторизация в API Google Analytics</h3>
<p>При работе с пакетом <code>RGA</code> вы, в ходе одной R сессии, можете обращаться ко множеству Google аккаунтов, эо может понадобится если вам необходимо загрузить данные более чем из 100 аккаунтов Google Analytics т.к. существует ограничение 100 аккаунтов Analytics на одного пользователя.</p>
<p>Для работы сразу под несколькими пользователями вы можете с помощью функции <code>authorize</code> и аргумента <em>username</em> авторизоваться под несколькими пользователями, при этом учётные данные каждого пользователя будут сохранены в локальные файлы, название файла будет выглядеть как .<em><a href="mailto:username*@gmail.com-token.rds">username*@gmail.com-token.rds</a>, где </em>username* будет аналогичен значению указанному в аргументе <em>username</em>.</p>
<p><strong>Пример авторизации под несколькими аккаунтами</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r.for.marketing &lt;-<span class="st"> </span><span class="kw">authorize</span>(<span class="dt">username =</span> <span class="st">&quot;r.for.marketing&quot;</span>)
alsey.netpeak   &lt;-<span class="st"> </span><span class="kw">authorize</span>(<span class="dt">username =</span> <span class="st">&quot;alsey.netpeak&quot;</span>)</code></pre></div>
</div>
<div id="--management-api" class="section level3">
<h3><span class="header-section-number">6.7.3</span> Работа с Management API</h3>
<p>Основные функции для работы с Management API</p>
<ul>
<li><code>list_accounts</code> - Загрузка списка доступных аккаунтов для пользователя</li>
<li><code>list_profiles</code> - Загрузка списка доступных представлений</li>
<li><code>list_webproperties</code> - Загрузка списка доступных ресурсов</li>
<li><code>list_goals</code> - Загрузка списка настроенных целей</li>
<li><code>list_filters</code> - Загрузка списка фильтров</li>
<li><code>list_segments</code> - Загрузка списка сегментов</li>
</ul>
<p><strong>Основные аргументы перечисленных выше функций</strong></p>
<ul>
<li>accountId - Id аккаунта Google Analytics</li>
<li>webPropertyId - Id представления Google Analytics</li>
<li>profileId - Id ресурса Google Analytics</li>
<li>token - Объект созданный с помощью функции <code>authorize</code> хранящий учётный данные</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_ga_accounts &lt;-<span class="st"> </span>RGA<span class="op">::</span><span class="kw">list_accounts</span>()       <span class="co"># загрузка списка аккаунтов</span>
my_ga_profiles &lt;-<span class="st"> </span>RGA<span class="op">::</span><span class="kw">list_profiles</span>()       <span class="co"># загрузка списка ресурсов</span>
my_ga_views    &lt;-<span class="st"> </span>RGA<span class="op">::</span><span class="kw">list_webproperties</span>()  <span class="co"># загрузка списка представлений</span>
my_goals       &lt;-<span class="st"> </span>RGA<span class="op">::</span><span class="kw">list_goals</span>()          <span class="co"># загрузка списка целей</span>
my_filters     &lt;-<span class="st"> </span>RGA<span class="op">::</span><span class="kw">list_filters</span>(<span class="dt">accountId =</span> <span class="dv">44472206</span>) <span class="co"># список фильтров</span>
my_segments    &lt;-<span class="st"> </span>RGA<span class="op">::</span><span class="kw">list_segments</span>()       <span class="co"># загрузка списка сегментов</span></code></pre></div>
</div>
<div id="--core-reporting-api" class="section level3">
<h3><span class="header-section-number">6.7.4</span> Работа с Core Reporting API</h3>
<p>Функция <code>get_ga</code> позволяет вам запрашивать данные из Core Reporting API, её основные аргументы:</p>
<ul>
<li>profileId - Id представления Google Analytics</li>
<li>start.date - Дата начала отчётного периода</li>
<li>end.date - Дата окончания периода</li>
<li>metrics - Список метрик отчёта, актуальный список доступен по <a href="https://developers.google.com/analytics/devguides/reporting/core/dimsmets">ссылке</a></li>
<li>dimensions - Список группировок отчёта, актуальный список доступен по <a href="https://developers.google.com/analytics/devguides/reporting/core/dimsmets">ссылке</a></li>
<li>sort - Сортировка отчёта, поля по которым необходимо отсортировать данные, для сортировки по убыванию перед названияем поля необходимо поставить минус</li>
<li>filters - Условия фильтрации, смотрите пример кода
<ul>
<li>операторы при фильтрации:
<ul>
<li>== - точное соответсвие</li>
<li>!= - Не соответствует</li>
<li>=@ - содержит подстроку</li>
<li>!@ - не содержит подстроку</li>
<li>=~ - соответсвуе регулярному выражени</li>
<li>!~ - не соответвует регулярному выражению</li>
</ul></li>
</ul></li>
<li>segment - Применить сегмент, вы можете либо описать динамический сегмент, либо указать Id нуюного сегмента, смотрите пример кода ниже</li>
<li>samplingLevel - Уровень семплирования, для наибольшей точности данных укажите “HIGHER_PRECISION”</li>
<li>fetch.by - Аргумент позволяющий разбить ваш запрос на подзапросы по времни, для обхода семплирования, принимает значения “day”, “week”, “month”</li>
<li>token - Объект созданный с помощью функции <code>authorize</code> хранящий учётный данные</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Core API</span>
my_core_data &lt;-<span class="st"> </span>RGA<span class="op">::</span><span class="kw">get_ga</span>(<span class="dt">profileId     =</span> <span class="st">&quot;ga:170507937&quot;</span>,
                            <span class="dt">start.date    =</span> <span class="st">&quot;14daysAgo&quot;</span>,
                            <span class="dt">end.date      =</span> <span class="st">&quot;yesterday&quot;</span>,
                            <span class="dt">metrics       =</span> <span class="st">&quot;ga:users,ga:sessions,ga:bounces&quot;</span>,
                            <span class="dt">dimensions    =</span> <span class="st">&quot;ga:date,ga:source,ga:medium&quot;</span>,
                            <span class="dt">sort          =</span> <span class="st">&quot;-ga:date&quot;</span>,
                            <span class="dt">filters       =</span> <span class="st">&quot;ga:medium!=cpc,ga:source=@g&quot;</span>, <span class="co"># &quot;,&quot; - ИЛИ, &quot;;&quot; - И</span>
                            <span class="dt">segment       =</span> <span class="st">&quot;sessions::condition::ga:bounces&gt;0&quot;</span>,
                            <span class="dt">samplingLevel =</span> <span class="st">&quot;HIGHER_PRECISION&quot;</span>,
                            <span class="dt">fetch.by      =</span> <span class="st">&quot;day&quot;</span>,
                            <span class="dt">token         =</span> alsey.netpeak)</code></pre></div>
</div>
<div id="--multi-channel-funnels-api" class="section level3">
<h3><span class="header-section-number">6.7.5</span> Работа с Multi-Channel Funnels API</h3>
<p>Для загрузки цепочек взаимодействия пользователя на пути к совершению конверсии через Multi-Channel Funnels API вы должны использовать функцию <code>get_mcf</code>.</p>
<p><strong>Аргументы</strong></p>
<ul>
<li>profileId - Id представления Google Analytics</li>
<li>start.date - Дата начала отчётного периода, статичная или относительная, смотрите пример кода ниже</li>
<li>end.date - Дата окончания отчётного периода, статичная или относительная, смотрите пример кода ниже</li>
<li>dimensions - Список полей-группировок, актуальный список полей доступен по <a href="https://developers.google.com/analytics/devguides/reporting/mcf/dimsmets/?hl=ru">ссылке</a></li>
<li>metrics - Список полей-метрик, актуальный список полей доступен по <a href="https://developers.google.com/analytics/devguides/reporting/mcf/dimsmets/?hl=ru">ссылке</a></li>
<li>samplingLevel - Уровень семплирования, рекомендуемое значение “HIGHER_PRECISION”</li>
<li>token - Объект созданный с помощью функции <code>authorize</code> хранящий учётный данные</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Multi-Channel Funnels API</span>
my_mcf_data &lt;-<span class="st"> </span>RGA<span class="op">::</span><span class="kw">get_mcf</span>(<span class="dt">profileId     =</span> <span class="st">&quot;ga:170507937&quot;</span>,
                            <span class="dt">start.date    =</span> <span class="st">&quot;14daysAgo&quot;</span>,
                            <span class="dt">end.date      =</span> <span class="st">&quot;yesterday&quot;</span>,
                            <span class="dt">dimensions    =</span> <span class="st">&quot;mcf:conversionDate, mcf:mediumPath&quot;</span>,
                            <span class="dt">metrics       =</span> <span class="st">&quot;mcf:assistedConversions&quot;</span>,
                            <span class="dt">samplingLevel =</span> <span class="st">&quot;HIGHER_PRECISION&quot;</span>,
                            <span class="dt">token         =</span> alsey.netpeak)</code></pre></div>
</div>
<div id="--real-time-reporting-api" class="section level3">
<h3><span class="header-section-number">6.7.6</span> Работа с Real time reporting API</h3>
<p>Функция <code>get_realtime</code> позволяет вам получить данные из Real time reporting API.</p>
<p><strong>Аргументы</strong></p>
<ul>
<li>profileId - Id представления Google Analytics</li>
<li>dimensions - Список полей-группировок, актуальный список полей доступен по</li>
<li>metrics - Список полей-группировок, актуальный список полей доступен по</li>
<li>sort - Список полей полей для сортировки данных</li>
<li>token - Объект созданный с помощью функции <code>authorize</code> хранящий учётный данные</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_real_time_API &lt;-<span class="st"> </span>RGA<span class="op">::</span><span class="kw">get_realtime</span>(<span class="dt">profileId     =</span> <span class="st">&quot;ga:6056790&quot;</span>,
                                      <span class="dt">dimensions    =</span> <span class="st">&quot;rt:source, rt:medium, rt:country&quot;</span>,
                                      <span class="dt">metrics       =</span> <span class="st">&quot;rt:activeUsers&quot;</span>,
                                      <span class="dt">sort          =</span> <span class="st">&quot;-rt:activeUsers&quot;</span>,
                                      <span class="dt">token         =</span> alsey.netpeak)</code></pre></div>
</div>
</div>
<div id="---api--" class="section level2">
<h2><span class="header-section-number">6.8</span> Загрузка данных из API Яндекс Метрики</h2>
<p>Для работы с API интерфейсами яндекс метрики мной был разработа пакет <code>rym</code>. Для установки пакета используйте команду <code>devtools::install_github(&quot;selesnow/rym&quot;)</code>.</p>
<p>Для взаимодействия с Яндекс Метрикой существуют следующие API интерфейсы:</p>
<ul>
<li>API управления - Позволяет вам получить информацию о таких объектах как счётчики, цели, фильтры, сегменты и доступы к счётчику.</li>
<li>API отчётов - Позволяет получать информацию о статистике посещений сайта и другие данные, не используя интерфейс Яндекс.Метрики.</li>
<li>API, совместимым с Google Analytics Core Reporting API (v3) - Позволяет получать информацию о посещаемости сайта и другие данные используя привычные параметры запросов при сборе статистики, если ранее вы работали с Google Analytics Core Reporting API (v3).</li>
<li>Logs API - позволяет получать неагрегированные данные, собираемые Яндекс.Метрикой.</li>
</ul>
<div id="----api--" class="section level3">
<h3><span class="header-section-number">6.8.1</span> Авторизация для работы с API Яндекс Метрики</h3>
<p>Для авторизации можно использовать функцию <code>rym_auth</code>, но в целом процесс авторизации устроен так же как и в пакетах <code>rmytarget</code> и <code>ryandexdirect</code>, т.е. нет еобходимосьт отдельно запускать функцию для прохождния авторизации, при запуске любой из функций доступных в <code>rym</code> будет запущен процесс поиска файла в котором хранятся учётные данные и если такой файл не будет найден то откроется браузер для прохождения авторизации, и полученные учётные данные будут сохранены в файл, в папке которую вы указываете в аргументе <em>token.path</em>.</p>
<p>В ходе одной R сессии вы можете авторизоваться и работать под разными пользователями Яндекс Метрики, при этом для каждого пользователя будет создан отдельный файл в котором будут хранится его учётные данные для работы с API Яндекс Метрики.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rym_auth</span>(<span class="dt">login =</span> <span class="st">&quot;vipman.netpeak&quot;</span>, <span class="dt">token.path =</span> <span class="st">&quot;metrica_token&quot;</span>)
<span class="kw">rym_auth</span>(<span class="dt">login =</span> <span class="st">&quot;selesnow&quot;</span>, <span class="dt">token.path =</span> <span class="st">&quot;metrica_token&quot;</span>)</code></pre></div>
</div>
<div id="----api---" class="section level3">
<h3><span class="header-section-number">6.8.2</span> Функции для работы с API управления Яндекс Метрики</h3>
<ul>
<li><code>rym_get_counters</code> - Загрузка доступных для пользователя счётчиков Яндекс Метрики</li>
<li><code>rym_get_goals</code> - Загрузка списка целей</li>
<li><code>rym_get_filters</code> - Загрузка списка фильтров</li>
<li><code>rym_get_segments</code> - Загрузка списка настроенных сегментов</li>
<li><code>rym_users_grants</code> - Загрузка списка пользователей у которых есть доступ к счётчики с уровнем досупа</li>
</ul>
<p><strong>Основные аргументы функций API управления</strong></p>
<ul>
<li>counter - Номер счётчика Яндекс Метрики</li>
<li>login - Логин пользователя Яндекс Метрики</li>
<li>token.path - Путь к папке в которой хранятся файлы с учётными данными</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># API Управления</span>
<span class="co"># получить список счётчиков</span>
selesnow.counters &lt;-<span class="st"> </span><span class="kw">rym_get_counters</span>(<span class="dt">login      =</span> <span class="st">&quot;selesnow&quot;</span>,
                                      <span class="dt">token.path =</span> <span class="st">&quot;metrica_token&quot;</span>)

vipman.counters   &lt;-<span class="st"> </span><span class="kw">rym_get_counters</span>(<span class="dt">login      =</span> <span class="st">&quot;vipman.netpeak&quot;</span>,
                                      <span class="dt">token.path =</span> <span class="st">&quot;metrica_token&quot;</span>)

<span class="co"># получить список целей</span>
my_goals &lt;-<span class="st"> </span><span class="kw">rym_get_goals</span>(<span class="dt">counter =</span> <span class="dv">10595804</span>,
                          <span class="dt">login      =</span> <span class="st">&quot;vipman.netpeak&quot;</span>,
                          <span class="dt">token.path =</span> <span class="st">&quot;metrica_token&quot;</span>)

<span class="co"># получить список фильров</span>
my_filter &lt;-<span class="st"> </span><span class="kw">rym_get_filters</span>(<span class="dt">counter =</span> <span class="dv">10595804</span>,
                             <span class="dt">login      =</span> <span class="st">&quot;vipman.netpeak&quot;</span>,
                             <span class="dt">token.path =</span> <span class="st">&quot;metrica_token&quot;</span>)

<span class="co"># получить список сегментов</span>
my_segments &lt;-<span class="st"> </span><span class="kw">rym_get_segments</span>(<span class="dt">counter =</span> <span class="dv">10595804</span>,
                                <span class="dt">login      =</span> <span class="st">&quot;vipman.netpeak&quot;</span>,
                                <span class="dt">token.path =</span> <span class="st">&quot;metrica_token&quot;</span>)

<span class="co"># получить список пользователей счётчика</span>
users &lt;-<span class="st"> </span><span class="kw">rym_users_grants</span>(<span class="dt">counter =</span> <span class="dv">10595804</span>,
                          <span class="dt">login      =</span> <span class="st">&quot;vipman.netpeak&quot;</span>,
                          <span class="dt">token.path =</span> <span class="st">&quot;metrica_token&quot;</span>)</code></pre></div>
</div>
<div id="---api---" class="section level3">
<h3><span class="header-section-number">6.8.3</span> Загрузка данных из API отчётов Яндекс Метрики</h3>
<p>Для загрузки данных из API отчётов необходимо использовать функцию <code>rym_get_data</code>.</p>
<p><strong>Аргументы</strong></p>
<ul>
<li>counters - Id счётчиков из коорых вы хотите получить данные</li>
<li>date.from - Начальная дата</li>
<li>date.to - Конечная дата</li>
<li>dimensions - Список группировок, актуальный список доступных группировок можно найти по <a href="https://tech.yandex.ru/metrika/doc/api2/api_v1/attributes/visits/source-docpage/">ссылке</a></li>
<li>metrics - Список метрик, актуальный список доступных группировок можно найти по <a href="https://tech.yandex.ru/metrika/doc/api2/api_v1/metrics/visits/basic-docpage/">ссылке</a></li>
<li>sort - Список полей по которым будет осуществляться сортировка данных</li>
<li>login - Логин пользователя Яндекс Метрики</li>
<li>token.path - Путь к папке в которой хранятся файлы с учётными данными</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># API отчётов</span>
reporting.api.stat &lt;-<span class="st"> </span><span class="kw">rym_get_data</span>(<span class="dt">counters   =</span> <span class="st">&quot;23660530,10595804&quot;</span>,
                                   <span class="dt">date.from  =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                                   <span class="dt">date.to    =</span> <span class="st">&quot;yesterday&quot;</span>,
                                   <span class="dt">dimensions =</span> <span class="st">&quot;ym:s:date,ym:s:lastTrafficSource&quot;</span>,
                                   <span class="dt">metrics    =</span> <span class="st">&quot;ym:s:visits,ym:s:pageviews,ym:s:users&quot;</span>,
                                   <span class="dt">sort       =</span> <span class="st">&quot;-ym:s:date&quot;</span>,
                                   <span class="dt">login      =</span> <span class="st">&quot;vipman.netpeak&quot;</span>,
                                   <span class="dt">token.path =</span> <span class="st">&quot;metrica_token&quot;</span>,
                                   <span class="dt">lang =</span> <span class="st">&quot;en&quot;</span>)</code></pre></div>
</div>
<div id="---logs-api--" class="section level3">
<h3><span class="header-section-number">6.8.4</span> Загрузка данных из Logs API Яндекс Метрики</h3>
<p>Функция <code>rym_get_logs</code> позволяет вам получить сырые данные из Logs API.</p>
<p><strong>Аргументы</strong></p>
<ul>
<li>counter - Id счётчика Яндекс Метрики</li>
<li>date.from - Начальная дата</li>
<li>date.to - Конечная дата</li>
<li>fields - Список полей которые необходимо загрузить, актуальный список доступный полей можно найти по ссылки в зависимости от источника логов, <a href="https://tech.yandex.ru/metrika/doc/api2/logs/fields/hits-docpage/">список полей по просмотрам</a>, <a href="https://tech.yandex.ru/metrika/doc/api2/logs/fields/visits-docpage/">список полей по визитам</a>.</li>
<li>source - Источник логов, visits — визиты. hits — просмотры.</li>
<li>login - Логин пользователя Яндекс Метрики</li>
<li>token.path - Путь к папке в которой хранятся файлы с учётными данными</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">logs.api.stat      &lt;-<span class="st"> </span><span class="kw">rym_get_logs</span>(<span class="dt">counter    =</span> <span class="dv">23660530</span>,
                                   <span class="dt">date.from  =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                                   <span class="dt">date.to    =</span> <span class="st">&quot;2018-08-05&quot;</span>,
                                   <span class="dt">fields     =</span> <span class="st">&quot;ym:s:date,</span>
<span class="st">                                                 ym:s:lastTrafficSource,</span>
<span class="st">                                                 ym:s:referer&quot;</span>,
                                   <span class="dt">source     =</span> <span class="st">&quot;visits&quot;</span>,
                                   <span class="dt">login      =</span> <span class="st">&quot;vipman.netpeak&quot;</span>,
                                   <span class="dt">token.path =</span> <span class="st">&quot;metrica_token&quot;</span>)</code></pre></div>
</div>
<div id="---api-----core-reporting-api-google-analytics" class="section level3">
<h3><span class="header-section-number">6.8.5</span> Загрузка данных из API Яндекс Метрики совместимого с Core Reporting API Google Analytics</h3>
<p>Для работы с API Яндекс Метрики совместимым с Core Reporting API Google Analytics стоит использовать функцию <code>rym_get_ga</code>.</p>
<p><strong>Аргументы</strong></p>
<ul>
<li>counter - Id счётчика Яндекс Метрики</li>
<li>dimensions - Список группировок, актуальные поля для группировки данных вы можете найти в <a href="https://tech.yandex.ru/metrika/doc/api2/ga/ga/implemented/metrika_dim-docpage/">справочнике</a></li>
<li>metrics - Список загружаемых метрик, актуальный справочник метрик можно найти по <a href="https://tech.yandex.ru/metrika/doc/api2/ga/ga/implemented/metrika_dim-docpage/">ссылке</a></li>
<li>start.date - Начальная дата</li>
<li>end.date - Конечная дата</li>
<li>sort - Поля для сортировки данных</li>
<li>login - Логин пользователя Яндекс Метрики</li>
<li>token.path - Путь к папке в которой хранятся файлы с учётными данными</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ga.api.stat        &lt;-<span class="st"> </span><span class="kw">rym_get_ga</span>(<span class="dt">counter    =</span> <span class="st">&quot;ga:22584910&quot;</span>,
                                 <span class="dt">dimensions =</span> <span class="st">&quot;ga:date,ga:source&quot;</span>,
                                 <span class="dt">metrics    =</span> <span class="st">&quot;ga:sessions,ga:users&quot;</span>,
                                 <span class="dt">start.date =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                                 <span class="dt">end.date   =</span> <span class="st">&quot;2018-08-05&quot;</span>,
                                 <span class="dt">sort       =</span> <span class="st">&quot;-ga:date&quot;</span>,
                                 <span class="dt">login      =</span> <span class="st">&quot;selesnow&quot;</span>,
                                 <span class="dt">token.path =</span> <span class="st">&quot;metrica_token&quot;</span>)</code></pre></div>
</div>
</div>
<div id="--google-search-console" class="section level2">
<h2><span class="header-section-number">6.9</span> Работа с Google Search Console</h2>
<p>Получить данные о посещаемости и видимости вашего сайта из Google Search Console в R можно с помощью пакета <code>searchConsoleR</code>, устанавливать его необходимо из репозитория на GitHub с помощью команды <code>devtools::install_github(&quot;MarkEdmondson1234/searchConsoleR&quot;)</code>.</p>
<p>По больщому счёту для работы с Search Console вам достаточно трёх функций:</p>
<ul>
<li><code>scr_auth</code> - Авторизация</li>
<li><code>list_websites</code> - Загрузка списка сайтов достпуных в Search Console под авторизованным аккаунтом</li>
<li><code>search_analytics</code> - Загрузка статистики по сайту из Google Search Console</li>
</ul>
<p><strong>Пример</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(searchConsoleR)
<span class="kw">library</span>(googleAuthR)

<span class="co"># go to work directory</span>
<span class="kw">setwd</span>(<span class="st">&quot;C:</span><span class="ch">\\</span><span class="st">r_for_marketing_course</span><span class="ch">\\</span><span class="st">Материалы курса</span><span class="ch">\\</span><span class="st">Модуль 2</span><span class="ch">\\</span><span class="st">Урок 9&quot;</span>)

<span class="co"># Auth</span>
service_token &lt;-<span class="st"> </span><span class="kw">scr_auth</span>()

<span class="co"># Get Sites</span>
web_sites &lt;-<span class="st"> </span><span class="kw">list_websites</span>()

<span class="co"># Get Stat</span>
gsc_stat &lt;-<span class="st"> </span><span class="kw">search_analytics</span>(<span class="dt">siteURL    =</span> <span class="st">&quot;http://selesnow.github.io/&quot;</span>,
                             <span class="dt">startDate  =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                             <span class="dt">endDate    =</span> <span class="st">&quot;2018-08-13&quot;</span>,
                             <span class="dt">dimensions =</span>  <span class="kw">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;page&quot;</span>, <span class="st">&quot;query&quot;</span>),
                             <span class="dt">searchType =</span> <span class="st">&quot;web&quot;</span>,
                             <span class="dt">rowLimit   =</span> <span class="dv">5000</span>)</code></pre></div>
<p><strong>Аргументы функции search_analytics</strong></p>
<ul>
<li>siteURL - URL сайта по которому вы хотите получить статистику из Google Search Console</li>
<li>startDate - Начальная дата</li>
<li>endDate - Конечная дата</li>
<li>dimensions - Название полей которые вы хотите загрузить, возможные значения: “date”, “country”, “device”, “page”, “query”, “searchAppearance”</li>
<li>searchType - ФИльтр по типу поиска: “web”, “image”, “video”</li>
<li>dimensionFilterExp - Фильтр, может применяться к любому полю, например (“device==TABLET”, “country~~GBR”)
<ul>
<li>операторы фильтрации:
<ul>
<li>‘~~’ - содержит</li>
<li>‘==’ - точное соответсвие</li>
<li>‘!~’ - не содержит</li>
<li>‘!=’ - не соответствует</li>
</ul></li>
</ul></li>
</ul>
<div id="----5000---1-" class="section level3">
<h3><span class="header-section-number">6.9.1</span> Как обойти ограничение в 5000 строк на 1 запрос</h3>
<p>При стандартном обращении к API Google Search Console вы можете получить данные не превышающие 5000 строк, но если вы используете какую либо фильтрацию это ограничение не работает, даже если отфильтрованный массив данных содержит более 500 строк.</p>
<p>В связи с чем если вы с помощью цикла отфильтруете запрашиваемые данные например по типу устройста, и соберёте потом полученныенные данные в одну таблицу ы обойдёте это ограничение.</p>
<p>*Пример коа для обхода ограничения**</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devices &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;DESKTOP&quot;</span>, <span class="st">&quot;MOBILE&quot;</span>, <span class="st">&quot;TABLET&quot;</span>)
sc_result &lt;-<span class="st"> </span><span class="kw">list</span>()

<span class="cf">for</span> (dev <span class="cf">in</span> devices) {
  
  n &lt;-<span class="st"> </span><span class="kw">length</span>(sc_result) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
  
  sc_result[[n]] &lt;-<span class="st"> </span><span class="kw">search_analytics</span>(<span class="dt">siteURL    =</span> <span class="st">&quot;http://selesnow.github.io/&quot;</span>,
                                     <span class="dt">startDate  =</span> <span class="st">&quot;2018-08-01&quot;</span>,
                                     <span class="dt">endDate    =</span> <span class="st">&quot;2018-08-13&quot;</span>,
                                     <span class="dt">dimensions =</span>  <span class="kw">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;page&quot;</span>, <span class="st">&quot;query&quot;</span>),
                                     <span class="dt">dimensionFilterExp =</span> <span class="kw">paste0</span>(<span class="st">&quot;device==&quot;</span>, dev),
                                     <span class="dt">searchType =</span> <span class="st">&quot;web&quot;</span>)
}

gsc_stat &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">bind_rows</span>(sc_result)</code></pre></div>
<p>В примере выше мы сначала создаём вектор <em>devices</em> который в качестве элементов содержит названия всех типов устройств.</p>
<p>Далее мы создаём пустой объект класса <em>list</em> в который позже будем по очереди добавлять полученные пок аждому типу устройства данные.</p>
<p>На следующем шаге мы создаём цикл <code>for</code>, в котором по очереди перебираем каждый элемент из списка <em>devices</em> и подставляем этот элемент в аргумент <em>dimensionFilterExp</em> функции <code>search_analytics</code>.</p>
<p>По завершению цикла мы соединяем полученные результаты по каждому типу устройства в один даат фрей <em>gsc_stat</em> с помощью команды <code>dplyr::bind_rows(sc_result)</code>.</p>
</div>
</div>
<div id="--google-trends" class="section level2">
<h2><span class="header-section-number">6.10</span> Работа с Google Trends</h2>
<p>Для загрузки данных из Google Trends можно использовать пакет <code>gtrendsR</code>, для его загрузки выполните команду <code>devtools::install_github('PMassicotte/gtrendsR')</code>.</p>
<p>Основная функция пакета <code>gtrends</code> bvttn cktle.obt <strong>аргументы</strong>:</p>
<ul>
<li>keyword - Запросы по которым вы хотите получить динамику колическа поисковых запросов</li>
<li>geo - Список стран по которым вам необходимо получить данные</li>
<li>gprop - Продукт Google, для которого выполняется запрос тренда, возможные значения: “web”, “news”, “images”, “froogle”, “youtube”</li>
<li>time - Период за который вы запрашиваете данные, возможные значения:
<ul>
<li>“now 1-H” - Данные за последний час</li>
<li>“now 4-H” - Данные за последние 4 часа</li>
<li>“now 1-d” - Данные за последний день</li>
<li>“now 7-d” - Данные за последние 7 дней</li>
<li>“today 1-m” - Данные за последние 30 дней</li>
<li>“today 3-m” - Данные за последние 90 дней</li>
<li>“today 12-m” - Данные за последние 12 месяцев</li>
<li>“today+5-y” - Данные за последние 5 лет</li>
<li>“all” - Данные за всё время, начиная с 2004 года</li>
<li>“Y-m-d Y-m-d” - Временной интервал между двумя датами (например: 2010-01-01 2010-04-03)</li>
</ul></li>
</ul>
<p><em>Пример загрузки данных с Google Trends</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gtrendsR)

<span class="co"># query</span>
res &lt;-<span class="st"> </span><span class="kw">gtrends</span>(<span class="dt">keyword =</span> <span class="kw">c</span>(<span class="st">&quot;google adwords&quot;</span>, 
                           <span class="st">&quot;яндекс директ&quot;</span>, 
                           <span class="st">&quot;google ads&quot;</span>, 
                           <span class="st">&quot;facebook ads&quot;</span>), 
               <span class="dt">geo     =</span> <span class="kw">c</span>(<span class="st">&quot;RU&quot;</span>, <span class="st">&quot;UA&quot;</span>, <span class="st">&quot;KZ&quot;</span>, <span class="st">&quot;BY&quot;</span>),
               <span class="dt">gprop   =</span> <span class="st">&quot;web&quot;</span>,
               <span class="dt">time    =</span> <span class="st">&quot;2018-04-01 2018-08-01&quot;</span>)</code></pre></div>
<p>После выполнения приведённого выше кода вы получите список <strong>res</strong>, который будет содержать несколько дата фреймов:</p>
<ul>
<li>interest_by_city - Данные в разбивке по городам</li>
<li>interest_by_region - данные в разбивке по регионам</li>
<li>interest_over_time - данные с разбивкой по времени</li>
</ul>
<p>Для того, что бы сохранить в качестве отдельного объекта нужные вам данные вы можете воспользоваться следующим кодом.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># results</span>
by_city    &lt;-<span class="st"> </span>res<span class="op">$</span>interest_by_city
by_region  &lt;-<span class="st"> </span>res<span class="op">$</span>interest_by_region
over_time  &lt;-<span class="st"> </span>res<span class="op">$</span>interest_over_time</code></pre></div>
<div id="-----google-trends" class="section level3">
<h3><span class="header-section-number">6.10.1</span> Манипуляция с данными полученными из Google Trends</h3>
<p>Данные полученные из Google Trends являются неплохим примером для работы с рассмотренным на первом модуле пакете <code>tidyr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># to tidy</span>
<span class="kw">library</span>(tidyr)
<span class="kw">library</span>(dplyr)

<span class="co"># by keywords</span>
tidy_res &lt;-<span class="st"> </span>over_time <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">group_by</span>(date, keyword) <span class="op">%&gt;%</span><span class="st">          </span><span class="co"># grouping</span>
<span class="st">              </span><span class="kw">summarise</span>(<span class="dt">hits =</span> <span class="kw">sum</span>(hits)) <span class="op">%&gt;%</span><span class="st">      </span><span class="co"># aggregate</span>
<span class="st">              </span><span class="kw">spread</span>(<span class="dt">key =</span> keyword , <span class="dt">value =</span> hits) <span class="co"># tidying</span>

<span class="co"># by country</span>
tidy_res_country &lt;-<span class="st"> </span>over_time <span class="op">%&gt;%</span>
<span class="st">                      </span><span class="kw">group_by</span>(date, geo) <span class="op">%&gt;%</span><span class="st">          </span><span class="co"># grouping</span>
<span class="st">                      </span><span class="kw">summarise</span>(<span class="dt">hits =</span> <span class="kw">sum</span>(hits)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># aggregate</span>
<span class="st">                      </span><span class="kw">spread</span>(<span class="dt">key =</span> geo , <span class="dt">value =</span> hits) <span class="co"># tidying</span></code></pre></div>
<p>Выполнив приведённый выше код вы преобразете данные из длинного формата в широкий, и сможете проанализировать динамику изменения каждого поискового запроса в определённый период времени.</p>
</div>
</div>
<div id="--" class="section level2">
<h2><span class="header-section-number">6.11</span> Парсинг веб сайтов</h2>
<p>Забегая наперёд скажу, что данный урок (2 модуль, 10 урок) значительно проще понять при просмотре видео, чем при чтении конспекта курса.</p>
<p>Итак, наиболее удобный способ сбора данных с веб страниц в R предосталвяет пакет <code>rvest</code>, с помощью его функций вы можете:</p>
<ul>
<li>Собирать информации с веб страниц с помошью css селекторов или xpath локаторов.</li>
<li>Взаимодейтсвовать с различными элементами сайта, например отправлять формы.</li>
<li>Имитировать пользовательские сессии, начиная от процесса авторизации.</li>
</ul>
<div id="----" class="section level3">
<h3><span class="header-section-number">6.11.1</span> Поиск элементов на веб странице</h3>
<p>Перед тем как приступить к парсингу HTML страницы е необходимо загрузить в R с помощью команды <code>simpl_html &lt;- read_html(&quot;test_html_page.html&quot;)</code>, ’nf эта команда загрузит страницу которую вы можете найти в материалах курса в папаке <em>“Модуль 2/Урок 10/test_html_page.html”</em>, после чего в вашем рабочем окружении будет создан объект содержащий всю информацию из HTML страницы. В качестве аргумента функции можно указывать путь к локальной HTML странице как в приведённом примере, так и URL адрес любой доступной в интернете HTML страницы.</p>
<p><strong>HTML разметка тестовой, локальной страницы</strong></p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;h1&gt;</span> Is the test page <span class="kw">&lt;/h1&gt;</span>
<span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;simple_text&quot;</span><span class="kw">&gt;</span>
<span class="kw">&lt;p</span><span class="ot"> id=</span><span class="st">&#39;first_paragraph&#39;</span><span class="kw">&gt;</span> Is a test page for web scrapping by R and R package rvest<span class="kw">&lt;/p&gt;</span>
<span class="kw">&lt;p&gt;</span> For detail you can go to the rvest tutorial by this <span class="kw">&lt;a</span><span class="ot"> id=</span><span class="st">&#39;link1&#39;</span><span class="ot"> href=</span><span class="st">&#39;https://stat4701.github.io/edav/2015/04/02/rvest_tutorial/&#39;</span><span class="kw">&gt;</span>link<span class="kw">&lt;/a&gt;</span>.<span class="kw">&lt;/p&gt;</span>
<span class="kw">&lt;/div&gt;</span>

<span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;photo&quot;</span><span class="ot"> title=</span><span class="st">&#39;ph&#39;</span><span class="kw">&gt;</span>
<span class="kw">&lt;img</span><span class="ot"> src=</span><span class="st">&quot;https://i.ytimg.com/vi/jyqnbUNEO00/maxresdefault.jpg&quot;</span><span class="ot"> width=</span><span class="st">&quot;500&quot;</span><span class="kw">&gt;</span>
<span class="kw">&lt;/div&gt;</span>
<span class="kw">&lt;h2&gt;</span> Simple table for test <span class="kw">&lt;/h2&gt;</span>
<span class="kw">&lt;table</span><span class="ot"> class=</span><span class="st">&#39;tab&#39;</span><span class="ot"> id=</span><span class="st">&#39;t1&#39;</span><span class="ot"> border=</span><span class="st">&quot;1&quot;</span><span class="ot"> cellpadding=</span><span class="st">&quot;5&quot;</span><span class="ot"> title=</span><span class="st">&#39;test_tab&#39;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>Id<span class="kw">&lt;/td&gt;&lt;td&gt;</span>Value<span class="kw">&lt;/td&gt;&lt;td&gt;</span>Age<span class="kw">&lt;/td&gt;&lt;/tr&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>1<span class="kw">&lt;/td&gt;&lt;td&gt;</span>Alexey<span class="kw">&lt;/td&gt;&lt;td&gt;</span>34<span class="kw">&lt;/td&gt;&lt;/tr&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>2<span class="kw">&lt;/td&gt;&lt;td&gt;</span>Nick<span class="kw">&lt;/td&gt;&lt;td&gt;</span>23<span class="kw">&lt;/td&gt;&lt;/tr&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>3<span class="kw">&lt;/td&gt;&lt;td&gt;</span>Denis<span class="kw">&lt;/td&gt;&lt;td&gt;</span>38<span class="kw">&lt;/td&gt;&lt;/tr&gt;</span>
    <span class="kw">&lt;tr&gt;&lt;td&gt;</span>4<span class="kw">&lt;/td&gt;&lt;td&gt;</span>Andrey<span class="kw">&lt;/td&gt;&lt;td&gt;</span>29<span class="kw">&lt;/td&gt;&lt;/tr&gt;</span>
<span class="kw">&lt;/table&gt;</span>

<span class="kw">&lt;h2&gt;</span> Total rows in table <span class="kw">&lt;/h2&gt;</span>
<span class="kw">&lt;p</span><span class="ot"> id=</span><span class="st">&#39;last_paragraph&#39;</span><span class="ot"> class=</span><span class="st">&quot;simple_text&quot;</span><span class="kw">&gt;</span> Test table has four rows. 


<span class="kw">&lt;p</span><span class="ot"> id=</span><span class="st">&quot;update_date&quot;</span><span class="kw">&gt;&lt;i&gt;</span>2018-08-15<span class="kw">&lt;/i&gt;&lt;/p&gt;</span></code></pre></div>
<p>Для поиска какого либо конкретного элемента странцинаиболее удобно использовать CSS селекторы. Гораздо проще вам будет разобраться в данной теме если вы имеете хотя бы базовые знания в HTML разметке, на всякий случай приведу несколько определений которые мы будем использовать.</p>
<ul>
<li>HTML тег - элемент языка разметки гипертекста. Текст, содержащийся между начальным и конечным тегом, отображается и размещается в соответствии со свойствами, указанными в начальном теге.</li>
<li>Атрибуты - У тега могут быть свойства, называемые атрибутами, дающие дополнительные возможности форматирования текста. Они записываются в виде сочетания: имя атрибута-значения, причём текстовые значения заключаются в кавычки.</li>
<li>Атрибут id - Определяет уникальный идентификатор HTML элемента (его значение должно быть уникально для всего HTML документа).</li>
<li>Атрибут class - Определяет группу HTML элементов.</li>
</ul>
<p>На самом деле CSS селекторы это тема для отдельного большого курса, но в принципе вы без проблем можете найти какое нибудь видео на youtube или статью для того, чо бы более глубоко с ними ознакомистся, в этой книге я приведу пример наиболее простых и часто используемых селекторов.</p>
<ul>
<li><h1 id="update_date-------id-------idupdate_date"><span class="header-section-number">6.11.1</span> update_date - Поиск элемента по его id, в данном случае поиск элемента с id=“update_date”</h1></li>
<li>.simple_text - Поиск элемента по его классу, в данном случае поиск элемента с class=“simple_text”</li>
<li>[title] - Поиск по наличию атрибута, в данном случае мы выдерем все элементы в тегах которых присутвует атрибут title</li>
<li>[title=‘test_tab’] - Поиск элементов по значению атрибута, в данном случае мы выберем элементы в которых атрибут title равен “test_tab”</li>
<li>table - Поиск элемента по названия тега, в данном случае мы выберем все элементы которые находятся внутри тега table</li>
<li>div p a - Вложенные селекторы, в данном случае мы сначала ищем элемент внутри тега div, далее внутри него ищем элемент находящийся внутри тега p после чего внутри него ищем элемент внутри тега a, далее в примере будет прозе это понять.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Поиск элемента по ID</span>
date_node_css_id    &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(<span class="dt">x =</span> simpl_html, <span class="dt">css =</span> <span class="st">&quot;#update_date&quot;</span>) 

<span class="co"># Поиск элемента по классу</span>
searh_class &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;.simple_text&quot;</span>)

<span class="co"># Поиск по наличию атрибута</span>
attr_presence &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;[title]&quot;</span>)

<span class="co"># Поиск по значению атрибута</span>
attr_value  &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;[title=&#39;test_tab&#39;]&quot;</span>)

<span class="co"># Поиск по тегу</span>
tags        &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;table&quot;</span>)

<span class="co"># Вложенные селекторы</span>
many_selectors &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;div p a&quot;</span>)</code></pre></div>
</div>
<div id="-----html-" class="section level3">
<h3><span class="header-section-number">6.11.2</span> Извлечение значений из полученныз элементов HTML страницы</h3>
<p>В прошлом примере мы создали 6 новых объектов в рабочем окружении, все эти объекты являются элементами HTML срнацы, далее из этих элементов мы можем получить некоторые значения с помощью функций:</p>
<ul>
<li>html_text - получить текст находящийся внутри элемента</li>
<li>html_attrs - получить список атрибутов элемента</li>
<li>html_attr - получить значение одного конкретного атриута по его имени</li>
<li>html_name - получить имя тега</li>
<li>html_table - парсинг таблиц с веб страницы</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># извлечение текста</span>
txt_date      &lt;-<span class="st"> </span><span class="kw">html_text</span>(date_node_css_id)
<span class="co"># извлечение атрибутов</span>
txt_attr      &lt;-<span class="st"> </span><span class="kw">html_attrs</span>(searh_class)
<span class="co"># извлечение значения конкретного атрибута</span>
txt_attr_val  &lt;-<span class="st"> </span><span class="kw">html_attr</span>(searh_class[[<span class="dv">2</span>]], <span class="dt">name =</span> <span class="st">&quot;id&quot;</span>)
links_url     &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="dt">name =</span> <span class="st">&quot;href&quot;</span>)
links_text    &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()
<span class="co"># названия тегов</span>
tag_names_txt &lt;-<span class="st"> </span><span class="kw">html_name</span>(searh_class)
<span class="co"># парсинг таблиц</span>
my_table      &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(simpl_html, <span class="dt">css =</span> <span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>)
my_tab &lt;-<span class="st"> </span>my_table[[<span class="dv">1</span>]]</code></pre></div>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">6.11.3</span> Имитация пользовательской веб сессии</h3>
<p>Так же с помощью пакета <code>rvest</code> можно имитировать пользовательские сессии, в этом вам помогут следующие фукнции.</p>
<ul>
<li>html_session - Начать пользовательскую сессию</li>
<li>jump_to - Перейти по ссылке</li>
<li>follow_link - Найти ссылку по её тексту и перейти по этой ссылке</li>
<li>back - Вернутся на предыдущую посещённую страницу в ходе сессии</li>
<li>html_form - Получить все формы на странице</li>
<li>set_values - Заполнить поля формы</li>
<li>submit_form - Отправить форму</li>
<li>session_history - Посмотреть всю историю сессии</li>
</ul>
<p><strong>Пример имитации пользовательской сессии на сайте rutracker.org</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)

<span class="co"># Создаём сессию</span>
session &lt;-<span class="st"> </span><span class="kw">html_session</span>(<span class="st">&quot;http://rutracker.org/forum/index.php&quot;</span>)
<span class="co"># Получаем форму для аутентификации пользователя</span>
all_form &lt;-<span class="st"> </span><span class="kw">html_form</span>(session)
login_form &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(session, <span class="dt">css =</span> <span class="st">&quot;#login-form-quick&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_form</span>() <span class="op">%&gt;%</span><span class="st"> </span>.[[<span class="dv">1</span>]]

<span class="co"># Заполняем форму</span>
filled_form &lt;-<span class="st"> </span><span class="kw">set_values</span>(login_form,
                          <span class="st">&quot;login_username&quot;</span> =<span class="st"> &quot;ваш_логин&quot;</span>,
                          <span class="st">&quot;login_password&quot;</span> =<span class="st"> &quot;ваш_пароль&quot;</span>)
<span class="co"># Отправляем её</span>
<span class="kw">submit_form</span>(session, filled_form)
<span class="co"># Переходим на главную страницу сайта</span>
main      &lt;-<span class="st"> </span><span class="kw">jump_to</span>(session, <span class="st">&quot;http://rutracker.org/forum/index.php&quot;</span>)
username  &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(main, <span class="st">&quot;.logged-in-as-uname&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()
prof_link &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(main, <span class="st">&quot;.logged-in-as-uname&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)
prof      &lt;-<span class="st"> </span><span class="kw">jump_to</span>(session, prof_link)

my_stag_hours &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(prof,<span class="st">&#39;table[class=&quot;user_details borderless w100&quot;] b&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span>.[<span class="dv">3</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()

df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">username =</span> username,
                 <span class="dt">stag =</span> my_stag_hours)

tabl &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(prof,<span class="st">&#39;table[class=&quot;user_details borderless w100&quot;]&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>()
tabl &lt;-<span class="st"> </span><span class="kw">data.frame</span>(tabl)

<span class="co"># список ссылок</span>
<span class="kw">html_nodes</span>(prof, <span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()

rules &lt;-<span class="st"> </span><span class="kw">follow_link</span>(session, <span class="st">&quot;Правила&quot;</span>)

<span class="kw">html_nodes</span>(rules, <span class="st">&quot;.post_body&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()

<span class="kw">session_history</span>(session)</code></pre></div>
<p>Первое что мы делаем это создаём с помощью команды <code>html_session(&quot;http://rutracker.org/forum/index.php&quot;)</code> веб сессию на сайте <a href="http://rutracker.org" class="uri">http://rutracker.org</a> и создаём новый объект <em>session</em>.</p>
<p>Далее мы с помощью функции <code>html_form(session)</code> получаем все формы со страницы.</p>
<p>Но нам нужна форма Id которой login-form-quick, поэтому мы получаем этот элеент, далее считываем форму и получаем первый элемент из листа хранещего формы. <code>login_form &lt;- html_nodes(session, css = &quot;#login-form-quick&quot;) %&gt;% html_form() %&gt;% .[[1]]</code>.</p>
<p>Теперь нам надо заполнить форму, т.е. ввести свой логин и пароль.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filled_form &lt;-<span class="st"> </span><span class="kw">set_values</span>(login_form,
                          <span class="st">&quot;login_username&quot;</span> =<span class="st"> &quot;ваш_логин&quot;</span>,
                          <span class="st">&quot;login_password&quot;</span> =<span class="st"> &quot;ваш_пароль&quot;</span>)</code></pre></div>
<p>И отправляем заполненную форму с помощью <code>submit_form(session, filled_form)</code>.</p>
<p>Далее мы переходим на главную страницу <code>main &lt;- jump_to(session, &quot;http://rutracker.org/forum/index.php&quot;)</code> и для того что бы убедиться что мы уже авторизовались считаем имя пользователя, и заодно ссылку на переход в профиль пользователя.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">username  &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(main, <span class="st">&quot;.logged-in-as-uname&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()
prof_link &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(main, <span class="st">&quot;.logged-in-as-uname&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)</code></pre></div>
<p>Теперь мы можем перейти в свой профиль по полученной ссылке - <code>prof &lt;- jump_to(session, prof_link)</code>.</p>
<p>Далее мы можем получить некорую информацию из своего профиля, например свой стаж на rutracker, давайте для этого выполним команду <code>my_stag_hours &lt;- html_nodes(prof,'table[class=&quot;user_details borderless w100&quot;] b') %&gt;% .[3] %&gt;% html_text()</code>. В данном случае мы загрузили элемен который является таблицей (тег table) и имеет класс “user_details borderless w100”, получить тег, класс и любые атрибуты элемента,а так же полный путь css селектора к этому элементу можно прямо в браузере:</p>
<div class="figure">
<img src="r_for_marketing_2018_files/figure-html/css_copy.gif" alt="Получить css селектор в Google Chrome" />
<p class="caption">Получить css селектор в Google Chrome</p>
</div>
<p>Как вы видите из gif-ки, для того что бы получить css селектор какого либо объекта, вам необходимо в раузере выделить этот объект, нажать правую кнопку мышки и в меню выбрать “Посмотреть код”, после чего откроется окно в котором буден виден HTML код страницы и опять же нажав по нужному элементу в коде правой кнокпой мышив открывшемся менюбудет пункт Copy, и уже в нём вам досупны команды copy selector и copy xPath, с помощью первой команды вы скопируете css селектор, с помощью второй xPath локатор.</p>
<p>Из полученных данных о имени пользователя и его стаже можно сформировать дата фрейм.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">username =</span> username,
                 <span class="dt">stag =</span> my_stag_hours)</code></pre></div>
<p>Так же мы можем получить таблицу со всей информацией о вашем профиле:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tabl &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(prof,<span class="st">&#39;table[class=&quot;user_details borderless w100&quot;]&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>()
tabl &lt;-<span class="st"> </span><span class="kw">data.frame</span>(tabl)</code></pre></div>
<p>С помощью команды <code>html_nodes(prof, &quot;a&quot;) %&gt;% html_text()</code> мы можем получить вектор состоящий из текста прикреплённого ко всем ссылкам на текущей странице.</p>
<p>К одной из полученных ссылок прикреплён текст “Правила”, которая соответсвенно ведёт на страницу правил, для того что бы перейти по данной ссылке по прикреплённому тексту можно выполнить команду <code>rules &lt;- follow_link(session, &quot;Правила&quot;)</code>, а для того что бы получить первое сообщение мообщение со страницы правил можно выполнить следующую команду <code>html_nodes(rules, &quot;.post_body&quot;) %&gt;% html_text()</code>.</p>
<p>Текстом довольно сложно раскрыть тему парсинга сайтов, поэтому я всё же рекомендую пройти видео урок.</p>
</div>
</div>
<div id="-http-" class="section level2">
<h2><span class="header-section-number">6.12</span> отправка HTTP запросов</h2>
<p>В большинстве случаев для работы с API интерфейсов всех популярных рекламных платформ и систем веб аналитики наверняка вы сможете найти готовое решение в виде пакета функций, но это зачастую кассается зарубежных сервисов, если речь идёт о сервисах популярных в СНГ то готового решения может и не быть, но вы можете обращаться к API интерфейсам таких срвисов с помощью отправки HTTP запросов.</p>
<p>Для работы с HTTP запросами наиболее часто используют пакеты <code>httr</code> и <code>RCurl</code>, но лично мне более удобно работать с <code>httr</code>, поэтому мы с вами разберёмся именно с ним.</p>
<p>В начале второй части мы уже говорили про HTTP запросы, и про их методы, так вот в пакете <code>httr</code> для каждого метода запроса существует отдельная, одноимённая функция.</p>
<ul>
<li>POST - отправка POST запроса</li>
<li>GET - Отправка GET запроса</li>
<li>content - Парсинг полученного ответа</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># отправка GET запроса</span>
get_answer &lt;-<span class="st"> </span><span class="kw">GET</span>(<span class="dt">url =</span> <span class="st">&quot;http://httpbin.org/ip&quot;</span>)

<span class="co"># Отправка запроса с заголовками и параметрами</span>
get_answer &lt;-<span class="st"> </span><span class="kw">GET</span>(<span class="st">&quot;http://httpbin.org/get&quot;</span>,
                  <span class="dt">query =</span> <span class="kw">list</span>(<span class="dt">param1 =</span> <span class="st">&quot;val1&quot;</span>,
                               <span class="dt">param2 =</span> <span class="st">&quot;value2&quot;</span>,
                               <span class="dt">date_from =</span> <span class="st">&quot;2018-08-10&quot;</span>))

my_params &lt;-<span class="st"> </span><span class="kw">content</span>(<span class="dt">x =</span> get_answer, <span class="dt">as =</span> <span class="st">&quot;parsed&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;application/json&quot;</span>)<span class="op">$</span>args

<span class="co"># Отпрака POST запроса</span>
r &lt;-<span class="st"> </span><span class="kw">POST</span>(<span class="dt">url =</span> <span class="st">&quot;http://httpbin.org/post&quot;</span>, 
          <span class="dt">body =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>, <span class="dt">c =</span> <span class="dv">3</span>))

<span class="co"># Request parts</span>
url &lt;-<span class="st"> &quot;http://httpbin.org/post&quot;</span>
body &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>, <span class="dt">c =</span> <span class="dv">3</span>)

<span class="co"># Form encoded</span>
r &lt;-<span class="st"> </span><span class="kw">POST</span>(url, <span class="dt">body =</span> body, <span class="dt">encode =</span> <span class="st">&quot;form&quot;</span>)
<span class="co"># Multipart encoded</span>
r &lt;-<span class="st"> </span><span class="kw">POST</span>(url, <span class="dt">body =</span> body, <span class="dt">encode =</span> <span class="st">&quot;multipart&quot;</span>)
<span class="co"># JSON encoded</span>
r &lt;-<span class="st"> </span><span class="kw">POST</span>(url, <span class="dt">body =</span> body, <span class="dt">encode =</span> <span class="st">&quot;json&quot;</span>)

<span class="co"># Send files</span>
<span class="kw">POST</span>(url, <span class="dt">body =</span> <span class="kw">upload_file</span>(<span class="st">&quot;mypath.txt&quot;</span>))
<span class="kw">POST</span>(url, <span class="dt">body =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="kw">upload_file</span>(<span class="st">&quot;mypath.txt&quot;</span>)))</code></pre></div>
<p><strong>Основные аргументы функций GET и POST</strong></p>
<ul>
<li>url - URL на который вы будете отправлять HTTP запрос</li>
<li>query - GET параметры</li>
<li>body - Тело запроса</li>
<li>encode - Тип запроса</li>
</ul>
<p><strong>Аргументы функции content</strong></p>
<ul>
<li>x - Объект содержащтй рехультат выполнения запроса, который вы хотите распарсить, т.е. то, что вы получили отправив запрос используя функцию POST или GET.</li>
<li>as - Как необходимо извлечь результат запроса, возможные значени raw, text или parsed, как правило используется parsed.</li>
<li>type - Тип, или формат в котором был получен результат:
<ul>
<li>Возможные значения
<ul>
<li>text/html</li>
<li>text/xml</li>
<li>text/csv</li>
<li>text/tab-separated-values</li>
<li>application/json</li>
<li>application/x-www-form-urlencoded</li>
<li>image/jpeg</li>
<li>image/png</li>
</ul></li>
</ul></li>
</ul>
<p>Для отправки запроса с заголовками необходимо использовать функцию <code>add_headers</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Отправка запроса с заголовками</span>
get_answer &lt;-<span class="st"> </span><span class="kw">GET</span>(<span class="st">&quot;http://httpbin.org/get&quot;</span>,
                  <span class="dt">config =</span> <span class="kw">add_headers</span>(<span class="dt">param3 =</span> <span class="st">&quot;my_header_param&quot;</span>,
                                       <span class="dt">Authorization =</span> <span class="st">&quot;56536251hshndsh7q687y8&quot;</span>))

my_headers &lt;-<span class="st"> </span><span class="kw">content</span>(<span class="dt">x =</span> get_answer, <span class="dt">as =</span> <span class="st">&quot;parsed&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;application/json&quot;</span>)<span class="op">$</span>headers</code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="-1-r-.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="-3-api-.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-module_2.Rmd",
"text": "Edit"
},
"download": ["r_for_marketing.pdf", "r_for_marketing.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
